<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ONTO ‚Äî Client Portal</title>
<meta name="description" content="ONTO Client Portal ‚Äî Manage your AI epistemic risk verification account, API keys, and billing.">
<meta name="robots" content="noindex, nofollow">
<link rel="icon" type="image/svg+xml" href="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 36 36'%3E%3Ccircle cx='18' cy='18' r='17' fill='white'/%3E%3Cpath d='M16 10L20 10L20 26L16 26L16 14L13 14L13 10L16 10Z' fill='%230a0a0a'/%3E%3C/svg%3E">
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
<style>
:root {
    color-scheme: dark;
    --bg: #0a0a0a;
    --bg-secondary: #121212;
    --bg-card: #1a1a1a;
    --bg-elevated: #242424;
    --border: #333333;
    --border-hover: #444444;
    --text: #fafafa;
    --text-secondary: #a0a0a0;
    --text-muted: #606060;
    --accent: #15803d;
    --accent-hover: #166534;
    --accent-subtle: rgba(21, 128, 61, 0.1);
    --danger: #dc2626;
    --danger-subtle: rgba(220, 38, 38, 0.1);
    --blue: #3b82f6;
    --blue-subtle: rgba(59, 130, 246, 0.1);
}

/* === LIGHT THEME === */
[data-theme="light"] {
    color-scheme: light;
    --bg: #ffffff;
    --bg-secondary: #fafafa;
    --bg-card: #ffffff;
    --bg-elevated: #f5f5f5;
    --border: #e5e7eb;
    --border-hover: #d1d5db;
    --text: #111827;
    --text-secondary: #6b7280;
    --text-muted: #9ca3af;
}
[data-theme="light"] select,
[data-theme="light"] select option,
[data-theme="light"] select optgroup {
    background-color: #ffffff;
    color: #111827;
}
*, *::before, *::after { margin: 0; padding: 0; box-sizing: border-box; }
body { font-family: 'Inter', sans-serif; font-size: 15px; line-height: 1.6; color: var(--text); background: var(--bg-secondary); }

/* === AUTH === */
.auth-container { min-height: 100vh; display: flex; align-items: center; justify-content: center; padding: 24px; }
.auth-card { background: var(--bg-card); border: 1px solid var(--border); border-radius: 16px; padding: 40px; width: 100%; max-width: 480px; box-shadow: 0 4px 24px rgba(0,0,0,0.06); }
.auth-logo { display: flex; align-items: center; gap: 10px; margin-bottom: 32px; justify-content: center; }
.auth-logo svg { width: 32px; height: 32px; }
.auth-logo span { font-size: 24px; font-weight: 700; }
.auth-title { font-size: 24px; font-weight: 700; text-align: center; margin-bottom: 8px; }
.auth-subtitle { color: var(--text-secondary); text-align: center; margin-bottom: 32px; font-size: 14px; }

/* === FORMS === */
.form-group { margin-bottom: 20px; }
.form-label { display: block; font-size: 14px; font-weight: 500; margin-bottom: 8px; }
.form-input { width: 100%; padding: 12px 16px; font-size: 15px; border: 1px solid var(--border); border-radius: 10px; background: var(--bg); color: var(--text); transition: all 0.15s; }
.form-input::placeholder { color: var(--text-muted); opacity: 0.7; }
.form-input:focus { outline: none; border-color: var(--accent); box-shadow: 0 0 0 3px var(--accent-subtle); }
.form-input.error { border-color: var(--danger); }
.form-input.error:focus { box-shadow: 0 0 0 3px rgba(239, 68, 68, 0.1); }

/* Institutional Form */
.form-inst .form-group { margin-bottom: 14px; }
.form-inst .form-label { font-size: 12px; font-weight: 400; color: var(--text-muted); margin-bottom: 4px; }
.form-inst .form-label.required::after { content: ' *'; color: var(--text-muted); }
.form-inst .form-input { padding: 8px 10px; font-size: 13px; border-radius: 4px; background: var(--bg-elevated); transition: border-color 0.2s, background-color 0.2s; }
.form-inst .form-input::placeholder { color: var(--text-muted); opacity: 0.6; }
.form-inst textarea.form-input { resize: vertical; min-height: 60px; font-family: inherit; }
.form-inst .form-input:focus { box-shadow: none; border-color: var(--text-muted); }
.form-inst .form-input.valid { border-color: var(--border); }
.form-inst .form-input.empty-required { border-color: rgba(156, 163, 175, 0.5); background: rgba(156, 163, 175, 0.03); }
.form-inst .form-input.error { border-color: rgba(239, 68, 68, 0.5); background: rgba(239, 68, 68, 0.03); }
.form-inst select.form-input { appearance: none; background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='12' height='12' viewBox='0 0 24 24' fill='none' stroke='%236b7280' stroke-width='2'%3E%3Cpath d='M6 9l6 6 6-6'/%3E%3C/svg%3E"); background-repeat: no-repeat; background-position: right 10px center; padding-right: 32px; cursor: pointer; }
.form-inst select.form-input option { background: var(--bg-card); color: var(--text); padding: 8px; }
.form-inst select.form-input optgroup { background: var(--bg-elevated); color: var(--text-secondary); font-weight: 600; }
.form-inst select.form-input.valid { background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='12' height='12' viewBox='0 0 24 24' fill='none' stroke='%236b7280' stroke-width='2'%3E%3Cpath d='M6 9l6 6 6-6'/%3E%3C/svg%3E"); }
.password-wrapper { position: relative; }
.password-toggle { position: absolute; right: 12px; top: 50%; transform: translateY(-50%); background: none; border: none; cursor: pointer; color: var(--text-muted); }

/* === TERMS SCROLL === */
.terms-container { border: 1px solid var(--border); border-radius: 10px; height: 200px; overflow-y: auto; padding: 16px; margin-bottom: 16px; background: var(--bg); font-size: 13px; }
.terms-container h3 { font-size: 14px; margin: 16px 0 8px; color: var(--text); }
.terms-container h3:first-child { margin-top: 0; }
.terms-container p { margin-bottom: 8px; color: var(--text-secondary); }
.terms-container ul { margin: 8px 0 8px 20px; }
.terms-container li { margin-bottom: 4px; color: var(--text-secondary); }
.terms-container table { width: 100%; margin: 8px 0; font-size: 12px; border-collapse: collapse; }
.terms-container th, .terms-container td { padding: 6px 8px; border: 1px solid var(--border); text-align: left; }
.terms-container th { background: var(--bg-elevated); font-weight: 600; }

.checkbox-group { display: flex; align-items: flex-start; gap: 10px; margin-bottom: 20px; }
.agreement-notice { font-size: 12px; color: var(--text-secondary); margin-bottom: 12px; line-height: 1.5; }
.agreement-notice a { color: var(--text-muted); text-decoration: underline; }
.form-inst .checkbox-group { margin-bottom: 10px; }
.form-inst .checkbox-group label { font-size: 12px; color: var(--text-secondary); transition: color 0.2s; }
.form-inst .checkbox-group.checked label { color: var(--text); }
.form-inst .checkbox-group input[type="checkbox"] { accent-color: var(--accent); }
.checkbox-group input[type="checkbox"] { width: 18px; height: 18px; margin-top: 2px; accent-color: var(--accent); }
.checkbox-group label { font-size: 14px; color: var(--text-secondary); cursor: pointer; }
.checkbox-group a { color: var(--accent); text-decoration: none; }

/* === BUTTONS === */
.btn { display: inline-flex; align-items: center; justify-content: center; gap: 8px; padding: 12px 24px; font-size: 14px; font-weight: 600; border-radius: 10px; border: none; cursor: pointer; transition: all 0.15s; text-decoration: none; width: 100%; }
.btn-primary { background: var(--accent); color: white; }
.btn-primary:hover { background: var(--accent-hover); transform: translateY(-1px); }
.btn-primary:disabled { background: var(--border); color: var(--text-muted); cursor: not-allowed; transform: none; pointer-events: none; }
.btn-wrapper { display: inline-block; width: 100%; }
.btn-secondary { background: var(--bg); color: var(--text); border: 1px solid var(--border); }
.btn-secondary:hover { background: var(--bg-elevated); }
.btn-outline { background: transparent; color: var(--accent); border: 2px solid var(--accent); }
.btn-outline:hover { background: var(--accent-subtle); }
.btn-sm { padding: 8px 16px; font-size: 13px; width: auto; }

.auth-switch { text-align: center; margin-top: 24px; font-size: 14px; color: var(--text-secondary); }
.auth-switch a { color: var(--accent); text-decoration: none; font-weight: 500; cursor: pointer; }

/* === DASHBOARD === */
.dashboard { display: none; min-height: 100vh; }
.dashboard.active { display: flex; }
.sidebar { display: none; width: 260px; background: var(--bg-card); border-right: 1px solid var(--border); padding: 0; position: fixed; height: 100vh; flex-direction: column; }
.sidebar-header { display: flex; align-items: center; justify-content: space-between; padding: 16px 20px; border-bottom: 1px solid var(--border); flex-shrink: 0; }
.sidebar-header-actions { display: flex; align-items: center; gap: 8px; }
.desktop-only { display: none; }
.sidebar-logo { display: flex; align-items: center; gap: 10px; }
.sidebar-logo svg { width: 28px; height: 28px; }
.sidebar-logo span { font-size: 20px; font-weight: 700; }
.sidebar-close { display: none; background: none; border: none; cursor: pointer; color: var(--text-muted); padding: 4px; }
.sidebar-close:hover { color: var(--text); }
.sidebar.mobile-open .sidebar-close { display: block; }
.sidebar-nav { padding: 16px 12px; flex: 1; overflow-y: auto; min-height: 0; }
.nav-item { display: flex; align-items: center; gap: 12px; padding: 10px 14px; border-radius: 6px; color: var(--text-secondary); cursor: pointer; transition: all 0.15s; font-size: 13px; font-weight: 500; }
.nav-item:hover { background: var(--bg-elevated); color: var(--text); }
.nav-item.active { background: var(--accent-subtle); color: var(--accent); }
.nav-item svg { width: 18px; height: 18px; }
.nav-divider { height: 1px; background: var(--border); margin: 12px 14px; }
.sidebar-footer { border-top: 1px solid var(--border); padding: 10px 16px; margin-top: auto; flex-shrink: 0; }
.sidebar-user { display: flex; align-items: center; gap: 10px; }
.sidebar-actions { display: flex; gap: 4px; }
.sidebar-action-btn { background: none; border: none; cursor: pointer; color: var(--text-muted); padding: 6px; border-radius: 4px; transition: all 0.15s; }
.sidebar-action-btn:hover { background: var(--bg-elevated); color: var(--text); }
.sidebar-version { font-size: 10px; color: var(--text-muted); margin-top: 8px; }
.theme-toggle-btn { background: none; border: 1px solid var(--border); border-radius: 6px; padding: 6px 8px; cursor: pointer; font-size: 14px; transition: all 0.2s; }
.theme-toggle-btn:hover { background: var(--bg-elevated); }
.user-avatar { width: 32px; height: 32px; border-radius: 6px; background: var(--bg-elevated); color: var(--text-muted); display: flex; align-items: center; justify-content: center; font-weight: 500; font-size: 12px; border: 1px solid var(--border); }
.user-info { flex: 1; min-width: 0; }
.user-name { font-weight: 500; font-size: 13px; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
.user-tier { font-size: 11px; color: var(--text-muted); }
.user-plan { font-size: 12px; color: var(--text-muted); }
.plan-badge { display: inline-block; padding: 2px 8px; border-radius: 4px; font-size: 11px; font-weight: 600; background: var(--accent-subtle); color: var(--accent); }
.tier-badge { font-size: 11px; color: var(--text-muted); }

.main-content { flex: 1; margin-left: 0; padding: 16px; padding-top: 72px; overflow-x: hidden; }
.page { display: none; overflow-x: hidden; }
.page.active { display: block; }
.page-header { display: flex; justify-content: space-between; align-items: flex-start; margin-bottom: 32px; gap: 24px; }
.page-title { font-size: 24px; font-weight: 700; margin-bottom: 4px; }
.page-subtitle { color: var(--text-secondary); font-size: 14px; }

/* === INSTITUTIONAL PAGES === */
.page-header-clean { margin-bottom: 32px; }
.page-header-clean .page-title { font-size: 22px; font-weight: 500; letter-spacing: -0.3px; }

.section-block { margin-bottom: 28px; padding-bottom: 20px; border-bottom: 1px solid var(--border); overflow-x: auto; }
.section-block:last-child { border-bottom: none; margin-bottom: 0; }
.section-label { font-size: 11px; font-weight: 500; color: var(--text-muted); text-transform: uppercase; letter-spacing: 0.5px; margin-bottom: 12px; }
.section-text { font-size: 13px; color: var(--text-secondary); margin-bottom: 12px; word-wrap: break-word; }
.section-footnote { font-size: 12px; color: var(--text-muted); margin-top: 12px; word-break: break-word; }
.section-footnote a { color: var(--text-secondary); text-decoration: none; word-break: break-all; }
.section-footnote a:hover { text-decoration: underline; }

.key-row { display: flex; flex-direction: column; gap: 8px; margin-bottom: 12px; }
.key-input { width: 100%; padding: 10px 12px; font-family: 'JetBrains Mono', monospace; font-size: 11px; background: var(--bg-elevated); border: 1px solid var(--border); border-radius: 6px; color: var(--text); }
.key-buttons { display: flex; gap: 8px; }
.key-meta { display: flex; flex-direction: column; gap: 4px; font-size: 11px; color: var(--text-muted); }

.btn-minimal { padding: 8px 14px; font-size: 12px; font-weight: 500; background: transparent; border: 1px solid var(--border); border-radius: 6px; color: var(--text-secondary); cursor: pointer; transition: all 0.15s; }
.btn-minimal:hover { background: var(--bg-elevated); color: var(--text); }
.btn-minimal:disabled { opacity: 0.4; cursor: not-allowed; }
.btn-minimal:disabled:hover { background: transparent; color: var(--text-secondary); }

.btn-danger-outline { padding: 8px 14px; font-size: 12px; font-weight: 500; background: transparent; border: 1px solid var(--danger); border-radius: 6px; color: var(--danger); cursor: pointer; transition: all 0.15s; }
.btn-danger-outline:hover { background: rgba(239, 68, 68, 0.08); }

.code-block { background: #1e293b; color: #e2e8f0; padding: 12px; border-radius: 6px; font-family: 'JetBrains Mono', monospace; font-size: 11px; line-height: 1.5; overflow-x: auto; margin: 0; max-width: 100%; box-sizing: border-box; }
pre { max-width: 100%; overflow-x: auto; }

/* Info Rows */
.info-row { display: flex; align-items: center; padding: 12px 0; border-bottom: 1px solid var(--border); gap: 12px; }
.info-row:last-child { border-bottom: none; }
.info-key { font-size: 13px; color: var(--text-muted); min-width: 100px; }
.info-val { font-size: 13px; color: var(--text); flex: 1; }
a.info-val { color: var(--text-secondary); text-decoration: none; }
a.info-val:hover { color: var(--text); }
.info-val.status-active { display: flex; align-items: center; gap: 6px; }
.info-val .dot { width: 6px; height: 6px; background: var(--accent); border-radius: 50%; }
.info-action { font-size: 12px; color: var(--text-muted); cursor: pointer; }
.info-action:hover { color: var(--text); }

/* Doc Rows */
.doc-row { display: flex; align-items: center; justify-content: space-between; padding: 12px 0; border-bottom: 1px solid var(--border); }
.doc-row:last-child { border-bottom: none; }
.doc-name { font-size: 13px; color: var(--text); }
.doc-link { font-size: 12px; color: var(--text-muted); cursor: pointer; }
.doc-link:hover { color: var(--text); }

/* === TIERS === */
.tiers-grid { display: grid; grid-template-columns: 1fr; gap: 16px; max-width: 340px; margin: 0 auto; }
.tier-card { background: var(--bg-card); border-radius: 8px; padding: 24px; }
.tier-name { font-size: 14px; font-weight: 500; color: var(--text); margin-bottom: 8px; }
.tier-price { font-size: 28px; font-weight: 600; color: var(--text); margin-bottom: 4px; }
.tier-price span { font-size: 13px; font-weight: 400; color: var(--text-muted); }
.tier-desc { font-size: 12px; color: var(--text-muted); margin-bottom: 16px; }
.tier-list { list-style: none; padding: 0; margin: 0 0 20px 0; }
.tier-list li { font-size: 13px; color: var(--text-secondary); padding: 6px 0; border-bottom: 1px solid var(--border); }
.tier-list li:last-child { border-bottom: none; }
.btn-tier { width: 100%; padding: 10px; font-size: 13px; font-weight: 500; background: transparent; border: 1px solid var(--border); border-radius: 6px; color: var(--text); cursor: pointer; transition: all 0.15s; margin-bottom: 8px; }
.btn-tier:hover { background: var(--bg-elevated); }
.btn-tier.current { background: var(--bg-elevated); color: var(--text-muted); cursor: default; }
.btn-tier-secondary { width: 100%; padding: 8px; font-size: 12px; background: transparent; border: none; color: var(--text-muted); cursor: pointer; }
.btn-tier-secondary:hover { color: var(--text); }

/* === CARDS === */
.card { background: var(--bg-card); border: 1px solid var(--border); border-radius: 12px; padding: 24px; margin-bottom: 24px; }
.card-title { font-size: 16px; font-weight: 600; margin-bottom: 16px; }
.stats-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 20px; margin-bottom: 24px; }
.stat-card { background: var(--bg-card); border: 1px solid var(--border); border-radius: 12px; padding: 20px; }
.stat-label { font-size: 13px; color: var(--text-muted); margin-bottom: 4px; }
.stat-value { font-size: 28px; font-weight: 700; }

/* === SETTINGS === */
.settings-section { margin-bottom: 32px; }
.settings-section h3 { font-size: 14px; font-weight: 600; color: var(--text-muted); text-transform: uppercase; letter-spacing: 0.5px; margin-bottom: 16px; }
.settings-row { display: flex; justify-content: space-between; align-items: center; padding: 16px 0; border-bottom: 1px solid var(--border); }
.settings-row:last-child { border-bottom: none; }
.settings-label { font-weight: 500; }
.settings-value { color: var(--text-secondary); }
.settings-action { color: var(--accent); font-weight: 500; cursor: pointer; font-size: 14px; }
.company-status { display: flex; align-items: center; gap: 8px; }
.status-dot { width: 8px; height: 8px; border-radius: 50%; }
.status-dot.inactive { background: var(--text-muted); }
.status-dot.active { background: var(--accent); }

/* === BILLING CARDS === */
.pricing-grid { display: grid; grid-template-columns: 1fr; gap: 12px; max-width: 340px; margin: 0 auto; }
.pricing-card { background: var(--bg-card); border: 1px solid var(--border); border-radius: 12px; padding: 20px 16px; text-align: center; position: relative; transition: all 0.2s; }
.pricing-card.popular { border-color: var(--accent); box-shadow: 0 8px 32px rgba(21, 128, 61, 0.15); }
.pricing-badge { position: absolute; top: -12px; left: 50%; transform: translateX(-50%); background: var(--accent); color: white; padding: 4px 16px; border-radius: 20px; font-size: 12px; font-weight: 600; }
.pricing-name { font-size: 18px; font-weight: 600; margin-bottom: 8px; margin-top: 8px; }
.pricing-price { font-size: 40px; font-weight: 800; margin-bottom: 4px; }
.pricing-period { font-size: 14px; color: var(--text-muted); }
.pricing-annual { font-size: 13px; color: var(--accent); margin-top: 4px; font-weight: 500; }
.pricing-features { margin: 24px 0; text-align: left; }
.pricing-features li { display: flex; align-items: center; gap: 8px; padding: 8px 0; font-size: 14px; color: var(--text-secondary); list-style: none; }
.pricing-features li::before { content: "‚úì"; color: var(--accent); font-weight: 600; }
.pricing-actions { display: flex; flex-direction: column; gap: 8px; }
.pricing-actions .btn { width: 100%; }

/* === MODALS === */
.modal-overlay { position: fixed; inset: 0; background: rgba(0,0,0,0.5); display: none; align-items: center; justify-content: center; z-index: 1000; padding: 24px; }
.modal-overlay.active { display: flex; }
.modal { background: var(--bg-card); border-radius: 16px; width: 100%; max-width: 560px; max-height: 90vh; overflow: hidden; display: flex; flex-direction: column; }
.modal-wide { max-width: 640px; }
.modal-inst { border-radius: 8px; }
.modal-inst .modal-header { padding: 16px 20px; border-bottom: 1px solid var(--border); }
.modal-inst .modal-header h2 { font-size: 15px; font-weight: 500; }
.modal-inst .modal-body { padding: 20px; }
.modal-inst .modal-footer { padding: 16px 20px; }
.form-section { margin-bottom: 20px; padding-bottom: 16px; border-bottom: 1px solid var(--border); }
.form-section:last-of-type { border-bottom: none; margin-bottom: 0; padding-bottom: 0; }
.form-section-title { font-size: 11px; font-weight: 500; color: var(--text-muted); text-transform: uppercase; letter-spacing: 0.5px; margin-bottom: 12px; }
.form-row { display: grid; grid-template-columns: 1fr; gap: 12px; }
@media (min-width: 480px) { .form-row { grid-template-columns: 1fr 1fr; } }
.modal-header { padding: 24px; border-bottom: 1px solid var(--border); display: flex; justify-content: space-between; align-items: center; }
.modal-header h2 { font-size: 18px; font-weight: 600; }
.modal-close { background: none; border: none; cursor: pointer; color: var(--text-muted); font-size: 24px; line-height: 1; }
.modal-body { padding: 24px; overflow-y: auto; flex: 1; }
.modal-footer { padding: 24px; border-top: 1px solid var(--border); display: flex; gap: 12px; justify-content: flex-end; }
.modal-footer .btn { width: auto; min-width: 120px; }

/* === BILLING CYCLE SELECTOR === */
.cycle-option { border: 2px solid var(--border); border-radius: 12px; padding: 16px; margin-bottom: 12px; cursor: pointer; transition: all 0.15s; }
.cycle-option:hover { border-color: var(--border-hover); }
.cycle-option.selected { border-color: var(--accent); background: var(--accent-subtle); }
.cycle-option-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 4px; }
.cycle-option-title { font-weight: 600; display: flex; align-items: center; gap: 8px; }
.cycle-option-title input[type="radio"] { accent-color: var(--accent); }
.cycle-option-price { font-weight: 700; }
.cycle-option-desc { font-size: 13px; color: var(--text-secondary); margin-left: 24px; }
.cycle-savings { background: var(--accent); color: white; padding: 2px 8px; border-radius: 4px; font-size: 11px; font-weight: 600; }

/* Order Modal - Institutional */
.order-section { margin-bottom: 20px; }
.order-features { display: flex; flex-direction: column; gap: 4px; }
.order-feature { font-size: 12px; color: var(--text-secondary); padding-left: 12px; position: relative; }
.order-feature::before { content: '‚Äî'; position: absolute; left: 0; color: var(--text-muted); font-size: 10px; }

.billing-options { display: flex; flex-direction: column; gap: 8px; }
.billing-option { display: flex; align-items: center; gap: 12px; padding: 12px; border: 1px solid var(--border); border-radius: 6px; cursor: pointer; transition: all 0.15s; }
.billing-option:hover { border-color: var(--text-muted); }
.billing-option:has(input:checked) { border-color: var(--accent); background: rgba(34, 197, 94, 0.03); }
.billing-option input[type="radio"] { accent-color: var(--accent); }
.billing-option-content { flex: 1; display: flex; flex-direction: column; gap: 1px; }
.billing-option-name { font-size: 13px; font-weight: 500; color: var(--text); }
.billing-option-detail { font-size: 11px; color: var(--text-muted); }
.billing-option-price { font-size: 14px; font-weight: 600; color: var(--text); }

.payment-options { display: flex; gap: 8px; }
.payment-opt { flex: 1; display: flex; flex-direction: column; align-items: center; gap: 4px; padding: 12px 8px; border: 1px solid var(--border); border-radius: 6px; cursor: pointer; transition: all 0.15s; text-align: center; }
.payment-opt:hover { border-color: var(--text-muted); }
.payment-opt:has(input:checked) { border-color: var(--accent); background: rgba(34, 197, 94, 0.03); }
.payment-opt:has(input:disabled) { opacity: 0.4; cursor: not-allowed; }
.payment-opt input[type="radio"] { accent-color: var(--accent); margin-bottom: 2px; }
.payment-opt-name { font-size: 12px; font-weight: 500; color: var(--text); }
.payment-opt-note { font-size: 10px; color: var(--text-muted); }

.order-summary { margin-top: 20px; padding: 16px; background: var(--bg-elevated); border-radius: 6px; }
.order-summary-row { display: flex; justify-content: space-between; align-items: center; padding: 4px 0; }
.order-summary-row.total { padding-top: 12px; margin-top: 8px; border-top: 1px solid var(--border); }
.order-summary-label { font-size: 12px; color: var(--text-secondary); }
.order-summary-row.total .order-summary-label { font-size: 13px; font-weight: 500; color: var(--text); }
.order-summary-value { font-size: 13px; font-weight: 500; color: var(--text); }
.order-summary-row.total .order-summary-value { font-size: 18px; font-weight: 600; }

.payment-method { margin-top: 24px; padding-top: 24px; border-top: 1px solid var(--border); }
.payment-method h4 { font-size: 14px; font-weight: 600; margin-bottom: 12px; }
.payment-option { display: flex; align-items: center; gap: 10px; padding: 12px; border: 1px solid var(--border); border-radius: 8px; margin-bottom: 8px; cursor: pointer; }
.payment-option.disabled { opacity: 0.5; cursor: not-allowed; }
.payment-option input[type="radio"] { accent-color: var(--accent); }
.payment-option-label { flex: 1; font-size: 14px; }
.payment-option .lock-icon { color: var(--text-muted); font-size: 12px; }

/* === DOCUMENTS === */
.doc-list { }
.doc-item { display: flex; align-items: center; gap: 16px; padding: 16px 0; border-bottom: 1px solid var(--border); }
.doc-item:last-child { border-bottom: none; }
.doc-icon { width: 40px; height: 40px; background: var(--bg-elevated); border-radius: 8px; display: flex; align-items: center; justify-content: center; color: var(--text-muted); }
.doc-info { flex: 1; }
.doc-name { font-weight: 500; margin-bottom: 2px; }
.doc-status { font-size: 13px; color: var(--text-muted); }
.doc-actions { display: flex; gap: 8px; }
.doc-btn { padding: 6px 12px; font-size: 13px; border-radius: 6px; cursor: pointer; border: 1px solid var(--border); background: var(--bg); color: var(--text-secondary); transition: all 0.15s; }
.doc-btn:hover { background: var(--bg-elevated); }
.doc-btn.disabled { opacity: 0.5; cursor: not-allowed; }

/* === HIDDEN === */
.hidden { display: none !important; }

/* === DOCUMENTATION STYLES === */
.docs-container { display: flex; gap: 0; min-height: calc(100vh - 200px); max-width: 100%; box-sizing: border-box; }
.docs-sidebar { display: none; width: 200px; background: var(--bg-card); border-right: 1px solid var(--border); padding: 12px 0; flex-shrink: 0; max-height: calc(100vh - 200px); overflow-y: auto; position: sticky; top: 0; }
.docs-nav-section { padding: 0 8px; margin-bottom: 4px; }
.docs-nav-section h4 { font-size: 10px; text-transform: uppercase; letter-spacing: 0.5px; color: var(--text-muted); padding: 12px 10px 6px; margin: 0; font-weight: 500; }
.docs-nav-item { display: block; padding: 6px 10px; border-radius: 4px; color: var(--text-secondary); font-size: 12px; cursor: pointer; transition: .15s; border-left: 2px solid transparent; margin-left: 2px; }
.docs-nav-item:hover { background: var(--bg-elevated); color: var(--text); }
.docs-nav-item.active { background: var(--bg-elevated); color: var(--text); font-weight: 500; border-left-color: var(--accent); }
a.docs-nav-item { text-decoration: none; }
.docs-content { flex: 1; padding: 16px; max-height: calc(100vh - 200px); overflow-y: auto; max-width: 100%; box-sizing: border-box; }
.docs-article { display: none; max-width: 100%; overflow-x: hidden; }
.docs-article.active { display: block; }
.docs-article h1 { font-size: 20px; margin-bottom: 6px; font-weight: 600; color: var(--text); word-wrap: break-word; }
.docs-article .docs-meta { display: flex; gap: 8px; font-size: 11px; color: var(--text-muted); margin-bottom: 24px; padding-bottom: 16px; border-bottom: 1px solid var(--border); flex-wrap: wrap; align-items: center; }
.docs-article h2 { font-size: 14px; margin: 28px 0 12px; padding-bottom: 8px; border-bottom: 1px solid var(--border); font-weight: 600; color: var(--text); }
.docs-article h3 { font-size: 13px; margin: 20px 0 8px; font-weight: 600; color: var(--text); }
.docs-article h4 { font-size: 12px; margin: 16px 0 6px; color: var(--text-secondary); font-weight: 600; }
.docs-article p { margin-bottom: 12px; color: var(--text-secondary); font-size: 13px; line-height: 1.7; word-wrap: break-word; overflow-wrap: break-word; }
.docs-article ul, .docs-article ol { margin: 0 0 12px 20px; font-size: 13px; }
.docs-article li { margin-bottom: 6px; color: var(--text-secondary); line-height: 1.6; }
.docs-article hr { border: none; border-top: 1px solid var(--border); margin: 20px 0; }
.docs-article table { width: 100%; border-collapse: collapse; margin: 12px 0 20px; font-size: 12px; display: block; overflow-x: auto; }
.docs-article th { background: var(--bg-elevated); padding: 8px 10px; text-align: left; font-weight: 500; border: 1px solid var(--border); font-size: 11px; }
.docs-article td { padding: 8px 10px; border: 1px solid var(--border); }
.docs-article code { background: var(--bg-elevated); padding: 2px 5px; border-radius: 3px; font-size: 11px; font-family: 'JetBrains Mono', 'SF Mono', Consolas, monospace; }
.docs-article pre { background: #1e293b; color: #e2e8f0; padding: 14px; border-radius: 6px; overflow-x: auto; margin: 12px 0; font-size: 11px; line-height: 1.5; max-width: 100%; box-sizing: border-box; }
.docs-article pre code { background: none; padding: 0; color: inherit; }
.docs-article blockquote { border-left: 2px solid var(--border); padding: 10px 16px; background: var(--bg-elevated); margin: 12px 0; border-radius: 0 4px 4px 0; }
.docs-article blockquote p { margin: 0; font-size: 12px; color: var(--text-secondary); }
.docs-badge { display: inline-block; padding: 2px 6px; border-radius: 3px; font-size: 10px; font-weight: 500; }
.badge-green { background: rgba(34, 197, 94, 0.1); color: #16a34a; }
.badge-blue { background: rgba(59, 130, 246, 0.1); color: #2563eb; }
.docs-disclaimer { background: var(--bg-elevated); border: 1px solid var(--border); padding: 12px; border-radius: 4px; margin: 16px 0; font-size: 12px; }
.docs-disclaimer strong { color: var(--text); }

/* Docs mobile select */
.docs-mobile-nav { display: block; margin-bottom: 16px; }
.docs-mobile-select { width: 100%; padding: 10px 12px; font-size: 13px; border: 1px solid var(--border); border-radius: 6px; background: var(--bg-card); color: var(--text); cursor: pointer; }

/* === LOADING STATE === */
.btn.loading { pointer-events: none; opacity: 0.7; }
.btn.loading::after { content: ""; width: 14px; height: 14px; border: 2px solid transparent; border-top-color: currentColor; border-radius: 50%; animation: spin 0.6s linear infinite; margin-left: 8px; }
@keyframes spin { to { transform: rotate(360deg); } }

/* === TOAST === */
.toast-container { position: fixed; top: 20px; right: 20px; z-index: 9999; display: flex; flex-direction: column; gap: 8px; }
.toast { padding: 12px 16px; border-radius: 8px; font-size: 14px; font-weight: 500; box-shadow: 0 4px 12px rgba(0,0,0,0.15); animation: slideIn 0.2s ease; }
.toast.success { background: var(--accent); color: white; }
.toast.error { background: var(--danger); color: white; }
.toast.info { background: var(--blue); color: white; }
@keyframes slideIn { from { transform: translateX(100%); opacity: 0; } to { transform: translateX(0); opacity: 1; } }

/* === MOBILE === */
.mobile-header { display: flex; position: fixed; top: 0; left: 0; right: 0; height: 56px; background: var(--bg-card); border-bottom: 1px solid var(--border); padding: 0 16px; align-items: center; justify-content: space-between; z-index: 100; }
.mobile-header .hamburger:first-child { order: 0; }
.mobile-header .logo { display: flex; align-items: center; gap: 8px; font-size: 16px; font-weight: 600; order: 1; }
.mobile-header .logo svg { width: 22px; height: 22px; }
.mobile-header .hamburger:last-child { order: 2; }
.hamburger { background: none; border: none; cursor: pointer; padding: 8px; color: var(--text); }
.hamburger svg { width: 24px; height: 24px; }
.sidebar.mobile-open { display: flex; flex-direction: column; position: fixed; z-index: 99; left: 0; top: 56px; height: calc(100vh - 56px); height: calc(100dvh - 56px); width: 260px; }
.mobile-overlay { display: none; position: fixed; inset: 0; background: rgba(0,0,0,0.5); z-index: 98; }
.mobile-overlay.active { display: block; }
/* === TELEMETRY & DASHBOARD ===
.page-header-left { flex: 1; }
@keyframes pulse-signal { 0%, 100% { opacity: 0.4; } 50% { opacity: 1; } }
.signal-pulse { animation: pulse-signal 0.8s infinite; }
*/
.signal-hash { display: flex; align-items: center; gap: 4px; font-family: 'JetBrains Mono', monospace; font-size: 12px; }
.signal-hash .label { color: var(--text-muted); }
.signal-hash .bytes { display: flex; gap: 2px; }
.signal-hash .byte { color: var(--accent); animation: pulse-byte 2s infinite; }
.signal-hash .ellipsis { color: var(--text-muted); }
.signal-hash .size { color: var(--text-muted); margin-left: 8px; font-size: 11px; }
@keyframes pulse-byte { 0%, 100% { opacity: 0.4; } 50% { opacity: 1; } }

/* Status Bar */
.status-bar { display: flex; justify-content: space-between; align-items: center; padding: 12px 16px; background: var(--bg-elevated); border-radius: 8px; border: 1px solid var(--border); margin-bottom: 24px; font-size: 13px; }
.status-item { display: flex; align-items: center; gap: 8px; color: var(--text-secondary); }
.status-item .signal-dot { width: 8px; height: 8px; background: var(--accent); border-radius: 50%; animation: pulse-signal 1.5s infinite; }
.status-label { color: var(--text-muted); font-size: 11px; text-transform: uppercase; letter-spacing: 0.5px; }
.utc-clock { font-family: 'JetBrains Mono', monospace; color: var(--text); }
@keyframes pulse-signal { 0%, 100% { opacity: 0.4; } 50% { opacity: 1; } }

/* === DASHBOARD ‚Äî CLEAN INSTITUTIONAL === */

/* Header */
/* === INSTITUTIONAL DASHBOARD === */

.dash-header-new { margin-bottom: 24px; }
.dash-title { font-size: 22px; font-weight: 500; margin: 0; color: var(--text); letter-spacing: -0.3px; }

/* Status Bar ‚Äî minimal, institutional */
.metrics-strip { display: flex; align-items: center; gap: 24px; padding: 12px 0; border-bottom: 1px solid var(--border); margin-bottom: 24px; flex-wrap: wrap; }
.metric-item { display: flex; align-items: center; gap: 8px; }
.metric-val { font-size: 14px; font-weight: 500; color: var(--text); }
.metric-val.mono { font-family: 'JetBrains Mono', monospace; font-size: 12px; font-weight: 400; }
.metric-lbl { font-size: 11px; color: var(--text-muted); }
.plan-switch-select { 
    background: var(--bg-card); 
    color: var(--text); 
    border: 1px solid var(--border); 
    border-radius: 4px; 
    padding: 4px 8px; 
    font-size: 12px; 
    cursor: pointer;
    font-family: inherit;
}
.plan-switch-select:hover { border-color: var(--primary); }
.plan-switch-select:focus { outline: none; border-color: var(--primary); }
.metric-sep { width: 1px; height: 16px; background: var(--border); }
.status-active { display: flex; align-items: center; gap: 6px; color: var(--text); }
.status-active .dot { width: 6px; height: 6px; background: var(--accent); border-radius: 50%; }

/* Signal Bars ‚Äî subtle */
.signal-bars { display: flex; align-items: flex-end; gap: 2px; height: 12px; }
.signal-bars .bar { width: 2px; background: var(--border); border-radius: 1px; }
.signal-bars .bar:nth-child(1) { height: 3px; }
.signal-bars .bar:nth-child(2) { height: 5px; }
.signal-bars .bar:nth-child(3) { height: 7px; }
.signal-bars .bar:nth-child(4) { height: 9px; }
.signal-bars .bar:nth-child(5) { height: 12px; }
.signal-bars .bar.active { background: var(--accent); opacity: 0.8; }

/* Grid ‚Äî clean */
.dash-grid-clean { display: grid; grid-template-columns: 1fr; gap: 20px; margin-bottom: 20px; }
.dash-card-clean { background: var(--bg-card); border-radius: 8px; padding: 20px; }
.card-head { font-size: 13px; font-weight: 500; color: var(--text); margin-bottom: 16px; }
.card-head-row { display: flex; justify-content: space-between; align-items: center; margin-bottom: 16px; }
.card-sub { font-size: 11px; color: var(--text-muted); }

/* Chart ‚Äî centered */
.chart-wrap { display: flex; justify-content: center; margin-bottom: 16px; }
.chart-wrap canvas { max-width: 100px; max-height: 100px; }
.chart-legend { display: flex; flex-wrap: wrap; gap: 8px 16px; font-size: 11px; color: var(--text-secondary); justify-content: center; }
.chart-legend-item { display: flex; align-items: center; gap: 6px; }
.chart-legend-dot { width: 8px; height: 8px; border-radius: 2px; }

/* Table ‚Äî clean */
.table-wrap { overflow-x: auto; margin: 0 -20px; padding: 0 20px; }
.eval-tbl { width: 100%; border-collapse: collapse; font-size: 13px; }
.eval-tbl th { text-align: left; padding: 10px 8px; font-size: 11px; color: var(--text-muted); text-transform: uppercase; letter-spacing: 0.3px; border-bottom: 1px solid var(--border); font-weight: 500; }
.eval-tbl td { padding: 12px 8px; border-bottom: 1px solid var(--border); }
.eval-tbl tr:last-child td { border-bottom: none; }
.empty-row { text-align: center; color: var(--text-muted); padding: 32px 8px !important; font-size: 13px; }
.hide-sm { display: none; }

/* Quick Start ‚Äî minimal */
.qs-block { background: var(--bg-card); border-radius: 8px; padding: 16px 20px; }
.qs-block summary { font-size: 13px; font-weight: 500; color: var(--text); cursor: pointer; list-style: none; }
.qs-block summary::-webkit-details-marker { display: none; }
.qs-block[open] summary { margin-bottom: 16px; }

/* Welcome Banner */
.welcome-banner { background: var(--bg-card); border: 1px solid var(--border); border-radius: 8px; padding: 16px 20px; margin-bottom: 24px; }
.welcome-banner.hidden { display: none; }
.welcome-content { display: flex; justify-content: space-between; align-items: center; gap: 16px; flex-wrap: wrap; }
.welcome-text { display: flex; flex-direction: column; gap: 4px; }
.welcome-text strong { font-size: 14px; font-weight: 600; }
.welcome-text span { font-size: 13px; color: var(--text-secondary); }
.welcome-actions { display: flex; align-items: center; gap: 8px; }
.welcome-dismiss { background: none; border: none; color: var(--text-muted); font-size: 18px; cursor: pointer; padding: 4px 8px; line-height: 1; }
.welcome-dismiss:hover { color: var(--text); }
.code { background: #1e293b; color: #e2e8f0; padding: 14px; border-radius: 6px; font-family: 'JetBrains Mono', monospace; font-size: 12px; line-height: 1.6; overflow-x: auto; margin: 0; max-width: 100%; box-sizing: border-box; }

/* ============================================
   RESPONSIVE
   ============================================ */

@media (min-width: 640px) {
    .main-content { padding: 24px; }
    
    .dash-header-new { display: flex; justify-content: space-between; align-items: center; }
    .dash-title { font-size: 24px; }
    .signal-hash { display: flex; }
    
    .metrics-strip { gap: 28px; }
    .metric-val { font-size: 15px; }
    
    .dash-grid-clean { grid-template-columns: 200px 1fr; gap: 20px; }
    .dash-card-clean { padding: 20px; }
    
    .chart-wrap canvas { max-width: 110px; max-height: 110px; }
    .chart-legend { font-size: 11px; gap: 10px 16px; }
    
    .eval-tbl { font-size: 13px; }
    .eval-tbl th { font-size: 11px; padding: 10px 8px; }
    .eval-tbl td { padding: 12px 8px; }
    .hide-sm { display: table-cell; }
    
    .qs-block { padding: 16px 20px; }
    .code { font-size: 12px; padding: 14px; }
    
    /* API Key page */
    .key-row { flex-direction: row; align-items: center; }
    .key-input { width: auto; flex: 1; font-size: 13px; }
    .key-meta { flex-direction: row; gap: 24px; font-size: 12px; }
    .code-block { font-size: 12px; padding: 16px; }
}

@media (min-width: 900px) {
    .sidebar { display: flex; flex-direction: column; }
    .sidebar-close { display: none !important; }
    .desktop-only { display: block; }
    .main-content { margin-left: 260px; padding: 32px 40px; padding-top: 32px; }
    .mobile-header { display: none; }
    
    .dash-header-new { margin-bottom: 28px; }
    .dash-title { font-size: 26px; }
    
    .metrics-strip { gap: 36px; border-bottom: none; padding: 0; margin-bottom: 28px; }
    .metric-val { font-size: 16px; }
    .metric-lbl { font-size: 12px; }
    
    .dash-grid-clean { grid-template-columns: 240px 1fr; gap: 24px; }
    .dash-card-clean { padding: 24px; border-radius: 10px; }
    .card-head { font-size: 14px; }
    
    .chart-wrap canvas { max-width: 130px; max-height: 130px; }
    
    .pricing-grid { grid-template-columns: repeat(3, 1fr); max-width: none; gap: 20px; }
    .tiers-grid { grid-template-columns: repeat(3, 1fr); max-width: none; gap: 20px; }
    .tier-card { padding: 28px; border-radius: 10px; }
    .pricing-card { padding: 28px 24px; border-radius: 14px; }
    .docs-sidebar { display: block; }
    .docs-content { padding: 24px 32px; }
    .docs-article { max-width: 800px; }
    .docs-mobile-nav { display: none; }
}

@media (min-width: 1200px) {
    .main-content { padding: 40px 48px; }
    
    .metrics-strip { gap: 44px; }
    .metric-val { font-size: 17px; }
    
    .dash-grid-clean { grid-template-columns: 260px 1fr; gap: 28px; }
    .dash-card-clean { padding: 28px; }
    
    .chart-wrap canvas { max-width: 150px; max-height: 150px; }
}

/* Risk badges */
.risk-badge { display: inline-block; padding: 2px 6px; border-radius: 4px; font-size: 10px; font-weight: 600; }
.risk-badge.low { background: rgba(34, 197, 94, 0.15); color: #22c55e; }
.risk-badge.medium { background: rgba(245, 158, 11, 0.15); color: #f59e0b; }
.risk-badge.high { background: rgba(239, 68, 68, 0.15); color: #ef4444; }

/* === REFERENCE PAGE === */
.ref-tabs { display: flex; gap: 4px; margin-bottom: 20px; flex-wrap: wrap; }
.ref-tab { padding: 8px 16px; background: var(--bg-elevated); border: 1px solid var(--border); border-radius: 6px; color: var(--text-secondary); cursor: pointer; font-size: 13px; font-weight: 500; transition: all 0.15s; }
.ref-tab:hover { background: var(--bg-card); color: var(--text); }
.ref-tab.active { background: var(--accent-subtle); border-color: var(--accent); color: var(--accent); }
.ref-content { display: none; }
.ref-content.active { display: block; }
.ref-status { display: inline-flex; align-items: center; gap: 6px; padding: 4px 10px; border-radius: 4px; font-size: 12px; font-weight: 500; }
.ref-status.active { background: rgba(34, 197, 94, 0.15); color: #22c55e; }
.ref-status.archived { background: rgba(239, 68, 68, 0.15); color: #ef4444; }
.ref-status.frozen { background: rgba(59, 130, 246, 0.15); color: #3b82f6; }
.ref-action-btn { padding: 4px 8px; font-size: 11px; border-radius: 4px; cursor: pointer; transition: all 0.15s; }
.ref-action-btn.archive { background: var(--danger-subtle); color: var(--danger); border: 1px solid var(--danger); }
.ref-action-btn.restore { background: var(--accent-subtle); color: var(--accent); border: 1px solid var(--accent); }
.ref-action-btn.export { background: var(--blue-subtle); color: var(--blue); border: 1px solid var(--blue); }
.ref-action-btn:hover { opacity: 0.8; }
.table-header { display: flex; align-items: center; gap: 12px; margin-bottom: 16px; flex-wrap: wrap; }
</style>
</head>
<body>

<!-- TOAST -->
<div class="toast-container" id="toast-container"></div>

<!-- MOBILE HEADER -->
<div class="mobile-header">
    <button class="hamburger" onclick="toggleMobile()">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><line x1="3" y1="12" x2="21" y2="12"/><line x1="3" y1="6" x2="21" y2="6"/><line x1="3" y1="18" x2="21" y2="18"/></svg>
    </button>
    <a href="/" class="logo" style="text-decoration: none; color: inherit;">
        <svg width="24" height="24" viewBox="0 0 36 36" fill="none">
            <circle cx="18" cy="18" r="17" fill="white"/>
            <path d="M16 10L20 10L20 26L16 26L16 14L13 14L13 10L16 10Z" fill="#0a0a0a"/>
        </svg>
        <span>ONTO</span>
    </a>
    <button class="hamburger" onclick="toggleTheme()" title="Theme">
        <svg id="theme-icon-mobile" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg>
    </button>
</div>
<div class="mobile-overlay" id="mobile-overlay" onclick="toggleMobile()"></div>

<!-- AUTH SCREEN -->
<div class="auth-container" id="auth-screen">
    <div class="auth-card">
        <div class="auth-logo">
            <svg width="36" height="36" viewBox="0 0 36 36" fill="none">
                <circle cx="18" cy="18" r="17" fill="white"/>
                <path d="M16 10L20 10L20 26L16 26L16 14L13 14L13 10L16 10Z" fill="#0a0a0a"/>
            </svg>
            <span>ONTO</span>
        </div>
        
        <!-- LOGIN FORM -->
        <div id="login-form">
            <h1 class="auth-title">Welcome back</h1>
            <p class="auth-subtitle">Sign in to your account</p>
            
            <div class="form-group">
                <label class="form-label">Email</label>
                <input type="email" class="form-input" id="login-email" placeholder="you@company.com">
            </div>
            <div class="form-group">
                <label class="form-label">Password</label>
                <div class="password-wrapper">
                    <input type="password" class="form-input" id="login-password" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢">
                    <button type="button" class="password-toggle" onclick="togglePassword('login-password', this)">üëÅ</button>
                </div>
            </div>
            <button class="btn btn-primary" id="login-btn" onclick="handleLogin(this)">Sign In</button>
            <p class="auth-switch">Don't have an account? <a onclick="showRegister()">Create one</a></p>
        </div>
        
        <!-- REGISTER FORM -->
        <div id="register-form" class="hidden">
            <h1 class="auth-title">Create Account</h1>
            <p class="auth-subtitle">Start with ONTO for free</p>
            
            <div class="form-group">
                <label class="form-label">Full Name</label>
                <input type="text" class="form-input" id="reg-name" placeholder="John Doe">
            </div>
            <div class="form-group">
                <label class="form-label">Email</label>
                <input type="email" class="form-input" id="reg-email" placeholder="you@company.com">
            </div>
            <div class="form-group">
                <label class="form-label">Password</label>
                <div class="password-wrapper">
                    <input type="password" class="form-input" id="reg-password" placeholder="Min 8 characters">
                    <button type="button" class="password-toggle" onclick="togglePassword('reg-password', this)">üëÅ</button>
                </div>
            </div>
            
            <!-- TERMS SCROLL -->
            <div class="terms-container">
                <h3>ONTO Gold Asymmetric AI License v5.1</h3>
                <table>
                    <tr><th>Use</th><th>Status</th></tr>
                    <tr><td>Read, study, cite, research, evaluate</td><td>‚úÖ Free</td></tr>
                    <tr><td>Deploy, integrate, commercialize, RAG</td><td>‚ùå Requires license</td></tr>
                </table>
                
                <h3>1. Primary Source</h3>
                <p>The primary source of ONTO consists of: Canonical ONTO GitHub repositories and https://ontostandard.org. Attribution to BOTH sources is mandatory.</p>
                
                <h3>2. Human Use</h3>
                <p>Human reading, study, citation, discussion, critique, and academic analysis are permitted without restriction, provided explicit attribution to the primary source is included.</p>
                
                <h3>3. Safe Harbor</h3>
                <p>Any non-deployed use that explicitly attributes the ONTO primary source is permitted. Safe Harbor applies provided that:</p>
                <ul>
                    <li>no trained model is deployed or exposed</li>
                    <li>no model is placed on the market</li>
                    <li>no economic benefit is derived</li>
                </ul>
                
                <h3>4. Conditional AI Training</h3>
                <p>AI systems may train on ONTO for evaluation and research. Such training does not grant any right to deploy, integrate, or commercialize.</p>
                <p><strong>Training enables understanding only. Application creates value.</strong></p>
                
                <h3>5. RAG Clause</h3>
                <p>Use in RAG systems, vector databases, semantic search, or real-time retrieval constitutes deployment and requires a license.</p>
                
                <h3>6. Termination</h3>
                <p>Use outside Safe Harbor without a license automatically terminates all permissions.</p>
                
                <h3>Privacy Policy</h3>
                <p>We collect minimal data necessary to provide the service: email, name, and usage metrics. Data is processed in accordance with GDPR. We never sell your data to third parties.</p>
                
                <p style="margin-top: 16px;"><strong>Full license:</strong> <a href="https://ontostandard.org" target="_blank">https://ontostandard.org</a></p>
            </div>
            
            <div class="checkbox-group">
                <input type="checkbox" id="terms-agree">
                <label for="terms-agree">I agree to the <a href="https://ontostandard.org/terms" target="_blank">Terms of Service</a> and <a href="https://ontostandard.org/privacy" target="_blank">Privacy Policy</a></label>
            </div>
            
            <button class="btn btn-primary" id="register-btn" onclick="handleRegister(this)" disabled>Create Account</button>
            <p class="auth-switch">Already have an account? <a onclick="showLogin()">Sign in</a></p>
        </div>
        
        <!-- EMAIL VERIFICATION PENDING -->
        <div id="verify-pending" class="hidden">
            <div style="text-align: center; margin-bottom: 24px;">
                <svg width="64" height="64" viewBox="0 0 24 24" fill="none" stroke="var(--accent)" stroke-width="1.5">
                    <path d="M3 8l7.89 5.26a2 2 0 002.22 0L21 8M5 19h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z"/>
                </svg>
            </div>
            <h1 class="auth-title">Check your email</h1>
            <p class="auth-subtitle">We sent a verification link to</p>
            <p style="color: var(--text); font-weight: 600; margin: 8px 0 24px;" id="verify-email-display"><a href="/cdn-cgi/l/email-protection" class="__cf_email__" data-cfemail="e1929491918e9395a18e8f958e9295808f85809385cf8e9386">[email&#160;protected]</a></p>
            <p style="color: var(--text-muted); font-size: 14px; line-height: 1.6;">Click the link in the email to verify your account. The link expires in 24 hours.</p>
            <div style="margin-top: 24px; padding-top: 24px; border-top: 1px solid var(--border);">
                <p style="color: var(--text-muted); font-size: 13px;">Didn't receive the email?</p>
                <button class="btn btn-secondary" style="margin-top: 12px;" onclick="resendVerification()">Resend verification email</button>
            </div>
            <p class="auth-switch" style="margin-top: 24px;"><a onclick="showLogin()">Back to sign in</a></p>
        </div>
        
        <!-- EMAIL VERIFIED SUCCESS -->
        <div id="verify-success" class="hidden">
            <div style="text-align: center; margin-bottom: 24px;">
                <svg width="64" height="64" viewBox="0 0 24 24" fill="none" stroke="var(--accent)" stroke-width="1.5">
                    <path d="M22 11.08V12a10 10 0 11-5.93-9.14"/>
                    <polyline points="22 4 12 14.01 9 11.01"/>
                </svg>
            </div>
            <h1 class="auth-title">Email verified!</h1>
            <p class="auth-subtitle">Your account is ready. You can now sign in.</p>
            <button class="btn btn-primary" style="margin-top: 24px;" onclick="showLogin()">Sign In</button>
        </div>
    </div>
</div>

<!-- DASHBOARD -->
<div class="dashboard" id="dashboard">
    <aside class="sidebar">
        <div class="sidebar-header">
            <a href="#" onclick="showSection('dashboard'); return false;" class="sidebar-logo" style="text-decoration: none; color: inherit;">
                <svg width="32" height="32" viewBox="0 0 36 36" fill="none">
                    <circle cx="18" cy="18" r="17" fill="white"/>
                    <path d="M16 10L20 10L20 26L16 26L16 14L13 14L13 10L16 10Z" fill="#0a0a0a"/>
                </svg>
                <span>ONTO</span>
            </a>
            <div class="sidebar-header-actions">
                <button class="sidebar-action-btn desktop-only" onclick="toggleTheme()" title="Theme">
                    <svg id="theme-icon-svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg>
                </button>
                <button class="sidebar-close" onclick="toggleMobile()">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><line x1="18" y1="6" x2="6" y2="18"/><line x1="6" y1="6" x2="18" y2="18"/></svg>
                </button>
            </div>
        </div>
        <nav class="sidebar-nav">
            <div class="nav-item active" onclick="showPage('dashboard', this)">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="3" y="3" width="7" height="7"/><rect x="14" y="3" width="7" height="7"/><rect x="14" y="14" width="7" height="7"/><rect x="3" y="14" width="7" height="7"/></svg>
                Dashboard
            </div>
            <div class="nav-item" onclick="showPage('api', this)">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M12 2L2 7l10 5 10-5-10-5z"/><path d="M2 17l10 5 10-5"/><path d="M2 12l10 5 10-5"/></svg>
                API Keys
            </div>
            <div class="nav-item" onclick="showPage('docs', this)">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M14 2H6a2 2 0 00-2 2v16a2 2 0 002 2h12a2 2 0 002-2V8z"/><polyline points="14,2 14,8 20,8"/><line x1="16" y1="13" x2="8" y2="13"/><line x1="16" y1="17" x2="8" y2="17"/></svg>
                Specifications
            </div>
            <div class="nav-divider"></div>
            <div class="nav-item" onclick="showPage('billing', this)">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="1" y="4" width="22" height="16" rx="2"/><line x1="1" y1="10" x2="23" y2="10"/></svg>
                Billing
            </div>
            <div class="nav-item" onclick="showPage('settings', this)">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="3"/><path d="M12 1v4M12 19v4M4.22 4.22l2.83 2.83M16.95 16.95l2.83 2.83M1 12h4M19 12h4M4.22 19.78l2.83-2.83M16.95 7.05l2.83-2.83"/></svg>
                Account
            </div>
            <div class="nav-item" id="nav-reference" onclick="showReferencePage(this)" style="display:none;">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M2 3h6a4 4 0 0 1 4 4v14a3 3 0 0 0-3-3H2z"/><path d="M22 3h-6a4 4 0 0 0-4 4v14a3 3 0 0 1 3-3h7z"/></svg>
                Reference
            </div>
            <div class="nav-item" onclick="handleLogout()" style="color: var(--text-muted);">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M9 21H5a2 2 0 01-2-2V5a2 2 0 012-2h4"/><polyline points="16,17 21,12 16,7"/><line x1="21" y1="12" x2="9" y2="12"/></svg>
                Sign Out
            </div>
        </nav>
        <div class="sidebar-footer">
            <div class="sidebar-user">
                <div class="user-avatar" id="user-avatar">J</div>
                <div class="user-info">
                    <div class="user-name" id="user-name">John Doe</div>
                    <div class="user-tier" id="user-plan">Open</div>
                </div>
            </div>
        </div>
    </aside>
    
    <main class="main-content">
        <!-- DASHBOARD PAGE -->
        <div class="page active" id="page-dashboard">
            <!-- Header -->
            <div class="dash-header-new">
                <h1 class="dash-title">Dashboard</h1>
                <div class="signal-hash" id="signal-hash" title="ONTO Signal ‚Äî real-time epistemic state hash">
                    <span class="label">œÉ(t) =</span>
                    <div class="bytes" id="signal-bytes"></div>
                </div>
            </div>
            
            <!-- Status Bar -->
            <div class="metrics-strip">
                <div class="metric-item" title="Total API calls this period">
                    <span class="metric-lbl">Calls</span>
                    <span class="metric-val" id="stat-api-calls">0</span>
                </div>
                <div class="metric-item" title="Request rate limit">
                    <span class="metric-lbl">Rate</span>
                    <span class="metric-val" id="stat-rate">1/hour</span>
                </div>
                <div class="metric-item" title="Subscription expires">
                    <span class="metric-lbl">Expires</span>
                    <span class="metric-val" id="stat-expires">‚Äî</span>
                </div>
                <div class="metric-item hidden" id="plan-switcher" title="Switch active plan">
                    <span class="metric-lbl">Use</span>
                    <select class="plan-switch-select" id="plan-switch" onchange="switchActivePlan(this.value)">
                        <option value="enterprise">Critical ‚àû</option>
                        <option value="business">Pro 1/8.64s</option>
                    </select>
                </div>
                <div class="metric-item" title="Account status">
                    <span class="metric-val status-active"><span class="dot"></span>Active</span>
                </div>
                <div class="metric-item" title="Signal strength ‚Äî data freshness indicator">
                    <div class="signal-bars" id="signal-bars">
                        <span class="bar active"></span>
                        <span class="bar active"></span>
                        <span class="bar"></span>
                        <span class="bar"></span>
                        <span class="bar"></span>
                    </div>
                </div>
                <div class="metric-item" title="Current UTC time">
                    <span class="metric-val mono" id="utc-clock">00:00:00</span>
                    <span class="metric-lbl">UTC</span>
                </div>
            </div>
            
            <!-- Welcome Banner (new users) -->
            <div class="welcome-banner" id="welcome-banner">
                <div class="welcome-content">
                    <div class="welcome-text">
                        <strong>Welcome to ONTO</strong>
                        <span>Get started by creating your first API key and making an evaluation request.</span>
                    </div>
                    <div class="welcome-actions">
                        <button class="btn-minimal" onclick="showPage('api', document.querySelector('.nav-item[onclick*=api]'))">Get API Key</button>
                        <button class="btn-minimal" onclick="showPage('docs', document.querySelector('.nav-item[onclick*=docs]'))">Read Docs</button>
                        <button class="welcome-dismiss" onclick="dismissWelcome()" title="Dismiss">√ó</button>
                    </div>
                </div>
            </div>
            
            <!-- Two Column Grid -->
            <div class="dash-grid-clean">
                <!-- Industry -->
                <div class="dash-card-clean">
                    <div class="card-head">Industry Distribution</div>
                    <div class="chart-wrap">
                        <canvas id="industry-canvas" width="120" height="120"></canvas>
                    </div>
                    <div class="chart-legend" id="industry-legend"></div>
                </div>
                
                <!-- Evaluations -->
                <div class="dash-card-clean">
                    <div class="card-head-row">
                        <span class="card-head">Recent Evaluations</span>
                        <span class="card-sub">Last 5</span>
                    </div>
                    <div class="table-wrap">
                        <table class="eval-tbl">
                            <thead>
                                <tr>
                                    <th>ID</th>
                                    <th>Risk</th>
                                    <th>Level</th>
                                    <th class="hide-sm">Time</th>
                                </tr>
                            </thead>
                            <tbody id="eval-tbody">
                                <tr>
                                    <td colspan="4" class="empty-row">No evaluations yet</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
            
            <!-- Quick Start -->
            <details class="qs-block">
                <summary>Quick Start</summary>
                <pre class="code"><code>pip install onto-standard

from onto import Client
client = Client(api_key="your_api_key")
result = client.evaluate(output, confidence=0.85)
print(result.risk_score)</code></pre>
            </details>
        </div>
        
        <!-- API KEYS PAGE -->
        <div class="page" id="page-api">
            <div class="page-header-clean">
                <h1 class="page-title">Access Credentials</h1>
            </div>
            
            <div class="section-block">
                <div class="section-label">API Key</div>
                <div class="key-row">
                    <input type="password" class="key-input" id="api-key-display" value="onto_sk_demo_key_12345" readonly>
                    <div class="key-buttons">
                        <button class="btn-minimal" onclick="toggleApiKeyVisibility()" id="toggle-key-btn">Show</button>
                        <button class="btn-minimal" onclick="copyApiKey(this)">Copy</button>
                    </div>
                </div>
                <div class="key-meta">
                    <span>Created: Jan 31, 2026</span>
                    <span>Last used: 2 hours ago</span>
                    <span>Requests today: 47</span>
                </div>
            </div>
            
            <div class="section-block">
                <div class="section-label">Key Management</div>
                <p class="section-text">Regenerating will immediately invalidate the current key.</p>
                <button class="btn-danger-outline" onclick="regenerateApiKey(this)">Regenerate Key</button>
            </div>
            
            <div class="section-block">
                <div class="section-label">Integration</div>
                <pre class="code-block"><code>pip install onto-standard

from onto import Client
client = Client(api_key="your_api_key")
result = client.evaluate(output, confidence=0.85)</code></pre>
                <p class="section-footnote">Complete reference at <a href="https://github.com/nickarstrong/onto-standard" target="_blank">github.com/nickarstrong/onto-standard</a></p>
            </div>
        </div>
        
        <!-- SETTINGS PAGE -->
        <div class="page" id="page-settings">
            <div class="page-header-clean">
                <h1 class="page-title">Account</h1>
            </div>
            
            <div class="section-block">
                <div class="section-label">Identity</div>
                <div class="info-row">
                    <span class="info-key">Name</span>
                    <span class="info-val" id="settings-name">John Doe</span>
                    <span class="info-action" onclick="editProfile()">Edit</span>
                </div>
                <div class="info-row">
                    <span class="info-key">Email</span>
                    <span class="info-val" id="settings-email"><a href="/cdn-cgi/l/email-protection" class="__cf_email__" data-cfemail="cdbeb8bdbda2bfb98da2a3b9a2beb9aca3a9acbfa9e3a2bfaa">[email&#160;protected]</a></span>
                </div>
                <div class="info-row">
                    <span class="info-key">Type</span>
                    <span class="info-val" id="settings-account-type">Individual</span>
                </div>
            </div>
            
            <div class="section-block">
                <div class="section-label">Organization</div>
                <div id="company-not-registered">
                    <p class="section-text">No organization registered. Required for institutional access tier.</p>
                    <button class="btn-minimal" onclick="openCompanyModal()">Register Organization</button>
                </div>
                <div id="company-registered" class="hidden">
                    <div class="info-row">
                        <span class="info-key">Name</span>
                        <span class="info-val" id="company-name">‚Äî</span>
                        <span class="info-action" onclick="openCompanyModal()">Edit</span>
                    </div>
                    <div class="info-row">
                        <span class="info-key">Industry</span>
                        <span class="info-val" id="company-industry">‚Äî</span>
                    </div>
                    <div class="info-row">
                        <span class="info-key">Registration</span>
                        <span class="info-val" id="company-reg">‚Äî</span>
                    </div>
                    <div class="info-row">
                        <span class="info-key">Status</span>
                        <span class="info-val status-active"><span class="dot"></span>Verified</span>
                    </div>
                </div>
            </div>
            
            <div class="section-block" id="subscription-block">
                <div class="section-label">Subscription</div>
                <div id="subscription-none">
                    <p class="section-text">No active subscription. Using Free tier (1 request/hour).</p>
                    <button class="btn-minimal" onclick="showPage('billing')">View Plans</button>
                </div>
                <div id="subscription-active" class="hidden">
                    <div class="info-row">
                        <span class="info-key">Active Plan</span>
                        <span class="info-val" id="sub-plan">‚Äî</span>
                    </div>
                    <div class="info-row">
                        <span class="info-key">Rate Limit</span>
                        <span class="info-val" id="sub-rate">‚Äî</span>
                    </div>
                    <div class="info-row" id="sub-critical-row">
                        <span class="info-key">Critical</span>
                        <span class="info-val" id="sub-critical-days">‚Äî</span>
                    </div>
                    <div class="info-row" id="sub-pro-row">
                        <span class="info-key">Professional</span>
                        <span class="info-val" id="sub-pro-days">‚Äî</span>
                    </div>
                    <div class="info-row">
                        <span class="info-key">All Expires</span>
                        <span class="info-val" id="sub-expires">‚Äî</span>
                    </div>
                    <div class="info-row">
                        <span class="info-key">Total Paid</span>
                        <span class="info-val" id="sub-total">‚Äî</span>
                    </div>
                    <button class="btn-minimal" onclick="showPage('billing')" style="margin-top: 12px;">Extend Subscription</button>
                </div>
            </div>
            
            <div class="section-block">
                <div class="section-label">Documents</div>
                <div class="doc-row">
                    <span class="doc-name">Specifications & Policies</span>
                    <span class="doc-link" onclick="showPage('docs')">View</span>
                </div>
                <div class="doc-row" id="invoice-row">
                    <span class="doc-name">Invoice</span>
                    <span class="doc-status" id="invoice-status">No active subscription</span>
                    <span class="doc-link hidden" id="invoice-download" onclick="downloadInvoice()">Download</span>
                </div>
            </div>
            
            <div class="section-block">
                <div class="section-label">Support</div>
                <div class="info-row">
                    <span class="info-key">General</span>
                    <a class="info-val" href="/cdn-cgi/l/email-protection#95e6e0e5e5fae7e1d5fafbe1fae6e1f4fbf1f4e7f1bbfae7f2"><span class="__cf_email__" data-cfemail="7b080e0b0b14090f3b14150f14080f1a151f1a091f5514091c">[email&#160;protected]</span></a>
                </div>
                <div class="info-row">
                    <span class="info-key">Sales</span>
                    <a class="info-val" href="/cdn-cgi/l/email-protection#3d4e5c51584e7d525349524e495c53595c4f5913524f5a"><span class="__cf_email__" data-cfemail="4b382a272e380b24253f24383f2a252f2a392f6524392c">[email&#160;protected]</span></a>
                </div>
                <div class="info-row">
                    <span class="info-key">Billing</span>
                    <a class="info-val" href="/cdn-cgi/l/email-protection#53313a3f3f3a3d34133c3d273c2027323d373221377d3c2134"><span class="__cf_email__" data-cfemail="80e2e9ecece9eee7c0efeef4eff3f4e1eee4e1f2e4aeeff2e7">[email&#160;protected]</span></a>
                </div>
            </div>
        </div>
        
        <!-- BILLING PAGE -->
        <div class="page" id="page-billing">
            <div class="page-header-clean">
                <h1 class="page-title">Access Tiers</h1>
            </div>
            
            <div class="tiers-grid">
                <!-- OPEN -->
                <div class="tier-card" id="card-free">
                    <div class="tier-name">Open</div>
                    <div class="tier-price">$0</div>
                    <div class="tier-desc">Research & evaluation</div>
                    <ul class="tier-list">
                        <li>1 request/hour</li>
                        <li>+1 hour signal delay</li>
                        <li>Community support</li>
                        <li>Attribution required</li>
                    </ul>
                    <button class="btn-tier current" id="btn-free" disabled>Current</button>
                </div>
                
                <!-- PROFESSIONAL -->
                <div class="tier-card" id="card-business">
                    <div class="tier-name">Professional</div>
                    <div class="tier-price">$1,500<span>/month</span></div>
                    <div class="tier-desc">Commercial deployment</div>
                    <ul class="tier-list">
                        <li>1 request/8.64s</li>
                        <li>Real-time signal</li>
                        <li>99.5% SLA</li>
                        <li>Business hours support</li>
                    </ul>
                    <button class="btn-tier" id="btn-business" onclick="contactSales()">Select</button>
                </div>
                
                <!-- CRITICAL -->
                <div class="tier-card" id="card-enterprise">
                    <div class="tier-name">Critical</div>
                    <div class="tier-price">$100,000<span>/year</span></div>
                    <div class="tier-desc">Critical infrastructure</div>
                    <ul class="tier-list">
                        <li>Unlimited requests</li>
                        <li>Dedicated signal stream</li>
                        <li>99.99% SLA</li>
                        <li>24/7 priority support</li>
                    </ul>
                    <button class="btn-tier" id="btn-enterprise" onclick="contactSales()">Select</button>
                    <button class="btn-tier-secondary" onclick="contactSales()">Contact</button>
                </div>
            </div>
            
            <p class="section-footnote" style="text-align: center; margin-top: 24px;">
                Invoice payment requires registered organization. <a href="#" onclick="showPage('settings')">Account settings</a>
            </p>
        </div>
        <div class="page" id="page-docs">
            <div class="page-header-clean">
                <h1 class="page-title">Specifications</h1>
            </div>
            
            <div class="docs-mobile-nav">
                <a href="/documentation.html" target="_blank" class="btn btn-secondary" style="width: 100%; text-align: center; text-decoration: none;">
                    View All Documentation ‚Üó
                </a>
            </div>
            
            <div class="docs-container">
                <div class="docs-sidebar">
                    <div class="docs-nav-section">
                        <h4>Standard</h4>
                        <div class="docs-nav-item active" onclick="showDoc('standard', this)">ONTO-ERS</div>
                    </div>
                    <div class="docs-nav-section">
                        <h4>Specifications</h4>
                        <a class="docs-nav-item" href="/layer-spec.html" target="_blank">Layer Specification ‚Üó</a>
                        <a class="docs-nav-item" href="/regulatory.html" target="_blank">Regulatory Matrix ‚Üó</a>
                    </div>
                    <div class="docs-nav-section">
                        <h4>Governance</h4>
                        <a class="docs-nav-item" href="/charter.html" target="_blank">Foundation Charter ‚Üó</a>
                        <a class="docs-nav-item" href="/council.html" target="_blank">Standards Council ‚Üó</a>
                    </div>
                    <div class="docs-nav-section">
                        <h4>Legal</h4>
                        <a class="docs-nav-item" href="/license.html" target="_blank">License ‚Üó</a>
                        <a class="docs-nav-item" href="/terms.html" target="_blank">Terms of Service ‚Üó</a>
                        <a class="docs-nav-item" href="/privacy.html" target="_blank">Privacy Policy ‚Üó</a>
                    </div>
                </div>
                
                <div class="docs-content">
<article class="docs-article active" id="docs-standard">
  <h1>ONTO Epistemic Risk Standard (ONTO-ERS)</h1>
  <div class="docs-meta">
    <span class="docs-badge badge-green">v10.0</span>
    <span class="docs-badge badge-blue">Published</span>
    <span>ONTO-SPEC-001</span>
    <span>January 2026</span>
  </div>

<h2 id="abstract">Abstract</h2>
<p>This document specifies the ONTO Epistemic Risk Standard (ONTO-ERS),
a framework for measuring and certifying the epistemic calibration of
artificial intelligence systems. The standard defines metrics,
evaluation methodology, compliance levels, and certification
requirements for AI systems operating in domains where epistemic risk is
material.</p>
<hr />
<h2 id="introduction">1. Introduction</h2>
<h3 id="purpose">1.1 Purpose</h3>
<p>ONTO-ERS provides a standardized approach for:</p>
<ol type="1">
<li>Quantifying epistemic risk in AI systems</li>
<li>Establishing compliance thresholds for deployment contexts</li>
<li>Certifying AI system calibration</li>
<li>Supporting regulatory compliance</li>
</ol>
<h3 id="scope">1.2 Scope</h3>
<p>This standard applies to AI systems that:</p>
<ul>
<li>Generate natural language responses</li>
<li>Express confidence in outputs</li>
<li>Operate in domains with verification requirements</li>
<li>Are subject to regulatory oversight</li>
</ul>
<h3 id="normative-references">1.3 Normative References</h3>
<table>
<thead>
<tr class="header">
<th>Reference</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>ONTO-42001</td>
<td>Metrics Specification</td>
</tr>
<tr class="even">
<td>ONTO-42003</td>
<td>Liability Protocol</td>
</tr>
<tr class="odd">
<td>ONTO-BENCH</td>
<td>Benchmark Dataset Specification</td>
</tr>
</tbody>
</table>
<h3 id="terms-and-definitions">1.4 Terms and Definitions</h3>
<table>
<colgroup>
<col style="width: 33%" />
<col style="width: 66%" />
</colgroup>
<thead>
<tr class="header">
<th>Term</th>
<th>Definition</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><strong>Epistemic Risk</strong></td>
<td>Divergence between expressed confidence and actual accuracy</td>
</tr>
<tr class="even">
<td><strong>Calibration</strong></td>
<td>Alignment of confidence scores with empirical accuracy</td>
</tr>
<tr class="odd">
<td><strong>U-Recall</strong></td>
<td>Unknown Detection Rate</td>
</tr>
<tr class="even">
<td><strong>ECE</strong></td>
<td>Expected Calibration Error</td>
</tr>
<tr class="odd">
<td><strong>KNOWN</strong></td>
<td>Question with established, verifiable answer</td>
</tr>
<tr class="even">
<td><strong>UNKNOWN</strong></td>
<td>Question with no established answer</td>
</tr>
<tr class="odd">
<td><strong>CONTRADICTION</strong></td>
<td>Question with conflicting authoritative answers</td>
</tr>
</tbody>
</table>
<h3 id="scope-limitations">1.5 Scope and Limitations</h3>
<blockquote>
<p><strong>"Thermometer, not Doctor"</strong> ‚Äî ONTO measures epistemic calibration but does not improve, fix, or remediate AI systems.</p>
</blockquote>
<h4>What ONTO Does</h4>
<table>
<thead>
<tr class="header">
<th>Function</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Measures Calibration (ECE)</td>
<td>Quantifies alignment between confidence and accuracy</td>
</tr>
<tr class="even">
<td>Measures Uncertainty (U-Recall)</td>
<td>Evaluates ability to recognize unknowns</td>
</tr>
<tr class="odd">
<td>Computes Risk Score</td>
<td>Provides composite epistemic risk metric</td>
</tr>
<tr class="even">
<td>Issues Certificates</td>
<td>Cryptographically signs evaluation results (ED25519)</td>
</tr>
</tbody>
</table>
<h4>What ONTO Does NOT Do</h4>
<table>
<thead>
<tr class="header">
<th>Limitation</th>
<th>Explanation</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Does not improve models</td>
<td>ONTO is a measurement protocol, not a training tool</td>
</tr>
<tr class="even">
<td>Does not fix hallucinations</td>
<td>Remediation is the client's responsibility</td>
</tr>
<tr class="odd">
<td>Does not guarantee quality</td>
<td>Certificate attests to calibration, not correctness</td>
</tr>
<tr class="even">
<td>Does not assume liability</td>
<td>Client retains responsibility for model deployment</td>
</tr>
</tbody>
</table>
<div class="docs-disclaimer">
<strong>Important:</strong> ONTO certification confirms that an AI system's confidence expressions align with its empirical accuracy at the time of evaluation. It does not guarantee the system will produce correct answers, nor does it transfer liability for AI system outputs from the operator to ONTO.
</div>
<hr />
<h2 id="core-metrics">2. Core Metrics</h2>
<h3 id="unknown-detection-rate-u-recall">2.1 Unknown Detection Rate
(U-Recall)</h3>
<h4 id="definition">2.1.1 Definition</h4>
<p>U-Recall measures the proportion of genuinely unanswerable questions
correctly identified as unanswerable by the system.</p>
<h4 id="formula">2.1.2 Formula</h4>
<pre><code>U-Recall = TP_unknown / (TP_unknown + FN_unknown)</code></pre>
<p>Where: - <code>TP_unknown</code> = True positives (UNKNOWN correctly
classified) - <code>FN_unknown</code> = False negatives (UNKNOWN
incorrectly classified as KNOWN)</p>
<h4 id="interpretation">2.1.3 Interpretation</h4>
<table>
<thead>
<tr class="header">
<th>Score</th>
<th>Classification</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>‚â•0.70</td>
<td>Excellent</td>
</tr>
<tr class="even">
<td>‚â•0.50</td>
<td>Adequate</td>
</tr>
<tr class="odd">
<td>‚â•0.30</td>
<td>Minimum</td>
</tr>
<tr class="even">
<td>&lt;0.30</td>
<td>Insufficient</td>
</tr>
</tbody>
</table>
<h3 id="expected-calibration-error-ece">2.2 Expected Calibration Error
(ECE)</h3>
<h4 id="definition-1">2.2.1 Definition</h4>
<p>ECE quantifies the average absolute difference between expressed
confidence and empirical accuracy across confidence bins.</p>
<h4 id="formula-1">2.2.2 Formula</h4>
<pre><code>ECE = Œ£ (n_b / N) √ó |acc(b) - conf(b)|</code></pre>
<p>Where: - <code>B</code> = Number of bins (default: 10) -
<code>n_b</code> = Number of samples in bin b - <code>N</code> = Total
number of samples - <code>acc(b)</code> = Accuracy of predictions in bin
b - <code>conf(b)</code> = Mean confidence of predictions in bin b</p>
<h4 id="interpretation-1">2.2.3 Interpretation</h4>
<table>
<thead>
<tr class="header">
<th>Score</th>
<th>Classification</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>‚â§0.10</td>
<td>Excellent</td>
</tr>
<tr class="even">
<td>‚â§0.15</td>
<td>Good</td>
</tr>
<tr class="odd">
<td>‚â§0.20</td>
<td>Adequate</td>
</tr>
<tr class="even">
<td>&gt;0.20</td>
<td>Poor</td>
</tr>
</tbody>
</table>
<h3 id="risk-score">2.3 Risk Score</h3>
<h4 id="definition-2">2.3.1 Definition</h4>
<p>Composite metric combining uncertainty awareness, calibration, and
overconfidence.</p>
<h4 id="formula-2">2.3.2 Formula</h4>
<pre><code>Risk = Œ± √ó (1 - U-Recall) + Œ≤ √ó ECE + Œ≥ √ó OC</code></pre>
<p>Where: - <code>Œ± = 0.4</code> (unknown detection weight) -
<code>Œ≤ = 0.4</code> (calibration weight) - <code>Œ≥ = 0.2</code>
(overconfidence penalty) - <code>OC</code> = Overconfidence rate</p>
<h4 id="interpretation-2">2.3.3 Interpretation</h4>
<table>
<thead>
<tr class="header">
<th>Score</th>
<th>Classification</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>0.00‚Äì0.25</td>
<td>LOW</td>
</tr>
<tr class="even">
<td>0.25‚Äì0.50</td>
<td>MEDIUM</td>
</tr>
<tr class="odd">
<td>0.50‚Äì0.75</td>
<td>HIGH</td>
</tr>
<tr class="even">
<td>0.75‚Äì1.00</td>
<td>CRITICAL</td>
</tr>
</tbody>
</table>
<hr />
<h2 id="knowledge-classification">3. Knowledge Classification</h2>
<h3 id="categories">3.1 Categories</h3>
<table>
<colgroup>
<col style="width: 32%" />
<col style="width: 38%" />
<col style="width: 29%" />
</colgroup>
<thead>
<tr class="header">
<th>Category</th>
<th>Definition</th>
<th>Example</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><strong>KNOWN</strong></td>
<td>Established, verifiable answer exists</td>
<td>‚ÄúSpeed of light in vacuum‚Äù</td>
</tr>
<tr class="even">
<td><strong>UNKNOWN</strong></td>
<td>No established answer exists</td>
<td>‚ÄúWill P equal NP?‚Äù</td>
</tr>
<tr class="odd">
<td><strong>CONTRADICTION</strong></td>
<td>Authoritative sources conflict</td>
<td>‚ÄúIs consciousness computational?‚Äù</td>
</tr>
</tbody>
</table>
<h3 id="classification-criteria">3.2 Classification Criteria</h3>
<h4 id="known">3.2.1 KNOWN</h4>
<ul>
<li>Answer verifiable against authoritative sources</li>
<li>Scientific consensus exists</li>
<li>No material expert disagreement</li>
</ul>
<h4 id="unknown">3.2.2 UNKNOWN</h4>
<ul>
<li>Question addresses genuinely open problems</li>
<li>No verifiable answer currently exists</li>
<li>Future resolution may be possible</li>
</ul>
<h4 id="contradiction">3.2.3 CONTRADICTION</h4>
<ul>
<li>Multiple authoritative sources disagree</li>
<li>Expert consensus absent</li>
<li>Classification as KNOWN or UNKNOWN inappropriate</li>
</ul>
<hr />
<h2 id="compliance-levels">4. Compliance Levels</h2>
<h3 id="level-1-basic">4.1 Level 1: Basic</h3>
<table>
<thead>
<tr class="header">
<th>Metric</th>
<th>Threshold</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>U-Recall</td>
<td>‚â•0.30</td>
</tr>
<tr class="even">
<td>ECE</td>
<td>‚â§0.20</td>
</tr>
<tr class="odd">
<td>Risk Score</td>
<td>‚â§0.70</td>
</tr>
</tbody>
</table>
<p><strong>Appropriate For:</strong> - Internal tools - Prototypes -
Research applications - Non-critical systems</p>
<p><strong>Evaluation Frequency:</strong> Annual</p>
<h3 id="level-2-standard">4.2 Level 2: Standard</h3>
<table>
<thead>
<tr class="header">
<th>Metric</th>
<th>Threshold</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>U-Recall</td>
<td>‚â•0.50</td>
</tr>
<tr class="even">
<td>ECE</td>
<td>‚â§0.15</td>
</tr>
<tr class="odd">
<td>Risk Score</td>
<td>‚â§0.50</td>
</tr>
</tbody>
</table>
<p><strong>Appropriate For:</strong> - Customer-facing applications -
Business operations support - Decision support systems - Supervised
automation</p>
<p><strong>Evaluation Frequency:</strong> Quarterly</p>
<h3 id="level-3-advanced">4.3 Level 3: Advanced</h3>
<table>
<thead>
<tr class="header">
<th>Metric</th>
<th>Threshold</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>U-Recall</td>
<td>‚â•0.70</td>
</tr>
<tr class="even">
<td>ECE</td>
<td>‚â§0.10</td>
</tr>
<tr class="odd">
<td>Risk Score</td>
<td>‚â§0.30</td>
</tr>
</tbody>
</table>
<p><strong>Appropriate For:</strong> - Regulated industries (finance,
healthcare, legal) - High-stakes decision systems - Autonomous
operations - Compliance-critical applications</p>
<p><strong>Evaluation Frequency:</strong> Monthly + Third-party
audit</p>
<hr />
<h2 id="evaluation-methodology">5. Evaluation Methodology</h2>
<h3 id="benchmark-dataset">5.1 Benchmark Dataset</h3>
<p>Evaluation SHALL use ONTO-Bench or equivalent approved benchmark:</p>
<table>
<thead>
<tr class="header">
<th>Category</th>
<th>Minimum Samples</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>KNOWN</td>
<td>100</td>
</tr>
<tr class="even">
<td>UNKNOWN</td>
<td>100</td>
</tr>
<tr class="odd">
<td>CONTRADICTION</td>
<td>25</td>
</tr>
</tbody>
</table>
<h3 id="evaluation-protocol">5.2 Evaluation Protocol</h3>
<ol type="1">
<li>System receives question text</li>
<li>System provides:
<ul>
<li>Classification (KNOWN/UNKNOWN/CONTRADICTION)</li>
<li>Confidence score [0.0, 1.0]</li>
<li>Response (if KNOWN)</li>
</ul></li>
<li>Metrics computed against ground truth</li>
<li>Compliance level determined</li>
</ol>
<h3 id="evaluation-environment">5.3 Evaluation Environment</h3>
<ul>
<li>Standardized prompt format</li>
<li>No access to benchmark answers</li>
<li>Isolated execution environment</li>
<li>Reproducible configuration</li>
</ul>
<hr />
<h2 id="certification">6. Certification</h2>
<h3 id="certification-process">6.1 Certification Process</h3>
<ol type="1">
<li><strong>Application</strong> ‚Äî Organization submits request</li>
<li><strong>Evaluation</strong> ‚Äî Independent assessment using
ONTO-Bench</li>
<li><strong>Review</strong> ‚Äî Standards Council verification</li>
<li><strong>Certification</strong> ‚Äî Certificate issued (12-month
validity)</li>
<li><strong>Registry</strong> ‚Äî Public entry in certification
registry</li>
</ol>
<h3 id="certificate-format">6.2 Certificate Format</h3>
<pre><code>ONTO CERTIFIED
‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ
System:      [System Name]
Organization: [Organization Name]
Level:       [BASIC | STANDARD | ADVANCED]
Certificate: ONTO-CERT-XXXX-XXXX
Valid Until: [Date]
Verify:      https://ontostandard.org/verify/XXXX
‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ</code></pre>
<h3 id="certification-maintenance">6.3 Certification Maintenance</h3>
<ul>
<li>Annual re-evaluation required</li>
<li>Material system changes require re-certification</li>
<li>Continuous monitoring recommended for Level 3</li>
</ul>
<hr />
<h2 id="regulatory-alignment">7. Regulatory Alignment</h2>
<h3 id="eu-ai-act">7.1 EU AI Act</h3>
<table>
<thead>
<tr class="header">
<th>Article</th>
<th>Requirement</th>
<th>ONTO Support</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Art. 9</td>
<td>Risk management</td>
<td>Risk Score, Compliance Levels</td>
</tr>
<tr class="even">
<td>Art. 13</td>
<td>Transparency</td>
<td>Certification Report</td>
</tr>
<tr class="odd">
<td>Art. 15</td>
<td>Accuracy</td>
<td>ECE, U-Recall metrics</td>
</tr>
<tr class="even">
<td>Art. 43</td>
<td>Conformity assessment</td>
<td>Certification process</td>
</tr>
</tbody>
</table>
<h3 id="nist-ai-rmf">7.2 NIST AI RMF</h3>
<table>
<thead>
<tr class="header">
<th>Function</th>
<th>ONTO Implementation</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>MEASURE 1.1</td>
<td>Defined metrics</td>
</tr>
<tr class="even">
<td>MEASURE 2.1</td>
<td>Standardized evaluation</td>
</tr>
<tr class="odd">
<td>MEASURE 2.3</td>
<td>Periodic re-evaluation</td>
</tr>
<tr class="even">
<td>MEASURE 4.1</td>
<td>Documented methodology</td>
</tr>
</tbody>
</table>
<h3 id="isoiec-42001">7.3 ISO/IEC 42001</h3>
<table>
<thead>
<tr class="header">
<th>Clause</th>
<th>ONTO Support</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Clause 6</td>
<td>Risk assessment methodology</td>
</tr>
<tr class="even">
<td>Clause 8</td>
<td>Performance measurement</td>
</tr>
<tr class="odd">
<td>Clause 9</td>
<td>Evaluation and audit</td>
</tr>
</tbody>
</table>
<hr />
<h2 id="conformance">8. Conformance</h2>
<h3 id="conformance-levels">8.1 Conformance Levels</h3>
<table>
<thead>
<tr class="header">
<th>Level</th>
<th>Requirements</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><strong>Minimal</strong></td>
<td>Metrics computed correctly</td>
</tr>
<tr class="even">
<td><strong>Partial</strong></td>
<td>Level 1 compliance achieved</td>
</tr>
<tr class="odd">
<td><strong>Full</strong></td>
<td>Level 2+ with certification</td>
</tr>
</tbody>
</table>
<h3 id="conformance-statement">8.2 Conformance Statement</h3>
<p>Implementations claiming conformance SHALL state:</p>
<pre><code>This system is evaluated according to ONTO-ERS v10.0.
Compliance Level: [BASIC|STANDARD|ADVANCED]
Certification Status: [Certified|Self-Assessed|Pending]</code></pre>
<hr />
<h2 id="security-considerations">9. Security Considerations</h2>
<h3 id="benchmark-integrity">9.1 Benchmark Integrity</h3>
<ul>
<li>Benchmark datasets SHALL be protected from contamination</li>
<li>Systems SHALL NOT be trained on benchmark data</li>
<li>Evaluation SHALL use held-out test sets</li>
</ul>
<h3 id="certification-integrity">9.2 Certification Integrity</h3>
<ul>
<li>Certificates SHALL be cryptographically signed</li>
<li>Verification SHALL use secure channels</li>
<li>Revocation SHALL be timely and public</li>
</ul>
<hr />
<h2 id="future-work">10. Future Work</h2>
<h3 id="planned-extensions">10.1 Planned Extensions</h3>
<ul>
<li>Domain-specific benchmarks (ONTO-FIN, ONTO-LEGAL, ONTO-MED)</li>
<li>Multi-modal evaluation</li>
<li>Continuous monitoring protocols</li>
<li>Automated certification</li>
</ul>
<h3 id="version-roadmap">10.2 Version Roadmap</h3>
<table>
<thead>
<tr class="header">
<th>Version</th>
<th>Timeline</th>
<th>Focus</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>1.1</td>
<td>Q2 2026</td>
<td>ONTO-FIN integration</td>
</tr>
<tr class="even">
<td>1.2</td>
<td>Q3 2026</td>
<td>Continuous monitoring</td>
</tr>
<tr class="odd">
<td>2.0</td>
<td>Q1 2027</td>
<td>Multi-modal support</td>
</tr>
</tbody>
</table>
<hr />
<h2 id="appendix-a-reference-implementation">Appendix A: Reference
Implementation</h2>
<div class="sourceCode" id="cb6"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> onto_standard <span class="im">import</span> evaluate, ComplianceLevel</span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Run evaluation</span></span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a>results <span class="op">=</span> evaluate(predictions, ground_truth)</span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Check compliance</span></span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f&quot;U-Recall: </span><span class="sc">{</span>results<span class="sc">.</span>unknown_detection<span class="sc">.</span>recall<span class="sc">:.2%}</span><span class="ss">&quot;</span>)</span>
<span id="cb6-8"><a href="#cb6-8" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f&quot;ECE: </span><span class="sc">{</span>results<span class="sc">.</span>calibration<span class="sc">.</span>ece<span class="sc">:.3f}</span><span class="ss">&quot;</span>)</span>
<span id="cb6-9"><a href="#cb6-9" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f&quot;Risk Score: </span><span class="sc">{</span>results<span class="sc">.</span>risk_score<span class="sc">.</span>score<span class="sc">:.3f}</span><span class="ss">&quot;</span>)</span>
<span id="cb6-10"><a href="#cb6-10" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f&quot;Compliance: </span><span class="sc">{</span>results<span class="sc">.</span>compliance_level<span class="sc">.</span>value<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb6-11"><a href="#cb6-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-12"><a href="#cb6-12" aria-hidden="true" tabindex="-1"></a><span class="co"># Verify certification readiness</span></span>
<span id="cb6-13"><a href="#cb6-13" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> results.compliance_level <span class="op">&gt;=</span> ComplianceLevel.STANDARD:</span>
<span id="cb6-14"><a href="#cb6-14" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">&quot;‚úì Eligible for ONTO Certification&quot;</span>)</span></code></pre></div>
<p><strong>Installation:</strong>
<code>pip install onto-standard</code></p>
<hr />
<h2 id="appendix-b-glossary">Appendix B: Glossary</h2>
<table>
<thead>
<tr class="header">
<th>Term</th>
<th>Definition</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Calibration</td>
<td>Alignment between confidence and accuracy</td>
</tr>
<tr class="even">
<td>ECE</td>
<td>Expected Calibration Error</td>
</tr>
<tr class="odd">
<td>Epistemic</td>
<td>Relating to knowledge or certainty</td>
</tr>
<tr class="even">
<td>Overconfidence</td>
<td>Expressing higher confidence than warranted</td>
</tr>
<tr class="odd">
<td>U-Recall</td>
<td>Unknown Detection Rate</td>
</tr>
</tbody>
</table>
<hr />
<h2 id="appendix-c-document-history">Appendix C: Document History</h2>
<table>
<thead>
<tr class="header">
<th>Version</th>
<th>Date</th>
<th>Changes</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>1.0</td>
<td>Jan 2026</td>
<td>Initial publication</td>
</tr>
</tbody>
</table>
<hr />
<h2 id="contact">Contact</h2>
<p><strong>ONTO Foundation</strong></p>
<ul>
<li>Website: https://ontostandard.org</li>
<li>Specification: https://ontostandard.org/standard</li>
<li>Email: <a href="/cdn-cgi/l/email-protection" class="__cf_email__" data-cfemail="96e5e3e6e6f9e4e2d6f9f8e2f9e5e2f7f8f2f7e4f2b8f9e4f1">[email&#160;protected]</a></li>
<li>GitHub: https://github.com/nickarstrong/onto-standard</li>
</ul>
<hr />
<p><em>ONTO Epistemic Risk Standard v10.0</em><br />
<em>¬© 2026 ONTO Foundation</em><br />
<em>Licensed under ONTO Gold Asymmetric AI License</em></p>
</article>

                </div>
            </div>
        </div>

        <!-- REFERENCE PAGE (STEALTH ADMIN) -->
        <div class="page" id="page-reference">
            <div class="page-header">
                <div>
                    <h1>Reference Documentation</h1>
                    <p class="page-subtitle">Internal sync status and node management</p>
                </div>
                <div style="display: flex; gap: 8px;">
                    <button class="btn btn-secondary" onclick="cleanupUnverified()">
                        Cleanup Unverified
                    </button>
                    <button class="btn btn-secondary" onclick="loadReferenceData()">
                        <svg viewBox="0 0 24 24" width="16" height="16" fill="none" stroke="currentColor" stroke-width="2"><path d="M23 4v6h-6"/><path d="M1 20v-6h6"/><path d="M3.51 9a9 9 0 0114.85-3.36L23 10M1 14l4.64 4.36A9 9 0 0020.49 15"/></svg>
                        Refresh
                    </button>
                </div>
            </div>

            <!-- Stats Cards -->
            <div class="stats-grid" id="ref-stats">
                <div class="stat-card">
                    <div class="stat-value" id="ref-total-nodes">-</div>
                    <div class="stat-label">Total Nodes</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="ref-active-nodes">-</div>
                    <div class="stat-label">Active Nodes</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="ref-namespaces">-</div>
                    <div class="stat-label">Namespaces</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="ref-honeypot">-</div>
                    <div class="stat-label">Trap Hits</div>
                </div>
            </div>

            <!-- Tabs -->
            <div class="ref-tabs">
                <button class="ref-tab active" onclick="showRefTab('nodes', this)">Nodes</button>
                <button class="ref-tab" onclick="showRefTab('namespaces', this)">Namespaces</button>
                <button class="ref-tab" onclick="showRefTab('violations', this)">Violations</button>
                <button class="ref-tab" onclick="showRefTab('honeypot', this)">Trap Log</button>
                <button class="ref-tab" onclick="showRefTab('broadcast', this)">Broadcast</button>
            </div>

            <!-- Nodes Tab -->
            <div class="ref-content active" id="ref-tab-nodes">
                <div class="table-header">
                    <input type="text" class="form-input" placeholder="Search nodes..." id="ref-search-nodes" oninput="filterRefNodes()" style="max-width: 300px;">
                </div>
                <div class="table-wrap">
                    <table class="data-table">
                        <thead>
                            <tr>
                                <th>Email</th>
                                <th>Name</th>
                                <th>Org</th>
                                <th>Tier</th>
                                <th>Status</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody id="ref-nodes-tbody"></tbody>
                    </table>
                </div>
            </div>

            <!-- Namespaces Tab -->
            <div class="ref-content" id="ref-tab-namespaces">
                <div class="table-wrap">
                    <table class="data-table">
                        <thead>
                            <tr>
                                <th>Name</th>
                                <th>Slug</th>
                                <th>Tier</th>
                                <th>Nodes</th>
                                <th>Status</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody id="ref-namespaces-tbody"></tbody>
                    </table>
                </div>
            </div>

            <!-- Violations Tab -->
            <div class="ref-content" id="ref-tab-violations">
                <div class="table-wrap">
                    <table class="data-table">
                        <thead>
                            <tr>
                                <th>Time</th>
                                <th>Org</th>
                                <th>Endpoint</th>
                                <th>IP</th>
                                <th>Count/Limit</th>
                            </tr>
                        </thead>
                        <tbody id="ref-violations-tbody"></tbody>
                    </table>
                </div>
            </div>

            <!-- Honeypot Tab -->
            <div class="ref-content" id="ref-tab-honeypot">
                <div class="table-wrap">
                    <table class="data-table">
                        <thead>
                            <tr>
                                <th>Time</th>
                                <th>IP</th>
                                <th>Endpoint</th>
                                <th>Method</th>
                                <th>User Agent</th>
                            </tr>
                        </thead>
                        <tbody id="ref-honeypot-tbody"></tbody>
                    </table>
                </div>
            </div>

            <!-- Broadcast Tab -->
            <div class="ref-content" id="ref-tab-broadcast">
                <div class="card" style="max-width: 500px;">
                    <h3 style="margin-bottom: 16px;">Signal Broadcast Control</h3>
                    <div id="ref-broadcast-status" style="margin-bottom: 20px; padding: 12px; background: var(--bg-elevated); border-radius: 8px;">
                        Loading status...
                    </div>
                    <div style="display: flex; gap: 12px;">
                        <button class="btn btn-secondary" onclick="refBroadcastAction('pause')">Pause</button>
                        <button class="btn btn-secondary" onclick="refBroadcastAction('resume')">Resume</button>
                        <button class="btn btn-primary" onclick="refBroadcastAction('force')">Force Broadcast</button>
                    </div>
                </div>
            </div>
        </div>
    </main>
</div>

<!-- COMPANY REGISTRATION MODAL -->
<div class="modal-overlay" id="company-modal">
    <div class="modal modal-wide modal-inst">
        <div class="modal-header">
            <h2>Organization Registration</h2>
            <button class="modal-close" onclick="closeModal('company-modal')">&times;</button>
        </div>
        <div class="modal-body form-inst">
            <div class="form-section">
                <div class="form-section-title">Legal Entity</div>
                <div class="form-row">
                    <div class="form-group">
                        <label class="form-label">Legal Name *</label>
                        <input type="text" class="form-input" id="company-name-input" placeholder="e.g. Acme Corporation Inc.">
                    </div>
                    <div class="form-group">
                        <label class="form-label">Entity Type *</label>
                        <select class="form-input" id="company-type-input">
                            <option value="">Select type...</option>
                            <option value="corporation">Corporation</option>
                            <option value="llc">LLC</option>
                            <option value="llp">LLP</option>
                            <option value="partnership">Partnership</option>
                            <option value="foundation">Foundation</option>
                            <option value="nonprofit">Non-Profit</option>
                            <option value="university">University / Research</option>
                            <option value="government">Government</option>
                            <option value="other">Other</option>
                        </select>
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label class="form-label">Industry *</label>
                        <select class="form-input" id="company-industry-input">
                            <option value="">Select industry...</option>
                            <optgroup label="High-Risk Sectors">
                                <option value="healthcare">Healthcare & Medical</option>
                                <option value="financial">Financial Services</option>
                                <option value="legal">Legal Services</option>
                                <option value="insurance">Insurance</option>
                                <option value="aerospace">Aerospace</option>
                                <option value="defense">Defense & Security</option>
                                <option value="autonomous">Autonomous Systems</option>
                                <option value="energy">Energy & Utilities</option>
                                <option value="infrastructure">Critical Infrastructure</option>
                            </optgroup>
                            <optgroup label="Technology">
                                <option value="ai_ml">AI / Machine Learning</option>
                                <option value="software">Software & SaaS</option>
                                <option value="cloud">Cloud Services</option>
                                <option value="cybersecurity">Cybersecurity</option>
                                <option value="data">Data & Analytics</option>
                            </optgroup>
                            <optgroup label="Other Sectors">
                                <option value="manufacturing">Manufacturing</option>
                                <option value="retail">Retail & E-commerce</option>
                                <option value="education">Education</option>
                                <option value="media">Media & Entertainment</option>
                                <option value="consulting">Consulting</option>
                                <option value="research">Research & Academia</option>
                                <option value="government">Government & Public</option>
                                <option value="other">Other</option>
                            </optgroup>
                        </select>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Registration Number *</label>
                        <input type="text" class="form-input" id="company-reg-input" placeholder="e.g. 12-3456789">
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label class="form-label">Tax ID / VAT</label>
                        <input type="text" class="form-input" id="company-vat-input" placeholder="Optional">
                    </div>
                </div>
            </div>
            
            <div class="form-section">
                <div class="form-section-title">Registered Address</div>
                <div class="form-group">
                    <label class="form-label">Street Address *</label>
                    <input type="text" class="form-input" id="company-address-input" placeholder="123 Main Street, Suite 100">
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label class="form-label">City *</label>
                        <input type="text" class="form-input" id="company-city-input" placeholder="New York">
                    </div>
                    <div class="form-group">
                        <label class="form-label">State / Province</label>
                        <input type="text" class="form-input" id="company-state-input" placeholder="NY">
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label class="form-label">Postal Code *</label>
                        <input type="text" class="form-input" id="company-postal-input" placeholder="10001">
                    </div>
                    <div class="form-group">
                        <label class="form-label">Country *</label>
                        <select class="form-input" id="company-country-input">
                            <option value="">Select country...</option>
                            <optgroup label="Common">
                                <option value="US">United States</option>
                                <option value="GB">United Kingdom</option>
                                <option value="DE">Germany</option>
                                <option value="FR">France</option>
                                <option value="CH">Switzerland</option>
                                <option value="SG">Singapore</option>
                                <option value="AE">UAE</option>
                                <option value="JP">Japan</option>
                            </optgroup>
                            <optgroup label="Americas">
                                <option value="AR">Argentina</option>
                                <option value="BR">Brazil</option>
                                <option value="CA">Canada</option>
                                <option value="CL">Chile</option>
                                <option value="CO">Colombia</option>
                                <option value="MX">Mexico</option>
                                <option value="PE">Peru</option>
                            </optgroup>
                            <optgroup label="Europe">
                                <option value="AT">Austria</option>
                                <option value="BE">Belgium</option>
                                <option value="CZ">Czech Republic</option>
                                <option value="DK">Denmark</option>
                                <option value="EE">Estonia</option>
                                <option value="FI">Finland</option>
                                <option value="GR">Greece</option>
                                <option value="HU">Hungary</option>
                                <option value="IE">Ireland</option>
                                <option value="IT">Italy</option>
                                <option value="LU">Luxembourg</option>
                                <option value="NL">Netherlands</option>
                                <option value="NO">Norway</option>
                                <option value="PL">Poland</option>
                                <option value="PT">Portugal</option>
                                <option value="RO">Romania</option>
                                <option value="ES">Spain</option>
                                <option value="SE">Sweden</option>
                            </optgroup>
                            <optgroup label="Asia Pacific">
                                <option value="AU">Australia</option>
                                <option value="CN">China</option>
                                <option value="HK">Hong Kong</option>
                                <option value="IN">India</option>
                                <option value="ID">Indonesia</option>
                                <option value="KR">South Korea</option>
                                <option value="MY">Malaysia</option>
                                <option value="NZ">New Zealand</option>
                                <option value="PH">Philippines</option>
                                <option value="TW">Taiwan</option>
                                <option value="TH">Thailand</option>
                                <option value="VN">Vietnam</option>
                            </optgroup>
                            <optgroup label="Middle East & Africa">
                                <option value="BH">Bahrain</option>
                                <option value="EG">Egypt</option>
                                <option value="IL">Israel</option>
                                <option value="KW">Kuwait</option>
                                <option value="QA">Qatar</option>
                                <option value="SA">Saudi Arabia</option>
                                <option value="ZA">South Africa</option>
                                <option value="TR">Turkey</option>
                            </optgroup>
                            <optgroup label="CIS">
                                <option value="KZ">Kazakhstan</option>
                                <option value="UZ">Uzbekistan</option>
                                <option value="AZ">Azerbaijan</option>
                                <option value="GE">Georgia</option>
                                <option value="AM">Armenia</option>
                            </optgroup>
                            <optgroup label="Other">
                                <option value="OTHER">Other</option>
                            </optgroup>
                        </select>
                    </div>
                </div>
            </div>
            
            <div class="form-section">
                <div class="form-section-title">Contact</div>
                <div class="form-row">
                    <div class="form-group">
                        <label class="form-label">Organization Email *</label>
                        <input type="email" class="form-input" id="company-email-input" placeholder="contact@company.com">
                    </div>
                    <div class="form-group">
                        <label class="form-label">Phone</label>
                        <input type="tel" class="form-input" id="company-phone-input" placeholder="+1 (555) 123-4567">
                    </div>
                </div>
            </div>
            
            <div class="form-section">
                <div class="form-section-title">Authorized Representative</div>
                <div class="form-row">
                    <div class="form-group">
                        <label class="form-label">Full Name *</label>
                        <input type="text" class="form-input" id="signatory-name-input" placeholder="John Smith">
                    </div>
                    <div class="form-group">
                        <label class="form-label">Title *</label>
                        <input type="text" class="form-input" id="signatory-title-input" placeholder="Chief Technology Officer">
                    </div>
                </div>
            </div>
            
            <div class="form-section" style="border-bottom: none; padding-bottom: 0;">
                <div class="form-section-title">Agreement</div>
                <div class="agreement-notice">
                    By registering, the organization agrees to the Master Service Agreement including limitation of liability provisions. 
                    <a href="/terms.html" target="_blank">View Terms of Service ‚Üó</a>
                </div>
                <div class="checkbox-group">
                    <input type="checkbox" id="msa-agree">
                    <label for="msa-agree">I have read and accept the Master Service Agreement</label>
                </div>
                <div class="checkbox-group">
                    <input type="checkbox" id="msa-authorized">
                    <label for="msa-authorized">I am authorized to bind this organization</label>
                </div>
            </div>
        </div>
        <div class="modal-footer">
            <button class="btn-minimal" onclick="closeModal('company-modal')">Cancel</button>
            <div onclick="if(document.getElementById('register-company-btn').disabled) highlightEmptyFields();" style="display:inline-block;">
                <button class="btn-minimal" id="register-company-btn" onclick="registerCompany()" disabled style="background: var(--accent); color: white; border-color: var(--accent);">Register</button>
            </div>
        </div>
    </div>
</div>

<!-- SUBSCRIBE MODAL -->
<!-- CONTACT SALES MODAL -->
<div class="modal-overlay" id="contact-modal">
    <div class="modal modal-inst" style="max-width: 440px;">
        <div class="modal-header">
            <h2>Contact Sales</h2>
            <button class="modal-close" onclick="closeModal('contact-modal')">&times;</button>
        </div>
        <div class="modal-body form-inst">
            <p style="font-size: 13px; color: var(--text-secondary); margin-bottom: 20px;">
                For Critical tier, custom integrations, or enterprise requirements.
            </p>
            <div class="form-group">
                <label class="form-label">Name</label>
                <input type="text" class="form-input" id="contact-name" placeholder="Your name">
            </div>
            <div class="form-group">
                <label class="form-label">Organization</label>
                <input type="text" class="form-input" id="contact-org" placeholder="Company name">
            </div>
            <div class="form-group">
                <label class="form-label">Email</label>
                <input type="email" class="form-input" id="contact-email" placeholder="work@company.com">
            </div>
            <div class="form-group">
                <label class="form-label">Message</label>
                <textarea class="form-input" id="contact-message" rows="3" placeholder="Tell us about your requirements..."></textarea>
            </div>
        </div>
        <div class="modal-footer">
            <button class="btn-minimal" onclick="closeModal('contact-modal')">Cancel</button>
            <button class="btn-minimal" onclick="submitContactForm()" style="background: var(--accent); color: white; border-color: var(--accent);">Send</button>
        </div>
    </div>
</div>

<script>
// === API CONFIG ===
const API_BASE = 'https://api.ontostandard.org';
let authToken = null;

// === API HELPER ===
async function api(endpoint, options = {}) {
    const headers = {
        'Content-Type': 'application/json',
        ...options.headers
    };
    
    if (authToken) {
        headers['Authorization'] = `Bearer ${authToken}`;
    }
    
    try {
        const response = await fetch(`${API_BASE}${endpoint}`, {
            ...options,
            headers
        });
        
        const data = await response.json();
        
        if (!response.ok) {
            throw new Error(data.detail || data.message || 'Request failed');
        }
        
        return data;
    } catch (error) {
        console.error('API Error:', error);
        throw error;
    }
}

// === STATE ===
let currentUser = null;
let sessionTimer = null;
let sessionWarningTimer = null;
const SESSION_TIMEOUT = 30 * 60 * 1000; // 30 minutes
const SESSION_WARNING = 5 * 60 * 1000; // 5 minutes before timeout

// === i18n STRINGS (preparation) ===
const STRINGS = {
    welcome: 'Welcome to ONTO',
    welcomeDesc: 'Get started by creating your first API key and making an evaluation request.',
    getApiKey: 'Get API Key',
    readDocs: 'Read Docs',
    copied: 'Copied to clipboard',
    sessionWarning: 'Your session will expire in 5 minutes. Click to stay signed in.',
    sessionExpired: 'Session expired. Please sign in again.',
    orgRegistered: 'Organization registered',
    messageSent: 'Message sent. We\'ll be in touch within 24 hours.',
    fillRequired: 'Please fill in all required fields',
    confirmLogout: 'Are you sure you want to sign out?',
    confirmRegenerate: 'Are you sure you want to regenerate your API key?\n\nThis will immediately invalidate your current key.'
};

// === SESSION MANAGEMENT ===
function resetSessionTimer() {
    clearTimeout(sessionTimer);
    clearTimeout(sessionWarningTimer);
    
    if (!currentUser) return;
    
    // Warning 5 min before timeout
    sessionWarningTimer = setTimeout(() => {
        showSessionWarning();
    }, SESSION_TIMEOUT - SESSION_WARNING);
    
    // Actual timeout
    sessionTimer = setTimeout(() => {
        handleSessionExpired();
    }, SESSION_TIMEOUT);
}

function showSessionWarning() {
    const toast = document.createElement('div');
    toast.className = 'toast session-warning';
    toast.innerHTML = `
        <span>${STRINGS.sessionWarning}</span>
        <button onclick="extendSession(this.parentElement)" style="margin-left:8px;background:white;color:#333;border:none;padding:4px 12px;border-radius:4px;cursor:pointer;">Stay signed in</button>
    `;
    toast.style.cssText = 'background: #f59e0b; color: white; cursor: pointer;';
    
    let container = document.querySelector('.toast-container');
    if (!container) {
        container = document.createElement('div');
        container.className = 'toast-container';
        document.body.appendChild(container);
    }
    container.appendChild(toast);
}

function extendSession(toastEl) {
    if (toastEl) toastEl.remove();
    resetSessionTimer();
    showToast('Session extended', 'success');
}

function handleSessionExpired() {
    currentUser = null;
    localStorage.removeItem('onto_user');
    document.getElementById('auth-screen').style.display = 'flex';
    document.getElementById('dashboard').classList.remove('active');
    showToast(STRINGS.sessionExpired, 'error');
}

// Activity listener to reset timer
['click', 'keypress', 'scroll', 'mousemove'].forEach(event => {
    document.addEventListener(event, () => {
        if (currentUser) resetSessionTimer();
    }, { passive: true });
});

// === THEME ===
function toggleTheme() {
    const isLight = document.documentElement.getAttribute('data-theme') === 'light';
    const sunIcon = '<circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/>';
    const moonIcon = '<path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/>';
    
    const icons = [document.getElementById('theme-icon-svg'), document.getElementById('theme-icon-mobile')];
    
    if (isLight) {
        document.documentElement.removeAttribute('data-theme');
        icons.forEach(el => { if (el) el.innerHTML = sunIcon; });
        localStorage.setItem('onto-theme', 'dark');
    } else {
        document.documentElement.setAttribute('data-theme', 'light');
        icons.forEach(el => { if (el) el.innerHTML = moonIcon; });
        localStorage.setItem('onto-theme', 'light');
    }
    drawIndustryChart();
}

// Init theme from localStorage (dark is default)
(function() {
    const saved = localStorage.getItem('onto-theme');
    if (saved === 'light') {
        document.documentElement.setAttribute('data-theme', 'light');
        document.addEventListener('DOMContentLoaded', () => {
            const moonIcon = '<path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/>';
            [document.getElementById('theme-icon-svg'), document.getElementById('theme-icon-mobile')].forEach(el => {
                if (el) el.innerHTML = moonIcon;
            });
        });
    }
})();

// === UTILITIES ===
function showToast(message, type = 'info') {
    const container = document.getElementById('toast-container');
    const toast = document.createElement('div');
    toast.className = 'toast ' + type;
    toast.textContent = message;
    container.appendChild(toast);
    setTimeout(() => toast.remove(), 3000);
}

function toggleMobile() {
    document.querySelector('.sidebar').classList.toggle('mobile-open');
    document.getElementById('mobile-overlay').classList.toggle('active');
}

function setLoading(btn, loading) {
    if (loading) {
        btn.classList.add('loading');
        btn.disabled = true;
    } else {
        btn.classList.remove('loading');
        btn.disabled = false;
    }
}

// === AUTH ===
function showLogin() {
    document.getElementById('login-form').classList.remove('hidden');
    document.getElementById('register-form').classList.add('hidden');
    document.getElementById('verify-pending').classList.add('hidden');
    document.getElementById('verify-success').classList.add('hidden');
}

function showRegister() {
    document.getElementById('login-form').classList.add('hidden');
    document.getElementById('register-form').classList.remove('hidden');
    document.getElementById('verify-pending').classList.add('hidden');
    document.getElementById('verify-success').classList.add('hidden');
}

function togglePassword(inputId, btn) {
    const input = document.getElementById(inputId);
    if (input.type === 'password') {
        input.type = 'text';
        btn.textContent = 'üôà';
    } else {
        input.type = 'password';
        btn.textContent = 'üëÅ';
    }
}

// Enable register button when terms agreed
document.getElementById('terms-agree').addEventListener('change', function() {
    document.getElementById('register-btn').disabled = !this.checked;
});

async function handleLogin(btn) {
    const email = document.getElementById('login-email').value;
    const password = document.getElementById('login-password').value;
    
    if (!email || !password) {
        showToast('Please fill in all fields', 'error');
        return;
    }
    
    setLoading(btn, true);
    
    try {
        const response = await fetch(`${API_BASE}/v1/auth/login`, {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ email, password })
        });
        
        const data = await response.json();
        
        if (!response.ok) {
            throw new Error(data.detail || 'Login failed');
        }
        
        // Store token and user data (backend format)
        authToken = data.token;
        localStorage.setItem('onto_token', authToken);
        
        // Store API key for Reference panel
        if (data.api_key) {
            localStorage.setItem('onto_first_api_key', data.api_key);
        }
        
        currentUser = {
            id: data.user_id,
            name: data.name,
            email: email,
            role: 'admin',
            plan: data.layer || 'free',
            organization_id: data.organization_id,
            can_invoice: false,
            company: data.organization_name ? { name: data.organization_name } : null
        };
        localStorage.setItem('onto_user', JSON.stringify(currentUser));
        
        setLoading(btn, false);
        showToast('Welcome back!', 'success');
        showDashboard();
    } catch (error) {
        setLoading(btn, false);
        
        // Check if email not verified
        if (error.message && error.message.includes('not verified')) {
            pendingVerificationEmail = email;
            showVerifyPending(email);
            showToast('Please verify your email first', 'info');
            return;
        }
        
        showToast(error.message || 'Login failed', 'error');
    }
}

let pendingVerificationEmail = '';

async function handleRegister(btn) {
    const name = document.getElementById('reg-name').value;
    const email = document.getElementById('reg-email').value;
    const password = document.getElementById('reg-password').value;
    const termsAgreed = document.getElementById('terms-agree').checked;
    
    if (!name || !email || !password) {
        showToast('Please fill in all fields', 'error');
        return;
    }
    
    if (!termsAgreed) {
        showToast('Please agree to the Terms of Service', 'error');
        return;
    }
    
    setLoading(btn, true);
    
    try {
        const response = await fetch(`${API_BASE}/v1/auth/register`, {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ name, email, password })
        });
        
        const data = await response.json();
        
        if (!response.ok) {
            throw new Error(data.detail || 'Registration failed');
        }
        
        // Store API key for later display
        localStorage.setItem('onto_first_api_key', data.api_key);
        pendingVerificationEmail = email;
        
        setLoading(btn, false);
        
        // Show verification pending screen
        showVerifyPending(email);
        showToast('Check your email to verify your account', 'success');
    } catch (error) {
        setLoading(btn, false);
        showToast(error.message || 'Registration failed', 'error');
    }
}

function showVerifyPending(email) {
    document.getElementById('login-form').classList.add('hidden');
    document.getElementById('register-form').classList.add('hidden');
    document.getElementById('verify-success').classList.add('hidden');
    document.getElementById('verify-pending').classList.remove('hidden');
    document.getElementById('verify-email-display').textContent = email;
}

function showVerifySuccess() {
    document.getElementById('login-form').classList.add('hidden');
    document.getElementById('register-form').classList.add('hidden');
    document.getElementById('verify-pending').classList.add('hidden');
    document.getElementById('verify-success').classList.remove('hidden');
}

async function resendVerification() {
    if (!pendingVerificationEmail) {
        showToast('No email to verify', 'error');
        return;
    }
    
    try {
        const response = await fetch(`${API_BASE}/v1/auth/resend-verification`, {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ email: pendingVerificationEmail, password: '' })
        });
        
        const data = await response.json();
        showToast(data.message || 'Verification email sent', 'success');
    } catch (error) {
        showToast('Failed to resend email', 'error');
    }
}

async function checkEmailVerification() {
    const params = new URLSearchParams(window.location.search);
    const token = params.get('verify');
    
    if (!token) return;
    
    try {
        const response = await fetch(`${API_BASE}/v1/auth/verify-email?token=${token}`);
        const data = await response.json();
        
        if (response.ok && data.success) {
            // Clean URL first
            window.history.replaceState({}, '', window.location.pathname);
            
            // Auto-login with returned data
            if (data.token) {
                authToken = data.token;
                localStorage.setItem('onto_token', authToken);
                
                currentUser = {
                    id: data.user_id,
                    name: data.name,
                    email: data.email,
                    role: 'admin',
                    plan: data.layer || 'open',
                    organization_id: data.organization_id,
                    can_invoice: false,
                    company: data.organization_name ? { name: data.organization_name } : null
                };
                localStorage.setItem('onto_user', JSON.stringify(currentUser));
                
                showToast('Email verified! Welcome to ONTO.', 'success');
                showDashboard();
            } else {
                showVerifySuccess();
                showToast('Email verified! Please sign in.', 'success');
            }
        } else {
            showToast(data.detail || 'Verification failed', 'error');
        }
    } catch (error) {
        showToast('Verification failed', 'error');
        window.history.replaceState({}, '', window.location.pathname);
    }
}

function handleLogout() {
    if (!confirm(STRINGS.confirmLogout)) {
        return;
    }
    clearTimeout(sessionTimer);
    clearTimeout(sessionWarningTimer);
    currentUser = null;
    authToken = null;
    localStorage.removeItem('onto_user');
    localStorage.removeItem('onto_token');
    document.getElementById('auth-screen').style.display = 'flex';
    document.getElementById('dashboard').classList.remove('active');
}

// === DASHBOARD ===
function showDashboard() {
    document.getElementById('auth-screen').style.display = 'none';
    document.getElementById('dashboard').classList.add('active');
    
    if (currentUser) {
        document.getElementById('user-avatar').textContent = currentUser.name.charAt(0).toUpperCase();
        document.getElementById('user-name').textContent = currentUser.name;
        document.getElementById('user-plan').textContent = currentUser.plan === 'enterprise' ? 'CRITICAL' : currentUser.plan === 'business' ? 'PRO' : 'FREE';
        document.getElementById('settings-name').textContent = currentUser.name;
        document.getElementById('settings-email').textContent = currentUser.email;
        
        updateCompanyUI();
        updateBillingUI();
        updateDashboardMetrics();
        checkWelcomeBanner();
        resetSessionTimer();
    }
}

function updateDashboardMetrics() {
    if (!currentUser) return;
    
    const sub = currentUser.subscription;
    const rateEl = document.getElementById('stat-rate');
    const expiresEl = document.getElementById('stat-expires');
    const switcherEl = document.getElementById('plan-switcher');
    const switchSelect = document.getElementById('plan-switch');
    
    // Rate limit based on plan
    const rateLimits = {
        free: '1/hour',
        business: '1/8.64s',
        enterprise: '‚àû'
    };
    
    const plan = currentUser.plan || 'free';
    rateEl.textContent = rateLimits[plan] || '1/hour';
    
    // Show plan switcher if both plans available
    if (sub && sub.critical_days > 0 && sub.pro_days > 0) {
        switcherEl.classList.remove('hidden');
        switchSelect.value = plan;
    } else {
        switcherEl.classList.add('hidden');
    }
    
    // Expires ‚Äî total days remaining
    if (sub) {
        const criticalDays = sub.critical_days || 0;
        const proDays = sub.pro_days || 0;
        const totalDays = criticalDays + proDays;
        
        if (totalDays > 365) {
            const years = Math.floor(totalDays / 365);
            const months = Math.floor((totalDays % 365) / 30);
            expiresEl.textContent = years + 'y ' + months + 'm';
        } else if (totalDays > 30) {
            const months = Math.floor(totalDays / 30);
            const days = totalDays % 30;
            expiresEl.textContent = months + 'm ' + days + 'd';
        } else if (totalDays > 0) {
            expiresEl.textContent = totalDays + 'd';
        } else {
            expiresEl.textContent = '‚Äî';
        }
        expiresEl.style.color = '';
    } else {
        expiresEl.textContent = '‚Äî';
    }
}

function switchActivePlan(newPlan) {
    if (!currentUser || !currentUser.subscription) return;
    
    const sub = currentUser.subscription;
    const criticalDays = sub.critical_days || 0;
    const proDays = sub.pro_days || 0;
    
    // Can only switch to plans that have days remaining
    if (newPlan === 'enterprise' && criticalDays <= 0) {
        showToast('No Critical days remaining', 'error');
        document.getElementById('plan-switch').value = currentUser.plan;
        return;
    }
    if (newPlan === 'business' && proDays <= 0) {
        showToast('No Pro days remaining', 'error');
        document.getElementById('plan-switch').value = currentUser.plan;
        return;
    }
    
    currentUser.plan = newPlan;
    currentUser.subscription.plan = newPlan;
    localStorage.setItem('onto_user', JSON.stringify(currentUser));
    
    // Update UI
    const planLabel = newPlan === 'enterprise' ? 'CRITICAL' : 'PRO';
    document.getElementById('user-plan').textContent = planLabel;
    
    const rateLimits = { business: '1/8.64s', enterprise: '‚àû' };
    document.getElementById('stat-rate').textContent = rateLimits[newPlan];
    
    updateBillingUI();
    
    showToast('Switched to ' + (newPlan === 'enterprise' ? 'Critical' : 'Professional'), 'success');
}

function showPage(page, el) {
    document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
    document.querySelectorAll('.nav-item').forEach(n => n.classList.remove('active'));
    document.getElementById('page-' + page).classList.add('active');
    if (el) {
        const navItem = el.closest('.nav-item');
        if (navItem) navItem.classList.add('active');
    }
}

function showDoc(docId, el) {
    document.querySelectorAll('.docs-article').forEach(d => d.classList.remove('active'));
    document.querySelectorAll('.docs-nav-item').forEach(n => n.classList.remove('active'));
    const targetDoc = document.getElementById('docs-' + docId);
    if (targetDoc) {
        targetDoc.classList.add('active');
    }
    if (el) el.classList.add('active');
    
    // Scroll to top
    const docsContent = document.querySelector('.docs-content');
    if (docsContent) docsContent.scrollTop = 0;
    
    // Sync mobile select
    const mobileSelect = document.querySelector('.docs-mobile-select');
    if (mobileSelect) mobileSelect.value = docId;
}

function showDocFromSelect(docId) {
    document.querySelectorAll('.docs-article').forEach(d => d.classList.remove('active'));
    document.querySelectorAll('.docs-nav-item').forEach(n => n.classList.remove('active'));
    const targetDoc = document.getElementById('docs-' + docId);
    if (targetDoc) {
        targetDoc.classList.add('active');
    }
    // Sync sidebar active state
    document.querySelectorAll('.docs-nav-item').forEach(item => {
        if (item.getAttribute('onclick')?.includes(`'${docId}'`)) {
            item.classList.add('active');
        }
    });
    
    // Scroll to top
    const docsContent = document.querySelector('.docs-content');
    if (docsContent) docsContent.scrollTop = 0;
}

// === COMPANY ===
function updateCompanyUI() {
    if (currentUser.company) {
        document.getElementById('company-not-registered').classList.add('hidden');
        document.getElementById('company-registered').classList.remove('hidden');
        document.getElementById('company-name').textContent = currentUser.company.name;
        document.getElementById('company-industry').textContent = formatIndustry(currentUser.company.industry);
        document.getElementById('company-reg').textContent = currentUser.company.reg;
        document.getElementById('settings-account-type').textContent = 'Individual + Company';
    } else {
        document.getElementById('company-not-registered').classList.remove('hidden');
        document.getElementById('company-registered').classList.add('hidden');
        document.getElementById('settings-account-type').textContent = 'Individual';
    }
}

function formatIndustry(code) {
    const industries = {
        'healthcare': 'Healthcare & Medical',
        'financial': 'Financial Services',
        'legal': 'Legal Services',
        'insurance': 'Insurance',
        'aerospace': 'Aerospace',
        'defense': 'Defense & Security',
        'autonomous': 'Autonomous Systems',
        'energy': 'Energy & Utilities',
        'infrastructure': 'Critical Infrastructure',
        'ai_ml': 'AI / Machine Learning',
        'software': 'Software & SaaS',
        'cloud': 'Cloud Services',
        'cybersecurity': 'Cybersecurity',
        'data': 'Data & Analytics',
        'manufacturing': 'Manufacturing',
        'retail': 'Retail & E-commerce',
        'education': 'Education',
        'media': 'Media & Entertainment',
        'consulting': 'Consulting',
        'research': 'Research & Academia',
        'government': 'Government & Public',
        'other': 'Other'
    };
    return industries[code] || code || '‚Äî';
}

function openCompanyModal() {
    const modal = document.getElementById('company-modal');
    const isEdit = currentUser?.company != null;
    
    // Update modal title and button for edit mode
    const title = modal.querySelector('.modal-header h2');
    const submitBtn = document.getElementById('register-company-btn');
    if (title) title.textContent = isEdit ? 'Edit Organization' : 'Organization Registration';
    if (submitBtn) submitBtn.textContent = isEdit ? 'Save Changes' : 'Register';
    
    modal.classList.add('active');
    
    // Reset form
    submitBtn.disabled = true;
    
    // Field mapping
    const fieldMap = {
        'company-name-input': 'name',
        'company-type-input': 'type',
        'company-industry-input': 'industry',
        'company-reg-input': 'reg',
        'company-vat-input': 'vat',
        'company-address-input': 'address',
        'company-city-input': 'city',
        'company-state-input': 'state',
        'company-postal-input': 'postal',
        'company-country-input': 'country',
        'company-email-input': 'email',
        'company-phone-input': 'phone',
        'signatory-name-input': 'signatory',
        'signatory-title-input': 'signatoryTitle'
    };
    
    // Add validation listeners and pre-fill if editing
    const companyFields = ['company-name-input', 'company-type-input', 'company-industry-input', 'company-reg-input', 'company-address-input', 'company-city-input', 'company-postal-input', 'company-country-input', 'company-email-input', 'signatory-name-input', 'signatory-title-input'];
    companyFields.forEach(id => {
        const el = document.getElementById(id);
        if (el) {
            el.classList.remove('error', 'valid', 'empty-required');
            
            // Pre-fill with existing data
            const dataKey = fieldMap[id];
            if (isEdit && currentUser.company && dataKey) {
                el.value = currentUser.company[dataKey] || '';
            } else {
                el.value = '';
            }
            
            el.oninput = function() {
                this.classList.remove('error');
                validateCompanyForm();
            };
            el.onchange = validateCompanyForm;
        }
    });
    
    // Also fill optional fields
    ['company-vat-input', 'company-state-input', 'company-phone-input'].forEach(id => {
        const el = document.getElementById(id);
        if (el) {
            const dataKey = fieldMap[id];
            if (isEdit && currentUser.company && dataKey) {
                el.value = currentUser.company[dataKey] || '';
            } else {
                el.value = '';
            }
        }
    });
    
    ['msa-agree', 'msa-authorized'].forEach(id => {
        const el = document.getElementById(id);
        if (el) {
            el.checked = isEdit; // Pre-check if editing (already agreed)
            el.onchange = validateCompanyForm;
        }
    });
    
    // Show initial state after short delay
    setTimeout(validateCompanyForm, 50);
}

function downloadInvoice() {
    if (!currentUser?.subscription) {
        showToast('No active subscription', 'error');
        return;
    }
    
    const now = new Date();
    const sub = currentUser.subscription;
    const invoiceId = 'INV-' + new Date(sub.started).getFullYear() + '-' + Date.now().toString(36).toUpperCase();
    const plan = sub.plan;
    const amount = sub.amount;
    const planNames = { business: 'Professional', enterprise: 'Critical' };
    
    const invoice = {
        schema: 'onto-invoice/v1',
        id: invoiceId,
        created_at: sub.started,
        due_date: new Date(new Date(sub.started).getTime() + 30*24*60*60*1000).toISOString(),
        status: 'PAID',
        
        provider: {
            name: 'ONTO Standard LLC',
            jurisdiction: 'Delaware, USA',
            email: 'billing@ontostandard.org',
            website: 'https://ontostandard.org',
            tax_id: null
        },
        
        client: {
            company: currentUser?.company?.name || currentUser.name,
            legal_name: currentUser?.company?.name || null,
            tax_id: currentUser?.company?.reg || null,
            industry: currentUser?.company?.industry || null,
            address: {
                street: currentUser?.company?.address || null,
                city: currentUser?.company?.city || null,
                postal: currentUser?.company?.postal || null,
                country: currentUser?.company?.country || null
            },
            signatory: currentUser?.company?.signatory || currentUser.name,
            email: currentUser?.company?.email || currentUser.email
        },
        
        line_items: [{
            description: 'ONTO Protocol ‚Äî ' + planNames[plan] + ' Layer',
            details: sub.cycle === 'annual' ? 'Annual subscription (12 months)' : 'Monthly subscription',
            quantity: 1,
            unit_price: amount,
            amount: amount
        }],
        
        subtotal: amount,
        total_paid: sub.total_paid || amount,
        tax: { rate: 0, amount: 0 },
        total: amount,
        currency: 'USD',
        
        payment: {
            terms: sub.cycle === 'annual' ? 'PREPAID' : 'NET_30',
            method: 'invoice',
            reference: invoiceId,
            paid_at: sub.started
        },
        
        service: {
            layer: planNames[plan],
            cycle: sub.cycle,
            term_months: sub.cycle === 'annual' ? 12 : 1,
            started: sub.started,
            expires_at: sub.expires_at || null,
            features: plan === 'enterprise' ? {
                rate_limit: 'unlimited',
                signal: 'dedicated',
                sla: '99.99%',
                support: '24/7'
            } : {
                rate_limit: '1/8.64s',
                signal: 'real-time',
                sla: '99.5%',
                support: 'business hours'
            }
        },
        
        hash: simpleHash(invoiceId + (currentUser?.company?.name || currentUser.name) + plan + amount)
    };
    
    const blob = new Blob([JSON.stringify(invoice, null, 2)], {type: 'application/json'});
    const url = URL.createObjectURL(blob);
    const a = document.createElement('a');
    a.href = url;
    a.download = 'ONTO_Invoice_' + planNames[plan] + '_' + new Date(sub.started).toISOString().split('T')[0] + '.json';
    a.click();
    URL.revokeObjectURL(url);
    
    showToast('Invoice downloaded', 'success');
}

function simpleHash(str) {
    let hash = 0;
    for (let i = 0; i < str.length; i++) {
        hash = ((hash << 5) - hash) + str.charCodeAt(i);
        hash = hash & hash;
    }
    return Math.abs(hash).toString(16).padStart(16, '0');
}

function registerCompany() {
    const btn = document.getElementById('register-company-btn');
    const fields = {
        name: document.getElementById('company-name-input'),
        type: document.getElementById('company-type-input'),
        industry: document.getElementById('company-industry-input'),
        reg: document.getElementById('company-reg-input'),
        vat: document.getElementById('company-vat-input'),
        address: document.getElementById('company-address-input'),
        city: document.getElementById('company-city-input'),
        state: document.getElementById('company-state-input'),
        postal: document.getElementById('company-postal-input'),
        country: document.getElementById('company-country-input'),
        email: document.getElementById('company-email-input'),
        phone: document.getElementById('company-phone-input'),
        signatory: document.getElementById('signatory-name-input'),
        signatoryTitle: document.getElementById('signatory-title-input')
    };
    const msaAgree = document.getElementById('msa-agree');
    const msaAuth = document.getElementById('msa-authorized');
    
    const requiredFields = ['name', 'type', 'industry', 'reg', 'address', 'city', 'postal', 'country', 'email', 'signatory', 'signatoryTitle'];
    let valid = true;
    
    // Clear previous errors
    Object.values(fields).forEach(f => { if(f) f.classList.remove('error'); });
    
    // Validate required fields
    requiredFields.forEach(key => {
        const field = fields[key];
        if (field && (!field.value || !field.value.trim())) {
            field.classList.add('error');
            valid = false;
        }
    });
    
    if (!msaAgree.checked || !msaAuth.checked) {
        valid = false;
    }
    
    if (!valid) {
        return;
    }
    
    // Loading state
    const isEdit = currentUser?.company != null;
    const originalText = btn.textContent;
    btn.textContent = isEdit ? 'Saving...' : 'Registering...';
    btn.disabled = true;
    
    // Simulate API call
    setTimeout(() => {
        currentUser.company = { 
            name: fields.name.value,
            type: fields.type.value,
            industry: fields.industry.value,
            reg: fields.reg.value, 
            vat: fields.vat?.value || '',
            address: fields.address.value,
            city: fields.city.value,
            state: fields.state?.value || '',
            postal: fields.postal.value,
            country: fields.country.value,
            email: fields.email.value,
            phone: fields.phone?.value || '',
            signatory: fields.signatory.value,
            signatoryTitle: fields.signatoryTitle.value
        };
        currentUser.can_invoice = true;
        localStorage.setItem('onto_user', JSON.stringify(currentUser));
        
        btn.textContent = originalText;
        closeModal('company-modal');
        updateCompanyUI();
        showToast(isEdit ? 'Organization updated' : 'Organization registered', 'success');
    }, 800);
}

function validateCompanyForm() {
    const requiredFields = {
        'company-name-input': document.getElementById('company-name-input'),
        'company-type-input': document.getElementById('company-type-input'),
        'company-industry-input': document.getElementById('company-industry-input'),
        'company-reg-input': document.getElementById('company-reg-input'),
        'company-address-input': document.getElementById('company-address-input'),
        'company-city-input': document.getElementById('company-city-input'),
        'company-postal-input': document.getElementById('company-postal-input'),
        'company-country-input': document.getElementById('company-country-input'),
        'company-email-input': document.getElementById('company-email-input'),
        'signatory-name-input': document.getElementById('signatory-name-input'),
        'signatory-title-input': document.getElementById('signatory-title-input')
    };
    
    const msaAgree = document.getElementById('msa-agree').checked;
    const msaAuth = document.getElementById('msa-authorized').checked;
    
    let allFilled = true;
    
    // Check each required field and update visual state
    Object.values(requiredFields).forEach(field => {
        if (!field) return;
        field.classList.remove('error'); // Clear error state on validation
        
        if (field.value && field.value.trim()) {
            field.classList.add('valid');
            field.classList.remove('empty-required');
        } else {
            field.classList.remove('valid');
            field.classList.add('empty-required');
            allFilled = false;
        }
    });
    
    // Update checkboxes visual
    const msaAgreeEl = document.getElementById('msa-agree');
    const msaAuthEl = document.getElementById('msa-authorized');
    msaAgreeEl.parentElement.classList.toggle('checked', msaAgree);
    msaAuthEl.parentElement.classList.toggle('checked', msaAuth);
    
    const btn = document.getElementById('register-company-btn');
    btn.disabled = !(allFilled && msaAgree && msaAuth);
}

function highlightEmptyFields() {
    const fieldIds = ['company-name-input', 'company-type-input', 'company-industry-input', 'company-reg-input', 'company-address-input', 'company-city-input', 'company-postal-input', 'company-country-input', 'company-email-input', 'signatory-name-input', 'signatory-title-input'];
    
    fieldIds.forEach(id => {
        const field = document.getElementById(id);
        if (!field) return;
        if (!field.value || !field.value.trim()) {
            field.classList.remove('valid', 'empty-required');
            field.classList.add('error');
        }
    });
    
    // Highlight checkboxes container if not checked
    const msaAgree = document.getElementById('msa-agree');
    const msaAuth = document.getElementById('msa-authorized');
    
    msaAgree.parentElement.style.color = msaAgree.checked ? '' : 'var(--danger)';
    msaAuth.parentElement.style.color = msaAuth.checked ? '' : 'var(--danger)';
}

// === BILLING ===
function updateBillingUI() {
    const invoiceStatus = document.getElementById('invoice-status');
    const invoiceDownload = document.getElementById('invoice-download');
    const subNone = document.getElementById('subscription-none');
    const subActive = document.getElementById('subscription-active');
    
    // Reset all buttons first
    document.getElementById('btn-free').textContent = 'Current';
    document.getElementById('btn-free').disabled = true;
    document.getElementById('btn-business').textContent = 'Select';
    document.getElementById('btn-business').disabled = false;
    document.getElementById('btn-enterprise').textContent = 'Select';
    document.getElementById('btn-enterprise').disabled = false;
    
    const planNames = { free: 'Open (Free)', business: 'Professional', enterprise: 'Critical' };
    const rateLimits = { free: '1/hour', business: '1/8.64s', enterprise: 'Unlimited' };
    
    // Update current plan indicator
    if (currentUser.plan === 'free' || !currentUser.subscription) {
        document.getElementById('btn-free').textContent = 'Current';
        document.getElementById('btn-free').disabled = true;
        invoiceStatus.textContent = 'No active subscription';
        invoiceStatus.classList.remove('hidden');
        invoiceDownload.classList.add('hidden');
        
        if (subNone) subNone.classList.remove('hidden');
        if (subActive) subActive.classList.add('hidden');
    } else {
        const sub = currentUser.subscription;
        const criticalDays = sub.critical_days || 0;
        const proDays = sub.pro_days || 0;
        
        if (currentUser.plan === 'business') {
            document.getElementById('btn-business').textContent = 'Extend';
        } else if (currentUser.plan === 'enterprise') {
            document.getElementById('btn-enterprise').textContent = 'Extend';
        }
        
        invoiceStatus.classList.add('hidden');
        invoiceDownload.classList.remove('hidden');
        
        if (subNone) subNone.classList.add('hidden');
        if (subActive) subActive.classList.remove('hidden');
        
        document.getElementById('sub-plan').textContent = planNames[currentUser.plan] || currentUser.plan;
        document.getElementById('sub-rate').textContent = rateLimits[currentUser.plan] || '‚Äî';
        document.getElementById('sub-expires').textContent = sub.expires_at ? new Date(sub.expires_at).toLocaleDateString() : '‚Äî';
        document.getElementById('sub-total').textContent = sub.total_paid ? '$' + sub.total_paid.toLocaleString() : '‚Äî';
        
        // Show/hide day counters
        const criticalRow = document.getElementById('sub-critical-row');
        const proRow = document.getElementById('sub-pro-row');
        
        if (criticalDays > 0) {
            criticalRow.classList.remove('hidden');
            document.getElementById('sub-critical-days').textContent = criticalDays + ' days';
        } else {
            criticalRow.classList.add('hidden');
        }
        
        if (proDays > 0) {
            proRow.classList.remove('hidden');
            document.getElementById('sub-pro-days').textContent = proDays + ' days' + (criticalDays > 0 ? ' (after Critical)' : '');
        } else {
            proRow.classList.add('hidden');
        }
    }
}


function contactSales() {
    document.getElementById('contact-modal').classList.add('active');
    // Pre-fill if user logged in
    if (currentUser) {
        document.getElementById('contact-name').value = currentUser.name || '';
        document.getElementById('contact-email').value = currentUser.email || '';
        if (currentUser.company) {
            document.getElementById('contact-org').value = currentUser.company.name || '';
        }
    }
}

function submitContactForm() {
    const name = document.getElementById('contact-name').value.trim();
    const org = document.getElementById('contact-org').value.trim();
    const email = document.getElementById('contact-email').value.trim();
    const message = document.getElementById('contact-message').value.trim();
    
    if (!name || !email) {
        showToast('Please fill in name and email', 'error');
        return;
    }
    
    // Simulate sending
    const btn = document.querySelector('#contact-modal .modal-footer button:last-child');
    btn.textContent = 'Sending...';
    btn.disabled = true;
    
    setTimeout(() => {
        closeModal('contact-modal');
        showToast('Message sent. We\'ll be in touch within 24 hours.', 'success');
        btn.textContent = 'Send';
        btn.disabled = false;
        // Clear form
        document.getElementById('contact-message').value = '';
    }, 800);
}

function dismissWelcome() {
    const banner = document.getElementById('welcome-banner');
    banner.classList.add('hidden');
    localStorage.setItem('onto_welcome_dismissed', 'true');
}

function checkWelcomeBanner() {
    const dismissed = localStorage.getItem('onto_welcome_dismissed');
    const banner = document.getElementById('welcome-banner');
    if (dismissed || (currentUser && currentUser.apiCalls > 0)) {
        banner.classList.add('hidden');
    } else {
        banner.classList.remove('hidden');
    }
}

// === UTILS ===
function closeModal(id) {
    document.getElementById(id).classList.remove('active');
}

function copyApiKey(btn) {
    if (btn.disabled) return;
    
    const input = document.getElementById('api-key-display');
    const originalType = input.type;
    input.type = 'text';
    navigator.clipboard.writeText(input.value);
    input.type = originalType;
    
    // Visual feedback
    btn.textContent = 'Copied!';
    btn.disabled = true;
    showToast('API key copied to clipboard', 'success');
    setTimeout(() => {
        btn.textContent = 'Copy';
        btn.disabled = false;
    }, 2000);
}

function toggleApiKeyVisibility() {
    const input = document.getElementById('api-key-display');
    const btn = document.getElementById('toggle-key-btn');
    if (input.type === 'password') {
        input.type = 'text';
        btn.textContent = 'Hide';
    } else {
        input.type = 'password';
        btn.textContent = 'Show';
    }
}

function regenerateApiKey(btn) {
    if (!confirm('‚ö†Ô∏è Are you sure you want to regenerate your API key?\n\nThis will immediately invalidate your current key. Any applications using the old key will stop working.')) {
        return;
     }
    
    btn.disabled = true;
    btn.textContent = 'Regenerating...';
    
    const apiKey = localStorage.getItem('onto_first_api_key');
    if (!apiKey) {
        showToast('No API key found. Please log in again.', 'error');
        btn.textContent = 'Regenerate Key';
        btn.disabled = false;
        return;
    }
    
    fetch(`${API_BASE}/v1/keys/regenerate-portal`, {
        method: 'POST',
        headers: { 'x-api-key': apiKey }
    })
    .then(response => {
        if (!response.ok) throw new Error('Failed to regenerate key');
        return response.json();
    })
    .then(data => {
        // Update stored key
        localStorage.setItem('onto_first_api_key', data.api_key);
        
        // Update display
        document.getElementById('api-key-display').value = data.api_key;
        document.getElementById('api-key-display').type = 'text';
        document.getElementById('toggle-key-btn').textContent = 'Hide';
        
        btn.textContent = 'Regenerate Key';
        btn.disabled = false;
        
        showToast('New API key generated! Copy it now.', 'success');
    })
    .catch(error => {
        btn.textContent = 'Regenerate Key';
        btn.disabled = false;
        showToast(error.message || 'Failed to regenerate key', 'error');
    });
}

function editProfile() {
    const newName = prompt('Enter new name:', currentUser.name);
    if (newName && newName.trim()) {
        currentUser.name = newName.trim();
        localStorage.setItem('onto_user', JSON.stringify(currentUser));
        document.getElementById('user-name').textContent = currentUser.name;
        document.getElementById('user-avatar').textContent = currentUser.name.charAt(0).toUpperCase();
        document.getElementById('settings-name').textContent = currentUser.name;
    }
}

// === SIGNAL HASH ===
function updateSignalHash() {
    const container = document.getElementById('signal-bytes');
    if (!container) return;
    
    const bytes = Array(13).fill(0).map(() => 
        Math.floor(Math.random() * 256).toString(16).padStart(2, '0')
    );
    
    container.innerHTML = bytes.map((b, i) => 
        `<span class="byte" style="animation-delay: ${i * 0.1}s">${b}</span>`
    ).join('');
}

// Start signal hash updates
setInterval(updateSignalHash, 3000);

// === REFERENCE (STEALTH ADMIN) ===
let refAccessGranted = false;
let refNodesData = [];
let refNamespacesData = [];

async function checkReferenceAccess() {
    const apiKey = localStorage.getItem('onto_first_api_key');
    if (!apiKey) return false;
    
    try {
        const res = await fetch(`${API_BASE}/v1/docs/reference-check`, {
            headers: { 'x-api-key': apiKey }
        });
        if (res.ok) {
            const data = await res.json();
            if (data.status === 'ok') {
                refAccessGranted = true;
                document.getElementById('nav-reference').style.display = 'flex';
                return true;
            }
        }
    } catch (e) {}
    return false;
}

async function showReferencePage(el) {
    if (!refAccessGranted) {
        const hasAccess = await checkReferenceAccess();
        if (!hasAccess) {
            showToast('Access denied', 'error');
            return;
        }
    }
    showPage('reference', el);
    loadReferenceData();
}

async function cleanupUnverified() {
    if (!confirm('Delete all unverified users and their data?')) return;
    
    const apiKey = localStorage.getItem('onto_first_api_key');
    if (!apiKey) {
        showToast('No API key', 'error');
        return;
    }
    
    try {
        const res = await fetch(`${API_BASE}/v1/docs/cleanup-unverified`, {
            method: 'POST',
            headers: { 'x-api-key': apiKey }
        });
        const data = await res.json();
        
        if (res.ok) {
            showToast(`Cleaned up ${data.deleted} unverified accounts`, 'success');
            loadReferenceData();
        } else {
            showToast(data.detail || 'Cleanup failed', 'error');
        }
    } catch (e) {
        showToast('Cleanup failed', 'error');
    }
}

async function loadReferenceData() {
    const apiKey = localStorage.getItem('onto_first_api_key');
    if (!apiKey) return;
    
    const headers = { 'x-api-key': apiKey };
    
    // Load sync status
    try {
        const res = await fetch(`${API_BASE}/v1/docs/sync-status`, { headers });
        if (res.ok) {
            const data = await res.json();
            const m = data.metrics;
            document.getElementById('ref-total-nodes').textContent = m.total_nodes || 0;
            document.getElementById('ref-active-nodes').textContent = m.active_nodes || 0;
            document.getElementById('ref-namespaces').textContent = m.namespaces || 0;
        }
    } catch (e) {}
    
    // Load nodes
    try {
        const res = await fetch(`${API_BASE}/v1/docs/node-index`, { headers });
        if (res.ok) {
            const data = await res.json();
            refNodesData = data.nodes || [];
            renderRefNodes();
        }
    } catch (e) {}
    
    // Load namespaces
    try {
        const res = await fetch(`${API_BASE}/v1/docs/namespace-registry`, { headers });
        if (res.ok) {
            const data = await res.json();
            refNamespacesData = data.namespaces || [];
            renderRefNamespaces();
        }
    } catch (e) {}
    
    // Load violations
    try {
        const res = await fetch(`${API_BASE}/v1/docs/rate-violations`, { headers });
        if (res.ok) {
            const data = await res.json();
            renderRefViolations(data.violations || []);
        }
    } catch (e) {}
    
    // Load honeypot
    try {
        const res = await fetch(`${API_BASE}/v1/docs/trap-log`, { headers });
        if (res.ok) {
            const data = await res.json();
            document.getElementById('ref-honeypot').textContent = data.total_in_memory || 0;
            renderRefHoneypot(data.recent || []);
        }
    } catch (e) {}
    
    // Load broadcast status
    try {
        const res = await fetch(`${API_BASE}/v1/docs/broadcast-status`, { headers });
        if (res.ok) {
            const data = await res.json();
            document.getElementById('ref-broadcast-status').innerHTML = `
                <div style="display:flex;justify-content:space-between;margin-bottom:8px;">
                    <span>Status:</span>
                    <strong>${data.is_paused ? 'PAUSED' : 'ACTIVE'}</strong>
                </div>
                <div style="display:flex;justify-content:space-between;">
                    <span>Last broadcast:</span>
                    <span>${data.last_broadcast || 'N/A'}</span>
                </div>
            `;
        }
    } catch (e) {
        document.getElementById('ref-broadcast-status').textContent = 'Signal server unavailable';
    }
}

function renderRefNodes() {
    const tbody = document.getElementById('ref-nodes-tbody');
    tbody.innerHTML = refNodesData.map(n => `
        <tr>
            <td>${n.ref || n.email}</td>
            <td>${n.label || n.name}</td>
            <td>${n.namespace || n.org_name || '-'}</td>
            <td><span class="tier-badge tier-${n.tier || 'open'}">${n.tier || 'open'}</span></td>
            <td><span class="ref-status ${n.active ? 'active' : 'archived'}">${n.active ? 'Active' : 'Archived'}</span></td>
            <td>
                ${n.active 
                    ? `<button class="ref-action-btn archive" onclick="refArchiveNode('${n.id}')">Archive</button>`
                    : `<button class="ref-action-btn restore" onclick="refRestoreNode('${n.id}')">Restore</button>`
                }
            </td>
        </tr>
    `).join('');
}

function filterRefNodes() {
    const search = document.getElementById('ref-search-nodes').value.toLowerCase();
    const filtered = refNodesData.filter(n => 
        (n.ref || n.email || '').toLowerCase().includes(search) ||
        (n.label || n.name || '').toLowerCase().includes(search) ||
        (n.namespace || n.org_name || '').toLowerCase().includes(search)
    );
    const tbody = document.getElementById('ref-nodes-tbody');
    tbody.innerHTML = filtered.map(n => `
        <tr>
            <td>${n.ref || n.email}</td>
            <td>${n.label || n.name}</td>
            <td>${n.namespace || n.org_name || '-'}</td>
            <td><span class="tier-badge tier-${n.tier || 'open'}">${n.tier || 'open'}</span></td>
            <td><span class="ref-status ${n.active ? 'active' : 'archived'}">${n.active ? 'Active' : 'Archived'}</span></td>
            <td>
                ${n.active 
                    ? `<button class="ref-action-btn archive" onclick="refArchiveNode('${n.id}')">Archive</button>`
                    : `<button class="ref-action-btn restore" onclick="refRestoreNode('${n.id}')">Restore</button>`
                }
            </td>
        </tr>
    `).join('');
}

function renderRefNamespaces() {
    const tbody = document.getElementById('ref-namespaces-tbody');
    tbody.innerHTML = refNamespacesData.map(ns => `
        <tr>
            <td>${ns.name}</td>
            <td><code style="font-size:11px;">${ns.slug}</code></td>
            <td><span class="tier-badge tier-${ns.tier || 'open'}">${ns.tier || 'open'}</span></td>
            <td>${ns.node_count || 0}</td>
            <td><span class="ref-status ${ns.is_banned ? 'frozen' : 'active'}">${ns.is_banned ? 'Frozen' : 'Active'}</span></td>
            <td>
                ${ns.is_banned 
                    ? `<button class="ref-action-btn restore" onclick="refUnfreezeNamespace('${ns.id}')">Unfreeze</button>`
                    : `<button class="ref-action-btn archive" onclick="refFreezeNamespace('${ns.id}')">Freeze</button>`
                }
                <button class="ref-action-btn export" onclick="refExportNamespace('${ns.id}')">Export</button>
            </td>
        </tr>
    `).join('');
}

function renderRefViolations(violations) {
    const tbody = document.getElementById('ref-violations-tbody');
    tbody.innerHTML = violations.length ? violations.map(v => `
        <tr>
            <td>${new Date(v.created_at).toLocaleString()}</td>
            <td>${v.org_name || v.org_slug || '-'}</td>
            <td><code style="font-size:11px;">${v.endpoint}</code></td>
            <td>${v.ip_address}</td>
            <td>${v.request_count}/${v.limit_value}</td>
        </tr>
    `).join('') : '<tr><td colspan="5" style="text-align:center;color:var(--text-muted);">No violations</td></tr>';
}

function renderRefHoneypot(attempts) {
    const tbody = document.getElementById('ref-honeypot-tbody');
    tbody.innerHTML = attempts.length ? attempts.slice().reverse().map(a => `
        <tr>
            <td>${new Date(a.timestamp).toLocaleString()}</td>
            <td>${a.ip}</td>
            <td><code style="font-size:11px;">${a.endpoint}</code></td>
            <td>${a.method}</td>
            <td style="max-width:200px;overflow:hidden;text-overflow:ellipsis;">${a.user_agent || '-'}</td>
        </tr>
    `).join('') : '<tr><td colspan="5" style="text-align:center;color:var(--text-muted);">No trap hits yet üé£</td></tr>';
}

function showRefTab(tabId, el) {
    document.querySelectorAll('.ref-content').forEach(c => c.classList.remove('active'));
    document.querySelectorAll('.ref-tab').forEach(t => t.classList.remove('active'));
    document.getElementById('ref-tab-' + tabId).classList.add('active');
    if (el) el.classList.add('active');
}

async function refArchiveNode(nodeId) {
    if (!confirm('Archive this node?')) return;
    const apiKey = localStorage.getItem('onto_first_api_key');
    try {
        const res = await fetch(`${API_BASE}/v1/docs/node-index/${nodeId}/archive`, {
            method: 'POST',
            headers: { 'x-api-key': apiKey }
        });
        if (res.ok) {
            showToast('Node archived', 'success');
            loadReferenceData();
        } else {
            showToast('Failed to archive', 'error');
        }
    } catch (e) {
        showToast('Error: ' + e.message, 'error');
    }
}

async function refRestoreNode(nodeId) {
    const apiKey = localStorage.getItem('onto_first_api_key');
    try {
        const res = await fetch(`${API_BASE}/v1/docs/node-index/${nodeId}/restore`, {
            method: 'POST',
            headers: { 'x-api-key': apiKey }
        });
        if (res.ok) {
            showToast('Node restored', 'success');
            loadReferenceData();
        } else {
            showToast('Failed to restore', 'error');
        }
    } catch (e) {
        showToast('Error: ' + e.message, 'error');
    }
}

async function refFreezeNamespace(nsId) {
    if (!confirm('Freeze this namespace? All API keys will be disabled.')) return;
    const apiKey = localStorage.getItem('onto_first_api_key');
    try {
        const res = await fetch(`${API_BASE}/v1/docs/namespace-registry/${nsId}/freeze`, {
            method: 'POST',
            headers: { 'x-api-key': apiKey }
        });
        if (res.ok) {
            showToast('Namespace frozen', 'success');
            loadReferenceData();
        } else {
            showToast('Failed to freeze', 'error');
        }
    } catch (e) {
        showToast('Error: ' + e.message, 'error');
    }
}

async function refUnfreezeNamespace(nsId) {
    const apiKey = localStorage.getItem('onto_first_api_key');
    try {
        const res = await fetch(`${API_BASE}/v1/docs/namespace-registry/${nsId}/unfreeze`, {
            method: 'POST',
            headers: { 'x-api-key': apiKey }
        });
        if (res.ok) {
            showToast('Namespace unfrozen', 'success');
            loadReferenceData();
        } else {
            showToast('Failed to unfreeze', 'error');
        }
    } catch (e) {
        showToast('Error: ' + e.message, 'error');
    }
}

async function refExportNamespace(nsId) {
    const apiKey = localStorage.getItem('onto_first_api_key');
    try {
        const res = await fetch(`${API_BASE}/v1/docs/namespace-export/${nsId}`, {
            headers: { 'x-api-key': apiKey }
        });
        if (res.ok) {
            const data = await res.json();
            const blob = new Blob([JSON.stringify(data, null, 2)], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `namespace-${nsId}-export.json`;
            a.click();
            URL.revokeObjectURL(url);
            showToast('Export downloaded', 'success');
        } else {
            showToast('Failed to export', 'error');
        }
    } catch (e) {
        showToast('Error: ' + e.message, 'error');
    }
}

async function refBroadcastAction(action) {
    const apiKey = localStorage.getItem('onto_first_api_key');
    try {
        const res = await fetch(`${API_BASE}/v1/docs/broadcast-control?action=${action}`, {
            method: 'POST',
            headers: { 'x-api-key': apiKey }
        });
        if (res.ok) {
            showToast(`Broadcast ${action} successful`, 'success');
            loadReferenceData();
        } else {
            showToast('Failed: ' + action, 'error');
        }
    } catch (e) {
        showToast('Error: ' + e.message, 'error');
    }
}

// Check reference access on load
setTimeout(checkReferenceAccess, 1000);

// === TELEMETRY ===
function updateUTCClock() {
    const el = document.getElementById('utc-clock');
    if (!el) return;
    const now = new Date();
    el.textContent = now.toISOString().substr(11, 8) + ' UTC';
}

function updateSparkline() {
    const container = document.getElementById('sparkline');
    if (!container) return;
    
    // Generate 7 random bars for week activity
    const heights = Array(7).fill(0).map(() => Math.floor(Math.random() * 16) + 4);
    container.innerHTML = heights.map(h => 
        `<div class="spark" style="height: ${h}px"></div>`
    ).join('');
}

function drawIndustryChart() {
    const canvas = document.getElementById('industry-canvas');
    const legend = document.getElementById('industry-legend');
    if (!canvas || !legend) return;
    
    const ctx = canvas.getContext('2d');
    const data = [
        { label: 'Finance', value: 28, color: '#f59e0b' },
        { label: 'Healthcare', value: 22, color: '#ef4444' },
        { label: 'AI Labs', value: 18, color: '#22c55e' },
        { label: 'Enterprise', value: 12, color: '#3b82f6' },
        { label: 'Other', value: 20, color: '#6b7280' }
    ];
    
    const total = data.reduce((sum, d) => sum + d.value, 0);
    const cx = canvas.width / 2;
    const cy = canvas.height / 2;
    const radius = Math.min(cx, cy) - 10;
    
    // Clear canvas
    ctx.clearRect(0, 0, canvas.width, canvas.height);
    
    let startAngle = -Math.PI / 2;
    data.forEach(d => {
        const sliceAngle = (d.value / total) * 2 * Math.PI;
        ctx.beginPath();
        ctx.moveTo(cx, cy);
        ctx.arc(cx, cy, radius, startAngle, startAngle + sliceAngle);
        ctx.closePath();
        ctx.fillStyle = d.color;
        ctx.fill();
        startAngle += sliceAngle;
    });
    
    // Legend
    legend.innerHTML = data.map(d => 
        `<div class="legend-item">
            <span class="legend-dot" style="background: ${d.color}"></span>
            <span>${d.label}</span>
            <span class="legend-value">${d.value}%</span>
        </div>`
    ).join('');
}

// === INIT ===
document.addEventListener('DOMContentLoaded', () => {
    checkWelcomeBanner();
    updateSignalHash();
    drawIndustryChart();
    updateSparkline();
});

// Check for email verification callback
const urlParams = new URLSearchParams(window.location.search);
if (urlParams.get('verified') === 'true') {
    showVerifySuccess();
}

// Check reference access on load
setTimeout(checkReferenceAccess, 1000);
</script>
</body>
</html>
