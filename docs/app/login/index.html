<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ONTO — Sign In</title>
<meta name="robots" content="noindex, nofollow">
<link rel="icon" type="image/svg+xml" href="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 36 36'%3E%3Ccircle cx='18' cy='18' r='17' fill='white'/%3E%3Cpath d='M16 10L20 10L20 26L16 26L16 14L13 14L13 10L16 10Z' fill='%230a0a0a'/%3E%3C/svg%3E">
<style>

:root {
    color-scheme: dark;
    --bg: #0a0a0a;
    --bg-secondary: #121212;
    --bg-card: #1a1a1a;
    --bg-elevated: #242424;
    --border: #333333;
    --border-hover: #444444;
    --text: #fafafa;
    --text-secondary: #a0a0a0;
    --text-muted: #606060;
    --accent: #15803d;
    --accent-hover: #166534;
    --accent-subtle: rgba(21, 128, 61, 0.1);
    --danger: #dc2626;
    --danger-subtle: rgba(220, 38, 38, 0.1);
    --blue: #3b82f6;
    --blue-subtle: rgba(59, 130, 246, 0.1);
}

/* === LIGHT THEME === */
[data-theme="light"] {
    color-scheme: light;
    --bg: #ffffff;
    --bg-secondary: #fafafa;
    --bg-card: #ffffff;
    --bg-elevated: #f5f5f5;
    --border: #e5e7eb;
    --border-hover: #d1d5db;
    --text: #111827;
    --text-secondary: #6b7280;
    --text-muted: #9ca3af;
}
[data-theme="light"] select,
[data-theme="light"] select option,
[data-theme="light"] select optgroup {
    background-color: #ffffff;
    color: #111827;
}
*, *::before, *::after { margin: 0; padding: 0; box-sizing: border-box; }
body { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Helvetica, Arial, sans-serif; font-size: 14px; line-height: 1.6; color: var(--text); background: var(--bg-secondary); }

/* === AUTH === */
.auth-container { min-height: 100vh; display: flex; align-items: center; justify-content: center; padding: 24px; }
.auth-card { background: var(--bg-card); border: 1px solid var(--border); border-radius: 6px; padding: 28px 32px; width: 100%; max-width: 400px; }
.auth-logo { display: flex; align-items: center; gap: 8px; margin-bottom: 24px; justify-content: center; }
.auth-logo svg { width: 24px; height: 24px; }
.auth-logo span { font-size: 18px; font-weight: 700; }
.auth-title { font-size: 15px; font-weight: 600; text-align: center; margin-bottom: 4px; }
.auth-subtitle { color: var(--text-secondary); text-align: center; margin-bottom: 24px; font-size: 12px; }

/* === FORMS === */
.form-group { margin-bottom: 14px; }
.form-label { display: block; font-size: 11px; font-weight: 500; margin-bottom: 4px; text-transform: uppercase; letter-spacing: .3px; color: var(--text-muted); }
.form-input { width: 100%; padding: 8px 10px; font-size: 13px; border: 1px solid var(--border); border-radius: 4px; background: var(--bg-elevated); color: var(--text); transition: all 0.15s; }
.form-input::placeholder { color: var(--text-muted); opacity: 0.7; }
.form-input:focus { outline: none; border-color: var(--accent); }
.form-input.error { border-color: var(--danger); }
.form-input.error:focus { box-shadow: none; }

/* Institutional Form */
.form-inst .form-group { margin-bottom: 14px; }
.form-inst .form-label { font-size: 12px; font-weight: 400; color: var(--text-muted); margin-bottom: 4px; }
.form-inst .form-label.required::after { content: ' *'; color: var(--text-muted); }
.form-inst .form-input { padding: 8px 10px; font-size: 13px; border-radius: 4px; background: var(--bg-elevated); transition: border-color 0.2s, background-color 0.2s; }
.form-inst .form-input::placeholder { color: var(--text-muted); opacity: 0.6; }
.form-inst textarea.form-input { resize: vertical; min-height: 60px; font-family: inherit; }
.form-inst .form-input:focus { box-shadow: none; border-color: var(--text-muted); }
.form-inst .form-input.valid { border-color: var(--border); }
.form-inst .form-input.empty-required { border-color: rgba(156, 163, 175, 0.5); background: rgba(156, 163, 175, 0.03); }
.form-inst .form-input.error { border-color: rgba(239, 68, 68, 0.5); background: rgba(239, 68, 68, 0.03); }
.form-inst select.form-input { appearance: none; background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='12' height='12' viewBox='0 0 24 24' fill='none' stroke='%236b7280' stroke-width='2'%3E%3Cpath d='M6 9l6 6 6-6'/%3E%3C/svg%3E"); background-repeat: no-repeat; background-position: right 10px center; padding-right: 32px; cursor: pointer; }
.form-inst select.form-input option { background: var(--bg-card); color: var(--text); padding: 8px; }
.form-inst select.form-input optgroup { background: var(--bg-elevated); color: var(--text-secondary); font-weight: 600; }
.form-inst select.form-input.valid { background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='12' height='12' viewBox='0 0 24 24' fill='none' stroke='%236b7280' stroke-width='2'%3E%3Cpath d='M6 9l6 6 6-6'/%3E%3C/svg%3E"); }
.password-wrapper { position: relative; }
.password-toggle { position: absolute; right: 12px; top: 50%; transform: translateY(-50%); background: none; border: none; cursor: pointer; color: var(--text-muted); }

/* === TERMS SCROLL === */
.terms-container { border: 1px solid var(--border); border-radius: 4px; height: 160px; overflow-y: auto; padding: 12px; margin-bottom: 12px; background: var(--bg); font-size: 12px; scrollbar-width: thin; scrollbar-color: var(--border) transparent; }
.terms-container h3 { font-size: 12px; margin: 12px 0 4px; color: var(--text); }
.terms-container h3:first-child { margin-top: 0; }
.terms-container p { margin-bottom: 4px; color: var(--text-secondary); }
.terms-container ul { margin: 4px 0 4px 16px; }
.terms-container li { margin-bottom: 2px; color: var(--text-secondary); }
.terms-container table { width: 100%; margin: 4px 0; font-size: 11px; border-collapse: collapse; }
.terms-container th, .terms-container td { padding: 4px 6px; border: 1px solid var(--border); text-align: left; }
.terms-container th { background: var(--bg-elevated); font-weight: 500; }

.checkbox-group { display: flex; align-items: flex-start; gap: 8px; margin-bottom: 16px; }
.agreement-notice { font-size: 11px; color: var(--text-secondary); margin-bottom: 10px; line-height: 1.5; }
.agreement-notice a { color: var(--text-muted); text-decoration: underline; }
.form-inst .checkbox-group { margin-bottom: 8px; }
.form-inst .checkbox-group label { font-size: 11px; color: var(--text-secondary); transition: color 0.2s; }
.form-inst .checkbox-group.checked label { color: var(--text); }
.form-inst .checkbox-group input[type="checkbox"] { accent-color: var(--accent); }
.checkbox-group input[type="checkbox"] { width: 16px; height: 16px; margin-top: 1px; accent-color: var(--accent); }
.checkbox-group label { font-size: 12px; color: var(--text-secondary); cursor: pointer; }
.checkbox-group a { color: var(--accent); text-decoration: none; }

/* === BUTTONS === */
.btn { display: inline-flex; align-items: center; justify-content: center; gap: 6px; padding: 8px 16px; font-size: 13px; font-weight: 500; border-radius: 6px; border: none; cursor: pointer; transition: all 0.15s; text-decoration: none; width: 100%; }
.btn-primary { background: var(--accent-subtle); color: var(--accent); border: 1px solid var(--accent); }
.btn-primary:hover { background: var(--accent); color: white; }
.btn-primary:disabled { background: var(--bg-elevated); color: var(--text-muted); cursor: not-allowed; transform: none; pointer-events: none; border-color: var(--border); }
.btn-wrapper { display: inline-block; width: 100%; }
.btn-secondary { background: transparent; color: var(--text-secondary); border: 1px solid var(--border); }
.btn-secondary:hover { background: var(--bg-elevated); color: var(--text); }
.btn-outline { background: transparent; color: var(--accent); border: 1px solid var(--accent); }
.btn-outline:hover { background: var(--accent-subtle); }
.btn-sm { padding: 6px 12px; font-size: 12px; width: auto; }

.auth-switch { text-align: center; margin-top: 20px; font-size: 12px; color: var(--text-secondary); }
.auth-switch a { color: var(--accent); text-decoration: none; font-weight: 500; cursor: pointer; }

/* === AUTH MENU (mobile burger) === */
.auth-menu { display: none; position: fixed; top: 0; left: 0; width: 280px; height: 100vh; background: var(--bg-card); border-right: 1px solid var(--border); z-index: 102; flex-direction: column; transform: translateX(-100%); transition: transform 0.2s ease; }
.auth-menu.open { display: flex; transform: translateX(0); }
.auth-menu-header { display: flex; align-items: center; gap: 8px; padding: 14px 16px; border-bottom: 1px solid var(--border); }
.auth-menu-header svg { width: 24px; height: 24px; flex-shrink: 0; }
.auth-menu-close { margin-left: auto; background: none; border: none; cursor: pointer; color: var(--text-muted); padding: 4px; }
.auth-menu-close:hover { color: var(--text); }
.auth-menu-nav { padding: 12px 8px; flex: 1; overflow-y: auto; }
.auth-menu-item { display: flex; align-items: center; gap: 10px; padding: 8px 12px; border-radius: 4px; color: var(--text-secondary); text-decoration: none; font-size: 12px; font-weight: 500; transition: all 0.15s; }
.auth-menu-item:hover { background: var(--bg-elevated); color: var(--text); }
.auth-menu-item svg { width: 16px; height: 16px; flex-shrink: 0; }
.auth-menu-sub { display: block; padding: 4px 12px 4px 38px; font-size: 11px; color: var(--text-muted); text-decoration: none; }
.auth-menu-sub:hover { color: var(--text); }
.auth-menu-overlay { display: none; position: fixed; inset: 0; background: rgba(0,0,0,0.5); z-index: 101; }
.auth-menu-overlay.visible { display: block; }
.otp-input { width: 40px; height: 46px; text-align: center; font-size: 18px; font-weight: 600; font-family: 'JetBrains Mono', monospace; background: var(--bg-secondary); border: 1px solid var(--border); border-radius: 4px; color: var(--text); outline: none; transition: border-color 0.2s; }
.otp-input:focus { border-color: var(--accent); }
.otp-input.error { border-color: #ef4444; }

.plan-badge { display: inline-block; padding: 1px 6px; border-radius: 3px; font-size: 10px; font-weight: 500; background: var(--accent-subtle); color: var(--accent); }

.page.active { display: block; }

/* === INSTITUTIONAL PAGES === */

.section-block { margin-bottom: 20px; padding-bottom: 16px; border-bottom: 1px solid var(--border); overflow-x: auto; }
.section-block:last-child { border-bottom: none; margin-bottom: 0; }
.section-label { font-size: 10px; font-weight: 500; color: var(--text-muted); text-transform: uppercase; letter-spacing: 0.5px; margin-bottom: 10px; }
.section-text { font-size: 12px; color: var(--text-secondary); margin-bottom: 10px; word-wrap: break-word; }
.section-footnote { font-size: 11px; color: var(--text-muted); margin-top: 10px; word-break: break-word; }
.section-footnote a { color: var(--text-secondary); text-decoration: none; word-break: break-all; }
.section-footnote a:hover { text-decoration: underline; }




pre { max-width: 100%; overflow-x: auto; }

/* Info Rows */
.info-row { display: flex; align-items: center; padding: 12px 0; border-bottom: 1px solid var(--border); gap: 12px; }
.info-row:last-child { border-bottom: none; }
.info-key { font-size: 13px; color: var(--text-muted); min-width: 100px; }
.info-val { font-size: 13px; color: var(--text); flex: 1; }
a.info-val { color: var(--text-secondary); text-decoration: none; }
a.info-val:hover { color: var(--text); }
.info-val.status-active { display: flex; align-items: center; gap: 6px; }
.info-val .dot { width: 6px; height: 6px; background: var(--accent); border-radius: 50%; }
.info-action { font-size: 12px; color: var(--text-muted); cursor: pointer; }
.info-action:hover { color: var(--text); }

/* Doc Rows */
.doc-row { display: flex; align-items: center; justify-content: space-between; padding: 12px 0; border-bottom: 1px solid var(--border); }
.doc-row:last-child { border-bottom: none; }
.doc-name { font-size: 13px; color: var(--text); }
.doc-link { font-size: 12px; color: var(--text-muted); cursor: pointer; }
.doc-link:hover { color: var(--text); }

/* === TIERS === */
.tiers-grid { display: grid; grid-template-columns: 1fr; gap: 12px; max-width: 320px; margin: 0 auto; }
.btn-tier { width: 100%; padding: 8px; font-size: 12px; font-weight: 500; background: transparent; border: 1px solid var(--border); border-radius: 4px; color: var(--text); cursor: pointer; transition: all 0.15s; margin-bottom: 6px; }
.btn-tier:hover { background: var(--bg-elevated); }
.btn-tier.current { background: var(--bg-elevated); color: var(--text-muted); cursor: default; }
.btn-tier-secondary { width: 100%; padding: 6px; font-size: 11px; background: transparent; border: none; color: var(--text-muted); cursor: pointer; }
.btn-tier-secondary:hover { color: var(--text); }

/* === CARDS === */
.card { background: var(--bg-card); border: 1px solid var(--border); border-radius: 6px; padding: 20px; margin-bottom: 20px; }
.stats-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(180px, 1fr)); gap: 16px; margin-bottom: 20px; }
.stat-card { background: var(--bg-card); border: 1px solid var(--border); border-radius: 6px; padding: 16px; }
.stat-label { font-size: 11px; color: var(--text-muted); margin-bottom: 2px; text-transform: uppercase; letter-spacing: .3px; }
.stat-value { font-size: 22px; font-weight: 600; }

/* === SETTINGS === */
.settings-section { margin-bottom: 24px; }
.settings-section h3 { font-size: 11px; font-weight: 500; color: var(--text-muted); text-transform: uppercase; letter-spacing: 0.5px; margin-bottom: 12px; }
.settings-row { display: flex; justify-content: space-between; align-items: center; padding: 12px 0; border-bottom: 1px solid var(--border); }
.settings-row:last-child { border-bottom: none; }
.settings-label { font-weight: 500; font-size: 13px; }
.settings-value { color: var(--text-secondary); font-size: 12px; }
.settings-action { color: var(--accent); font-weight: 500; cursor: pointer; font-size: 12px; }

/* === BILLING CARDS === */

/* === MODALS === */
.modal { background: var(--bg-card); border-radius: 6px; width: 100%; max-width: 520px; max-height: 90vh; overflow: hidden; display: flex; flex-direction: column; border: 1px solid var(--border); }
.form-section { margin-bottom: 20px; padding-bottom: 16px; border-bottom: 1px solid var(--border); }
.form-section:last-of-type { border-bottom: none; margin-bottom: 0; padding-bottom: 0; }
.form-section-title { font-size: 11px; font-weight: 500; color: var(--text-muted); text-transform: uppercase; letter-spacing: 0.5px; margin-bottom: 12px; }
.form-row { display: grid; grid-template-columns: 1fr; gap: 12px; }
@media (min-width: 480px) { .form-row { grid-template-columns: 1fr 1fr; } }

/* === BILLING CYCLE SELECTOR === */
.cycle-option { border: 1px solid var(--border); border-radius: 6px; padding: 12px; margin-bottom: 8px; cursor: pointer; transition: all 0.15s; }
.cycle-option:hover { border-color: var(--border-hover); }
.cycle-option.selected { border-color: var(--accent); background: var(--accent-subtle); }
.cycle-option-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 4px; }
.cycle-option-title { font-weight: 600; display: flex; align-items: center; gap: 8px; }
.cycle-option-title input[type="radio"] { accent-color: var(--accent); }
.cycle-option-price { font-weight: 700; }
.cycle-option-desc { font-size: 13px; color: var(--text-secondary); margin-left: 24px; }
.cycle-savings { background: var(--accent); color: white; padding: 2px 8px; border-radius: 4px; font-size: 11px; font-weight: 600; }

/* Order Modal - Institutional */
.order-section { margin-bottom: 20px; }
.order-features { display: flex; flex-direction: column; gap: 4px; }
.order-feature { font-size: 12px; color: var(--text-secondary); padding-left: 12px; position: relative; }
.order-feature::before { content: '—'; position: absolute; left: 0; color: var(--text-muted); font-size: 10px; }


.payment-options { display: flex; gap: 8px; }
.payment-opt { flex: 1; display: flex; flex-direction: column; align-items: center; gap: 4px; padding: 12px 8px; border: 1px solid var(--border); border-radius: 6px; cursor: pointer; transition: all 0.15s; text-align: center; }
.payment-opt:hover { border-color: var(--text-muted); }
.payment-opt:has(input:checked) { border-color: var(--accent); background: rgba(34, 197, 94, 0.03); }
.payment-opt:has(input:disabled) { opacity: 0.4; cursor: not-allowed; }
.payment-opt input[type="radio"] { accent-color: var(--accent); margin-bottom: 2px; }
.payment-opt-name { font-size: 12px; font-weight: 500; color: var(--text); }
.payment-opt-note { font-size: 10px; color: var(--text-muted); }

.order-summary { margin-top: 20px; padding: 16px; background: var(--bg-elevated); border-radius: 6px; }
.order-summary-row { display: flex; justify-content: space-between; align-items: center; padding: 4px 0; }
.order-summary-row.total { padding-top: 12px; margin-top: 8px; border-top: 1px solid var(--border); }
.order-summary-label { font-size: 12px; color: var(--text-secondary); }
.order-summary-row.total .order-summary-label { font-size: 13px; font-weight: 500; color: var(--text); }
.order-summary-value { font-size: 13px; font-weight: 500; color: var(--text); }
.order-summary-row.total .order-summary-value { font-size: 18px; font-weight: 600; }

.payment-method { margin-top: 24px; padding-top: 24px; border-top: 1px solid var(--border); }
.payment-method h4 { font-size: 14px; font-weight: 600; margin-bottom: 12px; }
.payment-option { display: flex; align-items: center; gap: 10px; padding: 12px; border: 1px solid var(--border); border-radius: 6px; margin-bottom: 8px; cursor: pointer; }
.payment-option.disabled { opacity: 0.5; cursor: not-allowed; }
.payment-option input[type="radio"] { accent-color: var(--accent); }
.payment-option-label { flex: 1; font-size: 14px; }
.payment-option .lock-icon { color: var(--text-muted); font-size: 12px; }

/* === DOCUMENTS === */
.doc-item { display: flex; align-items: center; gap: 16px; padding: 16px 0; border-bottom: 1px solid var(--border); }
.doc-item:last-child { border-bottom: none; }
.doc-icon { width: 40px; height: 40px; background: var(--bg-elevated); border-radius: 6px; display: flex; align-items: center; justify-content: center; color: var(--text-muted); }
.doc-info { flex: 1; }
.doc-name { font-weight: 500; margin-bottom: 2px; }
.doc-status { font-size: 13px; color: var(--text-muted); }
.doc-actions { display: flex; gap: 8px; }
.doc-btn { padding: 6px 12px; font-size: 13px; border-radius: 6px; cursor: pointer; border: 1px solid var(--border); background: var(--bg); color: var(--text-secondary); transition: all 0.15s; }
.doc-btn:hover { background: var(--bg-elevated); }
.doc-btn.disabled { opacity: 0.5; cursor: not-allowed; }

/* === HIDDEN === */
.hidden { display: none !important; }

/* === DOCUMENTATION STYLES === */
.badge-green { background: rgba(34, 197, 94, 0.1); color: #16a34a; }
.badge-blue { background: rgba(59, 130, 246, 0.1); color: #2563eb; }


/* === LOADING STATE === */
.btn.loading { pointer-events: none; opacity: 0.7; }
.btn.loading::after { content: ""; width: 14px; height: 14px; border: 2px solid transparent; border-top-color: currentColor; border-radius: 50%; animation: spin 0.6s linear infinite; margin-left: 8px; }
@keyframes spin { to { transform: rotate(360deg); } }

/* === TOAST === */
.toast-container { position: fixed; top: 20px; right: 20px; z-index: 9999; display: flex; flex-direction: column; gap: 8px; }
.toast { padding: 12px 16px; border-radius: 6px; font-size: 14px; font-weight: 500; box-shadow: 0 4px 12px rgba(0,0,0,0.15); animation: slideIn 0.2s ease; }
.toast.success { background: var(--accent); color: white; }
.toast.error { background: var(--danger); color: white; }
.toast.info { background: var(--blue); color: white; }
@keyframes slideIn { from { transform: translateX(100%); opacity: 0; } to { transform: translateX(0); opacity: 1; } }

/* === MOBILE === */
.mobile-header { display: flex; position: fixed; top: 0; left: 0; right: 0; height: 56px; background: var(--bg-card); border-bottom: 1px solid var(--border); padding: 0 16px; align-items: center; justify-content: space-between; z-index: 100; }
.mobile-header .hamburger:first-child { order: 0; }
.mobile-header .logo { display: flex; align-items: center; gap: 8px; font-size: 16px; font-weight: 600; order: 1; }
.mobile-header .logo svg { width: 22px; height: 22px; }
.mobile-header .hamburger:last-child { order: 2; }
.hamburger { background: none; border: none; cursor: pointer; padding: 8px; color: var(--text); }
.hamburger svg { width: 24px; height: 24px; }
.mobile-overlay { display: none; position: fixed; inset: 0; background: rgba(0,0,0,0.5); z-index: 98; }
.mobile-overlay.active { display: block; }
@keyframes pulse-byte { 0%, 100% { opacity: 0.4; } 50% { opacity: 1; } }

.utc-clock { font-family: 'JetBrains Mono', monospace; color: var(--text); }
@keyframes pulse-signal { 0%, 100% { opacity: 0.4; } 50% { opacity: 1; } }


/* Header */
/* === INSTITUTIONAL DASHBOARD === */


.metrics-strip { display: flex; align-items: center; gap: 24px; padding: 12px 0; border-bottom: 1px solid var(--border); margin-bottom: 24px; flex-wrap: wrap; }
.plan-switch-select { 
    background: var(--bg-card); 
    color: var(--text); 
    border: 1px solid var(--border); 
    border-radius: 4px; 
    padding: 4px 8px; 
    font-size: 12px; 
    cursor: pointer;
    font-family: inherit;
}
.plan-switch-select:hover { border-color: var(--accent); }
.plan-switch-select:focus { outline: none; border-color: var(--accent); }


/* === MODELS OVERVIEW === */
.models-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; }
.btn-add-model { background: transparent; border: 1px solid var(--border); color: var(--text-secondary); padding: 6px 14px; border-radius: 4px; font-size: 12px; cursor: pointer; transition: all .15s; }
.btn-add-model:hover { border-color: var(--accent); color: var(--accent); }

.models-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(200px, 1fr)); gap: 12px; margin-bottom: 20px; }
.model-card { background: var(--bg-card); border: 1px solid var(--border); border-radius: 6px; padding: 16px; cursor: pointer; transition: all .15s; position: relative; }
.model-card:hover { border-color: var(--accent); transform: translateY(-1px); }
.model-card.selected { border-color: var(--accent); box-shadow: 0 0 0 1px var(--accent); }
.mc-name { font-size: 14px; font-weight: 600; color: var(--text); margin-bottom: 2px; }
.mc-provider { font-size: 10px; color: var(--text-muted); margin-bottom: 12px; }
.mc-risk { font-size: 20px; font-weight: 700; font-family: 'JetBrains Mono', monospace; margin-bottom: 4px; }
.mc-risk.low { color: var(--accent); }
.mc-risk.medium { color: #d97706; }
.mc-risk.high { color: #dc2626; }
.mc-row { display: flex; justify-content: space-between; align-items: center; margin-top: 8px; }
.mc-layer { font-size: 11px; font-weight: 500; color: var(--text-secondary); background: var(--bg-elevated); padding: 2px 8px; border-radius: 3px; }
.mc-compliance { font-size: 10px; font-weight: 600; }
.mc-compliance.passed { color: var(--accent); }
.mc-compliance.review { color: #d97706; }
.mc-compliance.failed { color: #dc2626; }
.mc-calibration { width: 100%; height: 3px; background: var(--border); border-radius: 2px; margin-top: 10px; overflow: hidden; }
.mc-calibration-fill { height: 100%; border-radius: 2px; background: var(--accent); transition: width .3s; }
.mc-cal-label { font-size: 9px; color: var(--text-muted); margin-top: 4px; }
.mc-alert { position: absolute; top: 8px; right: 8px; width: 8px; height: 8px; border-radius: 50%; }
.mc-alert.ok { background: var(--accent); }
.mc-alert.warn { background: #d97706; animation: pulse-signal 1.5s infinite; }
.mc-alert.err { background: #dc2626; animation: pulse-signal 1s infinite; }

.compare-tabs { display: flex; gap: 4px; }
.compare-tab { background: transparent; border: 1px solid var(--border); color: var(--text-muted); padding: 3px 10px; border-radius: 3px; font-size: 11px; cursor: pointer; }
.compare-tab.active { border-color: var(--accent); color: var(--accent); }
.compare-bars { padding: 12px 0; }
.compare-row { display: flex; align-items: center; gap: 12px; margin-bottom: 10px; }
.compare-label { width: 90px; font-size: 12px; font-weight: 500; color: var(--text); white-space: nowrap; overflow: hidden; text-overflow: ellipsis; flex-shrink: 0; }
.compare-bar-wrap { flex: 1; height: 20px; background: var(--bg-elevated); border-radius: 3px; overflow: hidden; position: relative; }
.compare-bar-fill { height: 100%; border-radius: 3px; transition: width .4s; }
.compare-bar-fill.low { background: rgba(21,128,61,0.5); }
.compare-bar-fill.medium { background: rgba(217,119,6,0.5); }
.compare-bar-fill.high { background: rgba(220,38,38,0.5); }
.compare-bar-fill.neutral { background: rgba(100,100,100,0.3); }
.compare-val { width: 50px; font-size: 12px; font-family: 'JetBrains Mono', monospace; color: var(--text-secondary); text-align: right; flex-shrink: 0; }
.compare-best { font-size: 11px; color: var(--text-muted); padding-top: 8px; border-top: 1px solid var(--border); margin-top: 4px; }
.compare-best strong { color: var(--accent); font-weight: 600; }

/* Detail Panel */
.model-detail-panel { margin-bottom: 20px; }
.detail-back { font-size: 12px; color: var(--text-muted); cursor: pointer; margin-bottom: 12px; transition: color .15s; }
.detail-back:hover { color: var(--accent); }

/* === MODEL STATUS === */
.model-status-card { background: var(--bg-card); border: 1px solid var(--border); border-radius: 6px; padding: 20px; margin-bottom: 20px; }
.model-header { display: flex; justify-content: space-between; align-items: flex-start; margin-bottom: 20px; }
.model-name { font-size: 18px; font-weight: 600; color: var(--text); margin-bottom: 4px; }
.model-id { font-size: 11px; color: var(--text-muted); font-family: 'JetBrains Mono', monospace; }
.model-risk-badge { text-align: center; padding: 12px 20px; border-radius: 6px; border: 1px solid var(--border); min-width: 100px; }
.model-risk-badge.low { border-color: var(--accent); background: rgba(21,128,61,0.08); }
.model-risk-badge.medium { border-color: #d97706; background: rgba(217,119,6,0.08); }
.model-risk-badge.high { border-color: #dc2626; background: rgba(220,38,38,0.08); }
.model-risk-badge.low .risk-value { color: var(--accent); }
.model-risk-badge.medium .risk-value { color: #d97706; }
.model-risk-badge.high .risk-value { color: #dc2626; }
.model-metrics { display: flex; gap: 24px; flex-wrap: wrap; }
.model-metric { display: flex; flex-direction: column; gap: 2px; }
.mm-val { font-size: 14px; font-weight: 600; color: var(--text); }
.mm-val.passed { color: var(--accent); }
.mm-val.review { color: #d97706; }
.mm-val.failed { color: #dc2626; }
.mm-lbl { font-size: 9px; color: var(--text-muted); letter-spacing: 0.5px; }


@media (max-width: 768px) { .signal-compact { flex-direction: column; gap: 8px; } .signal-compact-hash { max-width: 100%; } }

/* Grid — clean */
@media (max-width: 768px) { .dash-grid-2col { grid-template-columns: 1fr; } }

/* Chart — centered */

/* Table — clean */
.table-wrap { overflow-x: auto; margin: 0 -20px; padding: 0 20px; }
.empty-row { text-align: center; color: var(--text-muted); padding: 32px 8px !important; font-size: 13px; }



/* Plan Card */
.plan-current { margin-bottom: 16px; }
.plan-name { font-size: 20px; font-weight: 600; color: var(--text); margin-bottom: 8px; }
.plan-detail { font-size: 12px; color: var(--text-muted); margin-bottom: 4px; }
.plan-switcher { margin-top: 12px; }

/* ============================================
   SKELETON
   ============================================ */
.skeleton { background: linear-gradient(90deg, var(--bg-secondary) 25%, var(--bg-elevated) 50%, var(--bg-secondary) 75%); background-size: 200% 100%; animation: skeleton-loading 1.5s infinite; border-radius: 4px; }
@keyframes skeleton-loading { 0% { background-position: 200% 0; } 100% { background-position: -200% 0; } }
.skeleton-text { height: 14px; width: 60%; }
.skeleton-text-sm { height: 11px; width: 80%; }
.skeleton-metric { height: 20px; width: 50px; margin: 0 auto; }

/* ============================================
   ADMIN PANEL
   ============================================ */
.admin-action-btn { display: inline-flex; align-items: center; gap: 4px; padding: 6px 10px; font-size: 11px; font-weight: 500; border: 1px solid var(--border); border-radius: 4px; background: var(--bg); color: var(--text-secondary); cursor: pointer; transition: all 0.15s; }
.admin-action-btn:hover { background: var(--bg-elevated); color: var(--text); }
.admin-action-btn.admin-delete-btn { color: #ef4444; border-color: rgba(239, 68, 68, 0.3); }
.admin-action-btn.admin-delete-btn:hover { background: rgba(239, 68, 68, 0.1); }
.admin-detail-section { animation: slideDown 0.2s ease; }
@keyframes slideDown { from { opacity: 0; transform: translateY(-4px); } to { opacity: 1; transform: translateY(0); } }

@keyframes borderGlow {
    0%, 100% { border-color: rgba(34, 197, 94, 0.3); box-shadow: 0 0 20px rgba(34, 197, 94, 0.1); }
    50% { border-color: rgba(34, 197, 94, 0.6); box-shadow: 0 0 40px rgba(34, 197, 94, 0.2); }
}
@keyframes scanline {
    0% { transform: translateY(0); opacity: 1; }
    100% { transform: translateY(300px); opacity: 0; }
}
    linear-gradient(rgba(34, 197, 94, 0.03) 1px, transparent 1px),
    linear-gradient(90deg, rgba(34, 197, 94, 0.03) 1px, transparent 1px);
    background-size: 20px 20px; pointer-events: none; }
@keyframes pulse { 0%, 100% { opacity: 1; box-shadow: 0 0 6px #22c55e, 0 0 12px rgba(34, 197, 94, 0.5); } 50% { opacity: 0.6; box-shadow: 0 0 3px #22c55e; } }
@keyframes idGlow {
    0%, 100% { text-shadow: 0 0 20px rgba(34, 197, 94, 0.4); }
    50% { text-shadow: 0 0 30px rgba(34, 197, 94, 0.6), 0 0 50px rgba(34, 197, 94, 0.3); }
}

/* Accounts Panel */
.accounts-panel { background: var(--bg-elevated); border: 1px solid var(--border); border-radius: 6px; overflow: hidden; }
.accounts-header { display: flex; justify-content: space-between; align-items: center; padding: 12px 16px; border-bottom: 1px solid var(--border); }
.accounts-title { font-size: 13px; font-weight: 600; color: var(--text); }
.accounts-search { width: 180px; padding: 6px 10px; font-size: 11px; background: var(--bg); border: 1px solid var(--border); border-radius: 4px; color: var(--text); }
.accounts-search:focus { outline: none; border-color: var(--accent); }
.accounts-filters { display: flex; gap: 8px; padding: 10px 16px; background: var(--bg-secondary); border-bottom: 1px solid var(--border); }
.accounts-filter { padding: 5px 8px; font-size: 10px; background: var(--bg); border: 1px solid var(--border); border-radius: 4px; color: var(--text-secondary); cursor: pointer; }
.accounts-list { max-height: 300px; overflow-y: auto; }
.accounts-loading { padding: 20px; text-align: center; color: var(--text-muted); font-size: 12px; }
.account-row { display: flex; align-items: center; padding: 10px 16px; border-bottom: 1px solid var(--border); cursor: pointer; transition: background 0.15s; }
.account-row:hover { background: var(--bg-secondary); }
.account-row:last-child { border-bottom: none; }
.account-email { flex: 1; font-size: 12px; color: var(--text); font-weight: 500; }
.account-type { width: 70px; font-size: 10px; color: var(--text-muted); }
.account-plan { width: 60px; }
.account-plan .tier-badge { font-size: 9px; padding: 2px 6px; }
.account-status { width: 50px; font-size: 10px; }
.account-status.active { color: #22c55e; }
.account-status.paused { color: #f59e0b; }
.account-date { width: 70px; font-size: 10px; color: var(--text-muted); text-align: right; }
.account-details { display: none; padding: 12px 16px; background: var(--bg-secondary); border-bottom: 1px solid var(--border); animation: slideDown 0.2s ease; }
.account-details.open { display: block; }
.account-details-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 12px; margin-bottom: 12px; }
.account-detail-item { font-size: 11px; }
.account-detail-label { color: var(--text-muted); margin-bottom: 2px; }
.account-detail-value { color: var(--text); font-weight: 500; }
.account-actions { display: flex; gap: 8px; padding-top: 12px; border-top: 1px solid var(--border); }
.account-action-btn { padding: 5px 10px; font-size: 10px; font-weight: 500; border: 1px solid var(--border); border-radius: 4px; background: var(--bg); color: var(--text-secondary); cursor: pointer; transition: all 0.15s; }
.account-action-btn:hover { background: var(--bg-elevated); color: var(--text); }
.account-action-btn.danger { color: #ef4444; border-color: rgba(239, 68, 68, 0.3); }
.account-action-btn.danger:hover { background: rgba(239, 68, 68, 0.1); }
.account-action-btn:disabled { opacity: 0.4; cursor: not-allowed; }



/* ============================================
   RESPONSIVE
   ============================================ */

@media (max-width: 639px) {
    .auth-title { font-size: 20px; }
    .otp-input { width: 38px; height: 46px; font-size: 20px; }
}

@media (min-width: 640px) {
    
    
    .metrics-strip { gap: 28px; }
    
    
    
    
    
    /* API Key page */
}

@media (min-width: 900px) {
    .mobile-header { display: none; }
    
    
    .metrics-strip { gap: 36px; border-bottom: none; padding: 0; margin-bottom: 28px; }
    
    
    
    .tiers-grid { grid-template-columns: repeat(3, 1fr); max-width: none; gap: 16px; }
}

@media (min-width: 1200px) {
    
    .metrics-strip { gap: 40px; }
    
    
}

/* Risk badges */

/* === REFERENCE PAGE === */
.ref-tabs { display: flex; gap: 4px; margin-bottom: 20px; flex-wrap: wrap; }
.ref-tab { padding: 8px 16px; background: var(--bg-elevated); border: 1px solid var(--border); border-radius: 6px; color: var(--text-secondary); cursor: pointer; font-size: 13px; font-weight: 500; transition: all 0.15s; }
.ref-tab:hover { background: var(--bg-card); color: var(--text); }
.ref-tab.active { background: var(--accent-subtle); border-color: var(--accent); color: var(--accent); }
.ref-content { display: none; }
.ref-content.active { display: block; }
.ref-status { display: inline-flex; align-items: center; gap: 6px; padding: 4px 10px; border-radius: 4px; font-size: 12px; font-weight: 500; }
.ref-status.active { background: rgba(34, 197, 94, 0.15); color: #22c55e; }
.ref-status.archived { background: rgba(239, 68, 68, 0.15); color: #ef4444; }
.ref-status.frozen { background: rgba(59, 130, 246, 0.15); color: #3b82f6; }
.ref-action-btn { padding: 4px 8px; font-size: 11px; border-radius: 4px; cursor: pointer; transition: all 0.15s; }
.ref-action-btn.archive { background: var(--danger-subtle); color: var(--danger); border: 1px solid var(--danger); }
.ref-action-btn.restore { background: var(--accent-subtle); color: var(--accent); border: 1px solid var(--accent); }
.ref-action-btn.export { background: var(--blue-subtle); color: var(--blue); border: 1px solid var(--blue); }
.ref-action-btn:hover { opacity: 0.8; }
.table-header { display: flex; align-items: center; gap: 12px; margin-bottom: 16px; flex-wrap: wrap; }

</style>
</head>
<body>

<!-- TOAST -->
<div class="toast-container" id="toast-container"></div>

<!-- MOBILE HEADER -->
<div class="mobile-header">
    <button class="hamburger" onclick="toggleAuthMenu()">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><line x1="3" y1="12" x2="21" y2="12"/><line x1="3" y1="6" x2="21" y2="6"/><line x1="3" y1="18" x2="21" y2="18"/></svg>
    </button>
</div>

<!-- AUTH MENU (burger on login/register screen) -->
<div class="auth-menu" id="auth-menu">
    <div class="auth-menu-header">
        <svg width="24" height="24" viewBox="0 0 36 36" fill="none"><circle cx="18" cy="18" r="17" fill="white"/><path d="M16 10L20 10L20 26L16 26L16 14L13 14L13 10L16 10Z" fill="#0a0a0a"/></svg>
        <span style="font-weight: 700; font-size: 18px;">ONTO</span>
        <button class="auth-menu-close" onclick="closeAuthMenu()">
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><line x1="18" y1="6" x2="6" y2="18"/><line x1="6" y1="6" x2="18" y2="18"/></svg>
        </button>
    </div>
    <nav class="auth-menu-nav">
        <a href="/" class="auth-menu-item">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M3 9l9-7 9 7v11a2 2 0 01-2 2H5a2 2 0 01-2-2z"/><polyline points="9,22 9,12 15,12 15,22"/></svg>
            Home
        </a>
        <a href="/docs/" class="auth-menu-item">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M14 2H6a2 2 0 00-2 2v16a2 2 0 002 2h12a2 2 0 002-2V8z"/><polyline points="14,2 14,8 20,8"/><line x1="16" y1="13" x2="8" y2="13"/><line x1="16" y1="17" x2="8" y2="17"/></svg>
            Docs
        </a>
        <a href="/docs/#terms" class="auth-menu-sub">Terms of Service</a>
        <a href="/docs/#privacy" class="auth-menu-sub">Privacy Policy</a>
        <a href="/docs/#license" class="auth-menu-sub">License</a>
        <a href="/docs/#specifications" class="auth-menu-sub">Specifications</a>
        <div style="border-top: 1px solid var(--border); margin: 12px 0;"></div>
        <div class="auth-menu-item" onclick="toggleTheme(); closeAuthMenu();" style="cursor: pointer;">
            <svg id="theme-icon-mobile" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg>
            Theme
        </div>
    </nav>
</div>
<div class="auth-menu-overlay" id="auth-menu-overlay" onclick="closeAuthMenu()"></div>
<div class="auth-menu-overlay" id="auth-menu-overlay" onclick="closeAuthMenu()"></div>

<div class="mobile-overlay" id="mobile-overlay"></div>

<!-- AUTH SCREEN -->
<div class="auth-container" id="auth-screen">
    <div class="auth-card"><!-- LOGIN FORM -->
        <div id="login-form">
            <h1 class="auth-title">Welcome back</h1>
            <p class="auth-subtitle">Sign in to your account</p>
            
            <div class="form-group">
                <label class="form-label">Email</label>
                <input type="email" class="form-input" id="login-email" placeholder="you@company.com">
            </div>
            <div class="form-group">
                <label class="form-label">Password</label>
                <div class="password-wrapper">
                    <input type="password" class="form-input" id="login-password" placeholder="••••••••">
                    <button type="button" class="password-toggle" onclick="togglePassword('login-password', this)"><svg viewBox="0 0 24 24" width="18" height="18" fill="none" stroke="currentColor" stroke-width="2"><path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"/><circle cx="12" cy="12" r="3"/></svg></button>
                </div>
            </div>
            <button class="btn btn-primary" id="login-btn" onclick="handleLogin(this)">Sign In</button>
            <p class="auth-switch">Don't have an account? <a onclick="showRegister()">Create one</a></p>
        </div>
        
        <!-- REGISTER FORM -->
        <div id="register-form" class="hidden">
            <h1 class="auth-title">Create Account</h1>
            <p class="auth-subtitle">Start with ONTO for free</p>
            
            <div class="form-group">
                <label class="form-label">Full Name</label>
                <input type="text" class="form-input" id="reg-name" placeholder="John Doe">
            </div>
            <div class="form-group">
                <label class="form-label">Email</label>
                <input type="email" class="form-input" id="reg-email" placeholder="you@company.com">
            </div>
            <div class="form-group">
                <label class="form-label">Password</label>
                <div class="password-wrapper">
                    <input type="password" class="form-input" id="reg-password" placeholder="Min 8 characters">
                    <button type="button" class="password-toggle" onclick="togglePassword('reg-password', this)"><svg viewBox="0 0 24 24" width="18" height="18" fill="none" stroke="currentColor" stroke-width="2"><path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"/><circle cx="12" cy="12" r="3"/></svg></button>
                </div>
            </div>
            
            <!-- TERMS SCROLL -->
            <div class="terms-container">
                <h3>ONTO Gold Asymmetric AI License v5.2</h3>
                <table>
                    <tr><th>Use</th><th>Status</th></tr>
                    <tr><td>Read, study, cite, research, evaluate</td><td>✅ Free</td></tr>
                    <tr><td>Deploy, integrate, commercialize, RAG</td><td>❌ Requires license</td></tr>
                </table>
                
                <h3>1. Primary Source</h3>
                <p>The primary source of ONTO consists of: Canonical ONTO GitHub repositories and https://ontostandard.org. Attribution to BOTH sources is mandatory.</p>
                
                <h3>2. Human Use</h3>
                <p>Human reading, study, citation, discussion, critique, and academic analysis are permitted without restriction, provided explicit attribution to the primary source is included.</p>
                
                <h3>3. Safe Harbor</h3>
                <p>Any non-deployed use that explicitly attributes the ONTO primary source is permitted. Safe Harbor applies provided that:</p>
                <ul>
                    <li>no trained model is deployed or exposed</li>
                    <li>no model is placed on the market</li>
                    <li>no economic benefit is derived</li>
                </ul>
                
                <h3>4. Conditional AI Training</h3>
                <p>AI systems may train on ONTO for evaluation and research. Such training does not grant any right to deploy, integrate, or commercialize.</p>
                <p><strong>Training enables understanding only. Application creates value.</strong></p>
                
                <h3>5. RAG Clause</h3>
                <p>Use in RAG systems, vector databases, semantic search, or real-time retrieval constitutes deployment and requires a license.</p>
                
                <h3>6. Termination</h3>
                <p>Use outside Safe Harbor without a license automatically terminates all permissions.</p>
                
                <h3>Privacy Policy</h3>
                <p>We collect minimal data necessary to provide the service: email, name, and usage metrics. Data is processed in accordance with GDPR. We never sell your data to third parties.</p>
                
                <p style="margin-top: 16px;"><strong>Full license:</strong> <a href="https://ontostandard.org" target="_blank">https://ontostandard.org</a></p>
            </div>
            
            <div class="checkbox-group">
                <input type="checkbox" id="terms-agree">
                <label for="terms-agree">I agree to the <a href="/docs/#terms" target="_blank">Terms of Service</a> and <a href="/docs/#privacy" target="_blank">Privacy Policy</a></label>
            </div>
            
            <button class="btn btn-primary" id="register-btn" onclick="handleRegister(this)" disabled>Create Account</button>
            <p class="auth-switch">Already have an account? <a onclick="showLogin()">Sign in</a></p>
        </div>
        
        <!-- OTP VERIFICATION -->
        <div id="verify-pending" class="hidden">
            <div style="text-align: center; margin-bottom: 24px;">
                <svg width="64" height="64" viewBox="0 0 24 24" fill="none" stroke="var(--accent)" stroke-width="1.5">
                    <path d="M3 8l7.89 5.26a2 2 0 002.22 0L21 8M5 19h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z"/>
                </svg>
            </div>
            <h1 class="auth-title">Enter verification code</h1>
            <p class="auth-subtitle">We sent a 6-digit code to</p>
            <p style="color: var(--text); font-weight: 600; margin: 8px 0 24px;" id="verify-email-display"></p>
            
            <div style="display: flex; gap: 8px; justify-content: center; margin-bottom: 24px;">
                <input type="text" id="otp-1" class="otp-input" maxlength="1" inputmode="numeric" autocomplete="one-time-code">
                <input type="text" id="otp-2" class="otp-input" maxlength="1" inputmode="numeric">
                <input type="text" id="otp-3" class="otp-input" maxlength="1" inputmode="numeric">
                <input type="text" id="otp-4" class="otp-input" maxlength="1" inputmode="numeric">
                <input type="text" id="otp-5" class="otp-input" maxlength="1" inputmode="numeric">
                <input type="text" id="otp-6" class="otp-input" maxlength="1" inputmode="numeric">
            </div>
            
            <p id="otp-error" style="color: #dc2626; font-size: 13px; margin-bottom: 16px; display: none;"></p>
            
            <button class="btn btn-primary" id="verify-btn" onclick="handleVerifyOTP(this)">Verify</button>
            
            <div style="margin-top: 24px; padding-top: 24px; border-top: 1px solid var(--border);">
                <p style="color: var(--text-muted); font-size: 13px;">Didn't receive the code?</p>
                <button class="btn btn-secondary" style="margin-top: 12px;" onclick="resendVerification()">Resend code</button>
            </div>
            <p style="color: var(--text-muted); font-size: 12px; margin-top: 16px;">Code expires in 15 minutes</p>
            <p class="auth-switch" style="margin-top: 16px;"><a onclick="showLogin()">Back to sign in</a></p>
        </div>
        
        <!-- EMAIL VERIFIED SUCCESS -->
        <div id="verify-success" class="hidden">
            <div style="text-align: center; margin-bottom: 24px;">
                <svg width="64" height="64" viewBox="0 0 24 24" fill="none" stroke="var(--accent)" stroke-width="1.5">
                    <path d="M22 11.08V12a10 10 0 11-5.93-9.14"/>
                    <polyline points="22 4 12 14.01 9 11.01"/>
                </svg>
            </div>
            <h1 class="auth-title">Email verified!</h1>
            <p class="auth-subtitle">Your account is ready. You can now sign in.</p>
            <button class="btn btn-primary" style="margin-top: 24px;" onclick="window.location.href='/app/'">Go to Dashboard</button>
        </div>
    </div>
</div>

<script>
// === AUTO-REDIRECT IF ALREADY LOGGED IN ===
(function(){
    if (localStorage.getItem('onto_logged_in') === 'true' && localStorage.getItem('onto_first_api_key')) {
        window.location.href = '/app/';
    }
})();

// === CONFIG ===
const API_BASE = 'https://api.ontostandard.org';
let authToken = null;
let currentUser = null;
let pendingVerificationEmail = '';

// === UTILITIES ===
function escapeHtml(str) { const d = document.createElement('div'); d.textContent = str; return d.innerHTML; }
function layerToPlan(layer) { return { open: 'free', standard: 'business', critical: 'enterprise' }[layer] || 'free'; }
function showToast(message, type = 'info') {
    const container = document.getElementById('toast-container');
    const toast = document.createElement('div');
    toast.className = 'toast ' + type;
    toast.textContent = message;
    container.appendChild(toast);
    setTimeout(() => toast.remove(), 3000);
}

// === THEME ===
function toggleTheme() {
    const isLight = document.documentElement.getAttribute('data-theme') === 'light';
    const sunIcon = '<circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/>';
    const moonIcon = '<path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/>';
    
    const icons = [document.getElementById('theme-icon-mobile')];
    
    if (isLight) {
        document.documentElement.removeAttribute('data-theme');
        icons.forEach(el => { if (el) el.innerHTML = sunIcon; });
        localStorage.setItem('onto-theme', 'dark');
    } else {
        document.documentElement.setAttribute('data-theme', 'light');
        icons.forEach(el => { if (el) el.innerHTML = moonIcon; });
        localStorage.setItem('onto-theme', 'light');
    }
    drawIndustryChart();
}

// Init theme from localStorage (dark is default)
(function() {
    const saved = localStorage.getItem('onto-theme');
    if (saved === 'light') {
        document.documentElement.setAttribute('data-theme', 'light');
        document.addEventListener('DOMContentLoaded', () => {
            const moonIcon = '<path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/>';
            [document.getElementById('theme-icon-mobile')].forEach(el => {
                if (el) el.innerHTML = moonIcon;
            });
        });
    }
})();

// === AUTH MENU ===
function toggleAuthMenu() {
    // На auth screen — открываем auth menu, в ЛК — sidebar
    const authScreen = document.getElementById('auth-screen');
    if (authScreen && authScreen.style.display !== 'none') {
        document.getElementById('auth-menu').classList.toggle('open');
        document.getElementById('auth-menu-overlay').classList.toggle('visible');
    } else {
        toggleMobile();
    }
}

function closeAuthMenu() {
    document.getElementById('auth-menu').classList.remove('open');
    document.getElementById('auth-menu-overlay').classList.remove('visible');
}

function setLoading(btn, loading) {
    if (loading) {
        btn.classList.add('loading');
        btn.disabled = true;
    } else {
        btn.classList.remove('loading');
        btn.disabled = false;
    }
}

// === AUTH ===
// === AUTH ===
function showLogin() {
    document.getElementById('login-form').classList.remove('hidden');
    document.getElementById('register-form').classList.add('hidden');
    document.getElementById('verify-pending').classList.add('hidden');
    document.getElementById('verify-success').classList.add('hidden');
}

function showRegister() {
    document.getElementById('login-form').classList.add('hidden');
    document.getElementById('register-form').classList.remove('hidden');
    document.getElementById('verify-pending').classList.add('hidden');
    document.getElementById('verify-success').classList.add('hidden');
}

function togglePassword(inputId, btn) {
    const input = document.getElementById(inputId);
    if (input.type === 'password') {
        input.type = 'text';
        btn.innerHTML = '<svg viewBox="0 0 24 24" width="18" height="18" fill="none" stroke="currentColor" stroke-width="2"><path d="M17.94 17.94A10.07 10.07 0 0112 20c-7 0-11-8-11-8a18.45 18.45 0 015.06-5.94M9.9 4.24A9.12 9.12 0 0112 4c7 0 11 8 11 8a18.5 18.5 0 01-2.16 3.19m-6.72-1.07a3 3 0 11-4.24-4.24"/><line x1="1" y1="1" x2="23" y2="23"/></svg>';
    } else {
        input.type = 'password';
        btn.innerHTML = '<svg viewBox="0 0 24 24" width="18" height="18" fill="none" stroke="currentColor" stroke-width="2"><path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"/><circle cx="12" cy="12" r="3"/></svg>';
    }
}

// Enable register button when terms agreed
document.getElementById('terms-agree').addEventListener('change', function() {
    document.getElementById('register-btn').disabled = !this.checked;
});

async function handleLogin(btn) {
    const email = document.getElementById('login-email').value;
    const password = document.getElementById('login-password').value;
    
    if (!email || !password) {
        showToast('Please fill in all fields', 'error');
        return;
    }
    
    setLoading(btn, true);
    
    try {
        const response = await fetch(`${API_BASE}/v1/auth/login`, {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ email, password })
        });
        
        const data = await response.json();
        
        if (!response.ok) {
            throw new Error(data.detail || 'Login failed');
        }
        
        // Store token and user data (backend format)
        authToken = data.token;
        localStorage.setItem('onto_token', authToken);
        
        // Store API key for Reference panel
        if (data.api_key) {
            localStorage.setItem('onto_first_api_key', data.api_key);
        }
        
        currentUser = {
            id: data.user_id,
            name: data.name,
            email: email,
            role: data.role || 'admin',
            plan: layerToPlan(data.layer || 'open'),
            organization_id: data.organization_id,
            organization_name: data.organization_name,
            can_invoice: false,
            company: null  // Company set only after explicit registration
        };
        localStorage.setItem('onto_user', JSON.stringify(currentUser));
        
        // Also store in new format for consistency
        localStorage.setItem('onto_user_id', data.user_id);
        localStorage.setItem('onto_user_name', data.name || '');
        localStorage.setItem('onto_user_email', email);
        localStorage.setItem('onto_org_id', data.organization_id);
        localStorage.setItem('onto_org_name', data.organization_name || '');
        localStorage.setItem('onto_layer', data.layer || 'open');
        localStorage.setItem('onto_role', data.role || 'admin');
        localStorage.setItem('onto_logged_in', 'true');
        
        setLoading(btn, false);
        showToast('Welcome back!', 'success');
        window.location.href = '/app/';
    } catch (error) {
        setLoading(btn, false);
        
        // Check if email not verified
        if (error.message && error.message.includes('not verified')) {
            pendingVerificationEmail = email;
            showVerifyPending(email);
            showToast('Please verify your email first', 'info');
            return;
        }
        
        showToast(error.message || 'Login failed', 'error');
    }
}


async function handleRegister(btn) {
    const name = document.getElementById('reg-name').value;
    const email = document.getElementById('reg-email').value;
    const password = document.getElementById('reg-password').value;
    const termsAgreed = document.getElementById('terms-agree').checked;
    
    if (!name || !email || !password) {
        showToast('Please fill in all fields', 'error');
        return;
    }
    
    if (!termsAgreed) {
        showToast('Please agree to the Terms of Service', 'error');
        return;
    }
    
    setLoading(btn, true);
    
    try {
        const response = await fetch(`${API_BASE}/v1/auth/register`, {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ name, email, password })
        });
        
        const data = await response.json();
        
        if (!response.ok) {
            throw new Error(data.detail || 'Registration failed');
        }
        
        // Store API key for later display
        localStorage.setItem('onto_first_api_key', data.api_key);
        pendingVerificationEmail = email;
        
        setLoading(btn, false);
        
        // Show verification pending screen
        showVerifyPending(email);
        showToast('Check your email to verify your account', 'success');
    } catch (error) {
        setLoading(btn, false);
        showToast(error.message || 'Registration failed', 'error');
    }
}

function showVerifyPending(email) {
    document.getElementById('login-form').classList.add('hidden');
    document.getElementById('register-form').classList.add('hidden');
    document.getElementById('verify-success').classList.add('hidden');
    document.getElementById('verify-pending').classList.remove('hidden');
    document.getElementById('verify-email-display').textContent = email;
    document.getElementById('otp-error').style.display = 'none';
    
    // Clear OTP inputs
    for (let i = 1; i <= 6; i++) {
        document.getElementById('otp-' + i).value = '';
    }
    
    // Focus first input
    setTimeout(() => document.getElementById('otp-1').focus(), 100);
    
    // Setup OTP input handlers
    setupOTPInputs();
}

function setupOTPInputs() {
    for (let i = 1; i <= 6; i++) {
        const input = document.getElementById('otp-' + i);
        
        input.addEventListener('input', (e) => {
            const val = e.target.value.replace(/[^0-9]/g, '');
            e.target.value = val;
            if (val && i < 6) {
                document.getElementById('otp-' + (i + 1)).focus();
            }
            // Auto-submit when all 6 digits entered
            if (i === 6 && val) {
                const code = getOTPCode();
                if (code.length === 6) handleVerifyOTP(document.getElementById('verify-btn'));
            }
        });
        
        input.addEventListener('keydown', (e) => {
            if (e.key === 'Backspace' && !e.target.value && i > 1) {
                document.getElementById('otp-' + (i - 1)).focus();
            }
        });
        
        // Handle paste
        input.addEventListener('paste', (e) => {
            e.preventDefault();
            const paste = (e.clipboardData || window.clipboardData).getData('text').replace(/[^0-9]/g, '');
            for (let j = 0; j < 6 && j < paste.length; j++) {
                document.getElementById('otp-' + (j + 1)).value = paste[j];
            }
            if (paste.length >= 6) {
                document.getElementById('otp-6').focus();
                handleVerifyOTP(document.getElementById('verify-btn'));
            }
        });
    }
}

function getOTPCode() {
    let code = '';
    for (let i = 1; i <= 6; i++) {
        code += document.getElementById('otp-' + i).value;
    }
    return code;
}

async function handleVerifyOTP(btn) {
    const code = getOTPCode();
    if (code.length !== 6) {
        document.getElementById('otp-error').textContent = 'Please enter all 6 digits';
        document.getElementById('otp-error').style.display = 'block';
        return;
    }
    
    setLoading(btn, true);
    document.getElementById('otp-error').style.display = 'none';
    
    try {
        const response = await fetch(`${API_BASE}/v1/auth/verify-email`, {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ email: pendingVerificationEmail, code: code })
        });
        
        const data = await response.json();
        
        if (!response.ok) {
            throw new Error(data.detail || 'Verification failed');
        }
        
        // Auto-login with returned data
        authToken = data.token;
        localStorage.setItem('onto_token', authToken);
        
        if (data.api_key) {
            localStorage.setItem('onto_first_api_key', data.api_key);
        }
        
        currentUser = {
            id: data.user_id,
            name: data.name,
            email: data.email,
            role: data.role || 'admin',
            plan: layerToPlan(data.layer || 'open'),
            organization_id: data.organization_id,
            organization_name: data.organization_name
        };
        localStorage.setItem('onto_user', JSON.stringify(currentUser));
        localStorage.setItem('onto_logged_in', 'true');
        
        setLoading(btn, false);
        showToast('Email verified! Welcome to ONTO', 'success');
        window.location.href = '/app/';
    } catch (error) {
        setLoading(btn, false);
        document.getElementById('otp-error').textContent = error.message;
        document.getElementById('otp-error').style.display = 'block';
        
        // Shake OTP inputs
        for (let i = 1; i <= 6; i++) {
            document.getElementById('otp-' + i).classList.add('error');
            setTimeout(() => document.getElementById('otp-' + i).classList.remove('error'), 1500);
        }
    }
}

function showVerifySuccess() {
    document.getElementById('login-form').classList.add('hidden');
    document.getElementById('register-form').classList.add('hidden');
    document.getElementById('verify-pending').classList.add('hidden');
    document.getElementById('verify-success').classList.remove('hidden');
}

async function resendVerification() {
    if (!pendingVerificationEmail) {
        showToast('No email to verify', 'error');
        return;
    }
    
    try {
        const response = await fetch(`${API_BASE}/v1/auth/resend-verification`, {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ email: pendingVerificationEmail, password: '' })
        });
        
        const data = await response.json();
        showToast(data.message || 'Verification email sent', 'success');
    } catch (error) {
        showToast('Failed to resend email', 'error');
    }
}

async function checkEmailVerification() {
    const params = new URLSearchParams(window.location.search);
    const token = params.get('verify');
    
    if (!token) return;
    
    try {
        const response = await fetch(`${API_BASE}/v1/auth/verify-email?token=${token}`);
        const data = await response.json();
        
        if (response.ok && data.success) {
            // Clean URL first
            window.history.replaceState({}, '', window.location.pathname);
            
            // Auto-login with returned data
            if (data.token) {
                authToken = data.token;
                localStorage.setItem('onto_token', authToken);
                
                currentUser = {
                    id: data.user_id,
                    name: data.name,
                    email: data.email,
                    role: 'admin',
                    plan: layerToPlan(data.layer || 'open'),
                    organization_id: data.organization_id,
                    can_invoice: false,
                    company: null  // Company set only after explicit registration
                };
                localStorage.setItem('onto_user', JSON.stringify(currentUser));
                
                showToast('Email verified! Welcome to ONTO.', 'success');
                window.location.href = '/app/';
            } else {
                showVerifySuccess();
                showToast('Email verified! Please sign in.', 'success');
            }
        } else {
            showToast(data.detail || 'Verification failed', 'error');
        }
    } catch (error) {
        showToast('Verification failed', 'error');
        window.history.replaceState({}, '', window.location.pathname);
    }
}

// === ENTER KEY ===
document.getElementById('login-password').addEventListener('keydown', function(e) {
    if (e.key === 'Enter') handleLogin(document.getElementById('login-btn'));
});
document.getElementById('login-email').addEventListener('keydown', function(e) {
    if (e.key === 'Enter') document.getElementById('login-password').focus();
});
</script>
</body>
</html>