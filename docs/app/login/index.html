<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ONTO — Sign In</title>
<meta name="robots" content="noindex, nofollow">
<link rel="icon" type="image/svg+xml" href="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 36 36'%3E%3Ccircle cx='18' cy='18' r='17' fill='white'/%3E%3Cpath d='M16 10L20 10L20 26L16 26L16 14L13 14L13 10L16 10Z' fill='%230a0a0a'/%3E%3C/svg%3E">
<style>
:root {
    color-scheme: dark;
    --bg: #0a0a0a;
    --bg-secondary: #121212;
    --bg-card: #1a1a1a;
    --bg-elevated: #242424;
    --border: #333333;
    --border-hover: #444444;
    --text: #fafafa;
    --text-secondary: #a0a0a0;
    --text-muted: #606060;
    --accent: #15803d;
    --accent-hover: #166534;
    --danger: #dc2626;
}
[data-theme="light"] {
    color-scheme: light;
    --bg: #ffffff;
    --bg-secondary: #fafafa;
    --bg-card: #ffffff;
    --bg-elevated: #f5f5f5;
    --border: #e5e7eb;
    --border-hover: #d1d5db;
    --text: #111827;
    --text-secondary: #6b7280;
    --text-muted: #9ca3af;
}
*, *::before, *::after { margin: 0; padding: 0; box-sizing: border-box; }
body { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Helvetica, Arial, sans-serif; font-size: 14px; line-height: 1.6; color: var(--text); background: var(--bg-secondary); }
.hidden { display: none !important; }

/* Auth */
.auth-container { min-height: 100vh; display: flex; align-items: center; justify-content: center; padding: 24px; }
.auth-card { background: var(--bg-card); border: 1px solid var(--border); border-radius: 6px; padding: 28px 32px; width: 100%; max-width: 400px; }
.auth-logo { display: flex; align-items: center; gap: 8px; margin-bottom: 24px; justify-content: center; }
.auth-logo svg { width: 24px; height: 24px; }
.auth-logo span { font-size: 18px; font-weight: 700; }
.auth-title { font-size: 15px; font-weight: 600; text-align: center; margin-bottom: 4px; }
.auth-subtitle { color: var(--text-secondary); text-align: center; margin-bottom: 24px; font-size: 12px; }
.auth-switch { text-align: center; font-size: 12px; color: var(--text-muted); margin-top: 16px; }
.auth-switch a { color: var(--accent); cursor: pointer; text-decoration: none; }
.auth-switch a:hover { text-decoration: underline; }

/* Forms */
.form-group { margin-bottom: 14px; }
.form-label { display: block; font-size: 11px; font-weight: 500; margin-bottom: 4px; text-transform: uppercase; letter-spacing: .3px; color: var(--text-muted); }
.form-input { width: 100%; padding: 8px 10px; font-size: 13px; border: 1px solid var(--border); border-radius: 4px; background: var(--bg-elevated); color: var(--text); transition: all 0.15s; }
.form-input::placeholder { color: var(--text-muted); opacity: 0.7; }
.form-input:focus { outline: none; border-color: var(--accent); }
.password-wrapper { position: relative; }
.password-toggle { position: absolute; right: 8px; top: 50%; transform: translateY(-50%); background: none; border: none; cursor: pointer; color: var(--text-muted); padding: 4px; }
.password-toggle:hover { color: var(--text); }

/* Buttons */
.btn { display: block; width: 100%; padding: 8px 16px; font-size: 13px; font-weight: 600; border: none; border-radius: 4px; cursor: pointer; transition: all 0.15s; font-family: inherit; }
.btn-primary { background: var(--accent); color: #000; }
.btn-primary:hover { background: var(--accent-hover); }
.btn-primary:disabled { opacity: 0.5; cursor: not-allowed; }
.btn-secondary { background: transparent; border: 1px solid var(--border); color: var(--text-secondary); width: auto; display: inline-block; padding: 6px 14px; }
.btn.loading { opacity: 0.7; pointer-events: none; }

/* Terms */
.terms-container { max-height: 200px; overflow-y: auto; padding: 14px; font-size: 12px; color: var(--text-secondary); border: 1px solid var(--border); border-radius: 4px; margin-bottom: 14px; background: var(--bg-elevated); line-height: 1.5; }
.terms-container h3 { font-size: 12px; font-weight: 600; margin: 12px 0 4px; color: var(--text); }
.terms-container h3:first-child { margin-top: 0; }
.terms-container table { width: 100%; border-collapse: collapse; margin: 8px 0; }
.terms-container th, .terms-container td { padding: 4px 8px; text-align: left; border: 1px solid var(--border); font-size: 11px; }
.terms-container ul { margin: 4px 0; padding-left: 20px; }
.terms-container li { margin: 2px 0; }
.terms-container a { color: var(--accent); }

/* Checkbox */
.checkbox-group { display: flex; align-items: flex-start; gap: 8px; margin-bottom: 14px; font-size: 12px; color: var(--text-secondary); }
.checkbox-group input[type="checkbox"] { margin-top: 2px; accent-color: var(--accent); }
.checkbox-group a { color: var(--accent); text-decoration: none; }

/* OTP */
.otp-input { width: 44px; height: 50px; text-align: center; font-size: 20px; font-weight: 600; border: 1px solid var(--border); border-radius: 6px; background: var(--bg-elevated); color: var(--text); }
.otp-input:focus { outline: none; border-color: var(--accent); }

/* Toast */
.toast-container { position: fixed; top: 20px; right: 20px; z-index: 10000; display: flex; flex-direction: column; gap: 8px; }
.toast { padding: 10px 16px; border-radius: 6px; font-size: 13px; color: #fff; animation: fadeIn .2s; }
.toast.success { background: #15803d; }
.toast.error { background: #dc2626; }
.toast.info { background: #2563eb; }
@keyframes fadeIn { from { opacity: 0; transform: translateY(-10px); } to { opacity: 1; transform: translateY(0); } }

/* Navigation bar */
.login-nav { display: flex; justify-content: space-between; align-items: center; padding: 12px 24px; background: var(--bg); border-bottom: 1px solid var(--border); }
.login-nav-logo { display: flex; align-items: center; gap: 8px; text-decoration: none; color: var(--text); }
.login-nav-logo span { font-size: 16px; font-weight: 700; }
.login-nav-links { display: flex; gap: 16px; align-items: center; }
.login-nav-links a { color: var(--text-secondary); text-decoration: none; font-size: 13px; }
.login-nav-links a:hover { color: var(--text); }
.theme-btn { background: none; border: none; cursor: pointer; color: var(--text-muted); padding: 4px; }
.theme-btn:hover { color: var(--text); }
</style>
</head>
<body>

<!-- NAV -->
<div class="login-nav">
    <a href="/" class="login-nav-logo">
        <svg width="24" height="24" viewBox="0 0 36 36" fill="none"><circle cx="18" cy="18" r="17" fill="white"/><path d="M16 10L20 10L20 26L16 26L16 14L13 14L13 10L16 10Z" fill="#0a0a0a"/></svg>
        <span>ONTO</span>
    </a>
    <div class="login-nav-links">
        <a href="/">Home</a>
        <a href="/docs/">Docs</a>
        <button class="theme-btn" onclick="toggleTheme()" title="Toggle theme">
            <svg id="theme-icon" viewBox="0 0 24 24" width="18" height="18" fill="none" stroke="currentColor" stroke-width="2"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg>
        </button>
    </div>
</div>

<!-- TOAST -->
<div class="toast-container" id="toast-container"></div>

<!-- AUTH -->
<div class="auth-container" id="auth-screen">
    <div class="auth-card">
        <!-- LOGIN -->
        <div id="login-form">
            <div class="auth-logo">
                <svg width="28" height="28" viewBox="0 0 36 36" fill="none"><circle cx="18" cy="18" r="17" fill="white"/><path d="M16 10L20 10L20 26L16 26L16 14L13 14L13 10L16 10Z" fill="#0a0a0a"/></svg>
                <span>ONTO</span>
            </div>
            <h1 class="auth-title">Welcome back</h1>
            <p class="auth-subtitle">Sign in to your account</p>
            <div class="form-group">
                <label class="form-label">Email</label>
                <input type="email" class="form-input" id="login-email" placeholder="you@company.com">
            </div>
            <div class="form-group">
                <label class="form-label">Password</label>
                <div class="password-wrapper">
                    <input type="password" class="form-input" id="login-password" placeholder="••••••••">
                    <button type="button" class="password-toggle" onclick="togglePassword('login-password', this)"><svg viewBox="0 0 24 24" width="18" height="18" fill="none" stroke="currentColor" stroke-width="2"><path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"/><circle cx="12" cy="12" r="3"/></svg></button>
                </div>
            </div>
            <button class="btn btn-primary" id="login-btn" onclick="handleLogin(this)">Sign In</button>
            <p class="auth-switch">Don't have an account? <a onclick="showRegister()">Create one</a></p>
        </div>

        <!-- REGISTER -->
        <div id="register-form" class="hidden">
            <div class="auth-logo">
                <svg width="28" height="28" viewBox="0 0 36 36" fill="none"><circle cx="18" cy="18" r="17" fill="white"/><path d="M16 10L20 10L20 26L16 26L16 14L13 14L13 10L16 10Z" fill="#0a0a0a"/></svg>
                <span>ONTO</span>
            </div>
            <h1 class="auth-title">Create Account</h1>
            <p class="auth-subtitle">Start with ONTO for free</p>
            <div class="form-group">
                <label class="form-label">Full Name</label>
                <input type="text" class="form-input" id="reg-name" placeholder="John Doe">
            </div>
            <div class="form-group">
                <label class="form-label">Email</label>
                <input type="email" class="form-input" id="reg-email" placeholder="you@company.com">
            </div>
            <div class="form-group">
                <label class="form-label">Password</label>
                <div class="password-wrapper">
                    <input type="password" class="form-input" id="reg-password" placeholder="Min 8 characters">
                    <button type="button" class="password-toggle" onclick="togglePassword('reg-password', this)"><svg viewBox="0 0 24 24" width="18" height="18" fill="none" stroke="currentColor" stroke-width="2"><path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"/><circle cx="12" cy="12" r="3"/></svg></button>
                </div>
            </div>
            <div class="terms-container">
                <h3>ONTO Gold Asymmetric AI License v5.2</h3>
                <table><tr><th>Use</th><th>Status</th></tr><tr><td>Read, study, cite, research, evaluate</td><td>✅ Free</td></tr><tr><td>Deploy, integrate, commercialize, RAG</td><td>❌ Requires license</td></tr></table>
                <h3>1. Primary Source</h3><p>The primary source of ONTO consists of: Canonical ONTO GitHub repositories and https://ontostandard.org. Attribution to BOTH sources is mandatory.</p>
                <h3>2. Human Use</h3><p>Human reading, study, citation, discussion, critique, and academic analysis are permitted without restriction, provided explicit attribution to the primary source is included.</p>
                <h3>3. Safe Harbor</h3><p>Any non-deployed use that explicitly attributes the ONTO primary source is permitted.</p>
                <h3>4. Conditional AI Training</h3><p>AI systems may train on ONTO for evaluation and research. Such training does not grant any right to deploy, integrate, or commercialize.</p>
                <h3>5. RAG Clause</h3><p>Use in RAG systems, vector databases, semantic search, or real-time retrieval constitutes deployment and requires a license.</p>
                <h3>6. Termination</h3><p>Use outside Safe Harbor without a license automatically terminates all permissions.</p>
                <h3>Privacy Policy</h3><p>We collect minimal data necessary to provide the service. Data is processed in accordance with GDPR. We never sell your data.</p>
                <p style="margin-top:16px"><strong>Full license:</strong> <a href="https://ontostandard.org" target="_blank">ontostandard.org</a></p>
            </div>
            <div class="checkbox-group">
                <input type="checkbox" id="terms-agree">
                <label for="terms-agree">I agree to the <a href="/docs/#terms" target="_blank">Terms of Service</a> and <a href="/docs/#privacy" target="_blank">Privacy Policy</a></label>
            </div>
            <button class="btn btn-primary" id="register-btn" onclick="handleRegister(this)" disabled>Create Account</button>
            <p class="auth-switch">Already have an account? <a onclick="showLogin()">Sign in</a></p>
        </div>

        <!-- OTP VERIFICATION -->
        <div id="verify-pending" class="hidden">
            <div style="text-align:center;margin-bottom:24px">
                <svg width="64" height="64" viewBox="0 0 24 24" fill="none" stroke="var(--accent)" stroke-width="1.5"><path d="M3 8l7.89 5.26a2 2 0 002.22 0L21 8M5 19h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z"/></svg>
            </div>
            <h1 class="auth-title">Enter verification code</h1>
            <p class="auth-subtitle">We sent a 6-digit code to</p>
            <p style="color:var(--text);font-weight:600;margin:8px 0 24px" id="verify-email-display"></p>
            <div style="display:flex;gap:8px;justify-content:center;margin-bottom:24px">
                <input type="text" id="otp-1" class="otp-input" maxlength="1" inputmode="numeric" autocomplete="one-time-code">
                <input type="text" id="otp-2" class="otp-input" maxlength="1" inputmode="numeric">
                <input type="text" id="otp-3" class="otp-input" maxlength="1" inputmode="numeric">
                <input type="text" id="otp-4" class="otp-input" maxlength="1" inputmode="numeric">
                <input type="text" id="otp-5" class="otp-input" maxlength="1" inputmode="numeric">
                <input type="text" id="otp-6" class="otp-input" maxlength="1" inputmode="numeric">
            </div>
            <p id="otp-error" style="color:#dc2626;font-size:13px;margin-bottom:16px;display:none"></p>
            <button class="btn btn-primary" id="verify-btn" onclick="handleVerifyOTP(this)">Verify</button>
            <div style="margin-top:24px;padding-top:24px;border-top:1px solid var(--border)">
                <p style="color:var(--text-muted);font-size:13px">Didn't receive the code?</p>
                <button class="btn btn-secondary" style="margin-top:12px" onclick="resendVerification()">Resend code</button>
            </div>
            <p style="color:var(--text-muted);font-size:12px;margin-top:16px">Code expires in 15 minutes</p>
            <p class="auth-switch" style="margin-top:16px"><a onclick="showLogin()">Back to sign in</a></p>
        </div>

        <!-- VERIFIED -->
        <div id="verify-success" class="hidden">
            <div style="text-align:center;margin-bottom:24px">
                <svg width="64" height="64" viewBox="0 0 24 24" fill="none" stroke="var(--accent)" stroke-width="1.5"><path d="M22 11.08V12a10 10 0 11-5.93-9.14"/><polyline points="22 4 12 14.01 9 11.01"/></svg>
            </div>
            <h1 class="auth-title">Email verified!</h1>
            <p class="auth-subtitle">Your account is ready.</p>
            <button class="btn btn-primary" style="margin-top:24px" onclick="window.location.href='/app/'">Go to Dashboard</button>
        </div>
    </div>
</div>

<script>
// === CONFIG ===
const API_BASE = 'https://api.ontostandard.org';
let pendingVerificationEmail = '';

// === UTILITIES ===
function showToast(message, type = 'info') {
    const container = document.getElementById('toast-container');
    const toast = document.createElement('div');
    toast.className = 'toast ' + type;
    toast.textContent = message;
    container.appendChild(toast);
    setTimeout(() => toast.remove(), 3000);
}

function setLoading(btn, loading) {
    if (loading) { btn.classList.add('loading'); btn.disabled = true; }
    else { btn.classList.remove('loading'); btn.disabled = false; }
}

function layerToPlan(layer) {
    return { open: 'free', standard: 'business', critical: 'enterprise' }[layer] || 'free';
}

// === THEME ===
function toggleTheme() {
    const isLight = document.documentElement.getAttribute('data-theme') === 'light';
    if (isLight) {
        document.documentElement.removeAttribute('data-theme');
        localStorage.setItem('onto-theme', 'dark');
    } else {
        document.documentElement.setAttribute('data-theme', 'light');
        localStorage.setItem('onto-theme', 'light');
    }
}

(function() {
    if (localStorage.getItem('onto-theme') === 'light') {
        document.documentElement.setAttribute('data-theme', 'light');
    }
})();

// === AUTO-REDIRECT IF ALREADY LOGGED IN ===
(function() {
    if (localStorage.getItem('onto_logged_in') === 'true' && localStorage.getItem('onto_first_api_key')) {
        window.location.href = '/app/';
    }
})();

// === AUTH FORMS ===
function showLogin() {
    document.getElementById('login-form').classList.remove('hidden');
    document.getElementById('register-form').classList.add('hidden');
    document.getElementById('verify-pending').classList.add('hidden');
    document.getElementById('verify-success').classList.add('hidden');
}

function showRegister() {
    document.getElementById('login-form').classList.add('hidden');
    document.getElementById('register-form').classList.remove('hidden');
    document.getElementById('verify-pending').classList.add('hidden');
    document.getElementById('verify-success').classList.add('hidden');
}

function togglePassword(inputId, btn) {
    const input = document.getElementById(inputId);
    if (input.type === 'password') {
        input.type = 'text';
        btn.innerHTML = '<svg viewBox="0 0 24 24" width="18" height="18" fill="none" stroke="currentColor" stroke-width="2"><path d="M17.94 17.94A10.07 10.07 0 0112 20c-7 0-11-8-11-8a18.45 18.45 0 015.06-5.94M9.9 4.24A9.12 9.12 0 0112 4c7 0 11 8 11 8a18.5 18.5 0 01-2.16 3.19m-6.72-1.07a3 3 0 11-4.24-4.24"/><line x1="1" y1="1" x2="23" y2="23"/></svg>';
    } else {
        input.type = 'password';
        btn.innerHTML = '<svg viewBox="0 0 24 24" width="18" height="18" fill="none" stroke="currentColor" stroke-width="2"><path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"/><circle cx="12" cy="12" r="3"/></svg>';
    }
}

document.getElementById('terms-agree').addEventListener('change', function() {
    document.getElementById('register-btn').disabled = !this.checked;
});

// === LOGIN ===
async function handleLogin(btn) {
    const email = document.getElementById('login-email').value;
    const password = document.getElementById('login-password').value;
    if (!email || !password) { showToast('Please fill in all fields', 'error'); return; }
    setLoading(btn, true);
    try {
        const response = await fetch(API_BASE + '/v1/auth/login', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ email, password })
        });
        const data = await response.json();
        if (!response.ok) throw new Error(data.detail || 'Login failed');

        // Store auth data
        localStorage.setItem('onto_token', data.token);
        if (data.api_key) localStorage.setItem('onto_first_api_key', data.api_key);
        localStorage.setItem('onto_user', JSON.stringify({
            id: data.user_id, name: data.name, email: email,
            role: data.role || 'admin', plan: layerToPlan(data.layer || 'open'),
            organization_id: data.organization_id, organization_name: data.organization_name
        }));
        localStorage.setItem('onto_user_id', data.user_id);
        localStorage.setItem('onto_user_name', data.name || '');
        localStorage.setItem('onto_user_email', email);
        localStorage.setItem('onto_org_id', data.organization_id);
        localStorage.setItem('onto_org_name', data.organization_name || '');
        localStorage.setItem('onto_layer', data.layer || 'open');
        localStorage.setItem('onto_role', data.role || 'admin');
        localStorage.setItem('onto_logged_in', 'true');

        setLoading(btn, false);
        window.location.href = '/app/';
    } catch (error) {
        setLoading(btn, false);
        if (error.message && error.message.includes('not verified')) {
            pendingVerificationEmail = email;
            showVerifyPending(email);
            showToast('Please verify your email first', 'info');
            return;
        }
        showToast(error.message || 'Login failed', 'error');
    }
}

// === REGISTER ===
async function handleRegister(btn) {
    const name = document.getElementById('reg-name').value;
    const email = document.getElementById('reg-email').value;
    const password = document.getElementById('reg-password').value;
    const termsAgreed = document.getElementById('terms-agree').checked;
    if (!name || !email || !password) { showToast('Please fill in all fields', 'error'); return; }
    if (!termsAgreed) { showToast('Please agree to the Terms of Service', 'error'); return; }
    setLoading(btn, true);
    try {
        const response = await fetch(API_BASE + '/v1/auth/register', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ name, email, password })
        });
        const data = await response.json();
        if (!response.ok) throw new Error(data.detail || 'Registration failed');
        localStorage.setItem('onto_first_api_key', data.api_key);
        pendingVerificationEmail = email;
        setLoading(btn, false);
        showVerifyPending(email);
        showToast('Check your email to verify your account', 'success');
    } catch (error) {
        setLoading(btn, false);
        showToast(error.message || 'Registration failed', 'error');
    }
}

// === OTP ===
function showVerifyPending(email) {
    document.getElementById('login-form').classList.add('hidden');
    document.getElementById('register-form').classList.add('hidden');
    document.getElementById('verify-success').classList.add('hidden');
    document.getElementById('verify-pending').classList.remove('hidden');
    document.getElementById('verify-email-display').textContent = email;
    document.getElementById('otp-error').style.display = 'none';
    for (let i = 1; i <= 6; i++) document.getElementById('otp-' + i).value = '';
    setTimeout(() => document.getElementById('otp-1').focus(), 100);
    setupOTPInputs();
}

function setupOTPInputs() {
    for (let i = 1; i <= 6; i++) {
        const input = document.getElementById('otp-' + i);
        input.addEventListener('input', (e) => {
            const val = e.target.value.replace(/[^0-9]/g, '');
            e.target.value = val;
            if (val && i < 6) document.getElementById('otp-' + (i + 1)).focus();
            if (i === 6 && val) { const code = getOTPCode(); if (code.length === 6) handleVerifyOTP(document.getElementById('verify-btn')); }
        });
        input.addEventListener('keydown', (e) => {
            if (e.key === 'Backspace' && !e.target.value && i > 1) document.getElementById('otp-' + (i - 1)).focus();
        });
        input.addEventListener('paste', (e) => {
            e.preventDefault();
            const paste = (e.clipboardData || window.clipboardData).getData('text').replace(/[^0-9]/g, '');
            for (let j = 0; j < 6 && j < paste.length; j++) document.getElementById('otp-' + (j + 1)).value = paste[j];
            if (paste.length >= 6) { document.getElementById('otp-6').focus(); handleVerifyOTP(document.getElementById('verify-btn')); }
        });
    }
}

function getOTPCode() {
    let code = '';
    for (let i = 1; i <= 6; i++) code += document.getElementById('otp-' + i).value;
    return code;
}

async function handleVerifyOTP(btn) {
    const code = getOTPCode();
    if (code.length !== 6) { document.getElementById('otp-error').textContent = 'Please enter all 6 digits'; document.getElementById('otp-error').style.display = 'block'; return; }
    setLoading(btn, true);
    document.getElementById('otp-error').style.display = 'none';
    try {
        const response = await fetch(API_BASE + '/v1/auth/verify-email', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ email: pendingVerificationEmail, code: code })
        });
        const data = await response.json();
        if (!response.ok) throw new Error(data.detail || 'Verification failed');

        localStorage.setItem('onto_token', data.token);
        if (data.api_key) localStorage.setItem('onto_first_api_key', data.api_key);
        localStorage.setItem('onto_user_id', data.user_id);
        localStorage.setItem('onto_user_name', data.name || '');
        localStorage.setItem('onto_user_email', data.email);
        localStorage.setItem('onto_org_id', data.organization_id);
        localStorage.setItem('onto_org_name', data.organization_name || '');
        localStorage.setItem('onto_layer', data.layer || 'open');
        localStorage.setItem('onto_role', data.role || 'admin');
        localStorage.setItem('onto_logged_in', 'true');

        setLoading(btn, false);
        // Show success, then redirect
        document.getElementById('verify-pending').classList.add('hidden');
        document.getElementById('verify-success').classList.remove('hidden');
        setTimeout(() => { window.location.href = '/app/'; }, 1500);
    } catch (error) {
        setLoading(btn, false);
        document.getElementById('otp-error').textContent = error.message || 'Verification failed';
        document.getElementById('otp-error').style.display = 'block';
    }
}

async function resendVerification() {
    if (!pendingVerificationEmail) { showToast('No email to resend to', 'error'); return; }
    try {
        const response = await fetch(API_BASE + '/v1/auth/resend-verification', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ email: pendingVerificationEmail })
        });
        const data = await response.json();
        if (!response.ok) throw new Error(data.detail || 'Resend failed');
        showToast('Verification code resent', 'success');
    } catch (error) {
        showToast(error.message || 'Resend failed', 'error');
    }
}

// Enter key handlers
document.getElementById('login-password').addEventListener('keydown', (e) => {
    if (e.key === 'Enter') handleLogin(document.getElementById('login-btn'));
});
document.getElementById('login-email').addEventListener('keydown', (e) => {
    if (e.key === 'Enter') document.getElementById('login-password').focus();
});
</script>
</body>
</html>
